[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549593880",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-549593880",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 549593880,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTU5Mzg4MA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-04T23:26:25Z",
    "updated_at": "2019-12-06T00:09:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17681](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17681.html) (wallet: Keep inactive seeds after sethdseed and derive keys from them as needed by achow101)\n* [#17369](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17369.html) (Refactor: Move encryption code between KeyMan and Wallet by achow101)\n* [#17261](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17261.html) (Make ScriptPubKeyMan an actual interface and the wallet to have multiple by achow101)\n* [#17219](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/17219.html) (wallet: allow transaction without change if keypool is empty by Sjors)\n* [#16946](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/16946.html) (wallet: include a checksum of encrypted private keys by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549593880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549972243",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-549972243",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 549972243,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTk3MjI0Mw==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-05T19:06:56Z",
    "updated_at": "2019-11-05T19:06:56Z",
    "author_association": "MEMBER",
    "body": "> The change seems useful, but incomplete. CTxDestination is more generic than CPubKey, which offers more flexibility with (e.g. multisig) descriptor wallets. But then I think we should use CTxDestination everywhere, so maybe:\r\n\r\nI would prefer to clean this up in a followup.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/549972243/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551287220",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-551287220",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 551287220,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MTI4NzIyMA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-07T22:04:01Z",
    "updated_at": "2019-11-07T22:04:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "I would love for somebody to do a novelization of this PR like I did for https://github.com/bitcoin/bitcoin/pull/17369#pullrequestreview-313636620. I think I understand what the changes here are doing, but not why they are being made. Particularly I don't understand motivation for commits:\r\n\r\n- 8b9a1ed9fb5ef64385d3881b1423059e4daaef13 Key pool: Move TopUp call (3/6)\r\n- 8fc748e8050525a4235e34f3d93f3849245177f0 Key pool: Change ReturnDestination interface to take address instead of key (4/6)\r\n- 51ed5b0d73fc1e7010fc4b1bc26b4e1946cf60b0 Key pool: Make TopUp fail if unexpected wallet flags are set (5/6)\r\n\r\nAlso unclear if Sjors comment above about \"Make TopUp fail\" https://github.com/bitcoin/bitcoin/pull/17373#pullrequestreview-311826649 needs to be addressed\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551287220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551321055",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-551321055",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 551321055,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MTMyMTA1NQ==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-07T23:56:35Z",
    "updated_at": "2019-11-07T23:56:35Z",
    "author_association": "MEMBER",
    "body": "@ryanofsky I've updated the OP with something like that.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551321055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551436646",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-551436646",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 551436646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MTQzNjY0Ng==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-08T08:37:06Z",
    "updated_at": "2019-11-08T08:37:31Z",
    "author_association": "MEMBER",
    "body": "Thanks for the novelization.\r\n\r\n> Also unclear if Sjors comment above about \"Make TopUp fail\" [#17373 (review)](https://github.com/bitcoin/bitcoin/pull/17373#pullrequestreview-311826649) needs to be addressed\r\n\r\nI.e. descriptor wallets with `WALLET_FLAG_DISABLE_PRIVATE_KEYS` should be able to up their \"keypool\". Not too hard to change that later though.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/551436646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554334361",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-554334361",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 554334361,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDMzNDM2MQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-15T12:03:53Z",
    "updated_at": "2019-11-15T12:03:53Z",
    "author_association": "MEMBER",
    "body": "ACK eb9c2601377d40c4d55798a5ffcbe8c4791b91e5\r\n\r\nNits:\r\n* you're not really selling 06d411488c1c669f00a1c947416267941dbb7f7b with the current commit message; maybe replace with what you wrote in the PR description.\r\n* maybe call `reserved_key_to_index.erase(index)` in `KeepDestination()` as well for completeness\r\n* `m_reserved_key_to_index` could be more accurately called `m_index_to_reserved_key` or even just `m_reserved_keys` (which begs the question why the keypool uses sets instead of maps, but that's for a later cleanup)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554334361/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557135350",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-557135350",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 557135350,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzEzNTM1MA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-21T15:27:52Z",
    "updated_at": "2019-11-21T15:27:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "@instagibbs and @meshcollider, you may be interested to review this. This is code you previously acked when it was part of #16341",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557135350/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557580485",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-557580485",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 557580485,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzU4MDQ4NQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-22T15:37:26Z",
    "updated_at": "2019-11-22T15:37:26Z",
    "author_association": "MEMBER",
    "body": "re-ACK 42ddfe9125fce4da6738307ef3acf100daac9d75",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557580485/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557765963",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-557765963",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 557765963,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1Nzc2NTk2Mw==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-23T04:29:10Z",
    "updated_at": "2019-11-23T04:29:23Z",
    "author_association": "MEMBER",
    "body": "Rebased.\r\n\r\nTo resolve some issues during the rebase, I had to change a LearnRelatedScripts into a LearnAllRelatedScripts. This shoudn't change behavior since all of the scripts were implicitly learned anyways.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557765963/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557794121",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-557794121",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 557794121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1Nzc5NDEyMQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-23T12:32:15Z",
    "updated_at": "2019-11-23T12:33:02Z",
    "author_association": "MEMBER",
    "body": "re-ACK 5daefe31c34e12d2a0678aa93e74e94b76d834f5\r\n\r\nYou could stick to `LearnRelatedScripts` with https://github.com/Sjors/bitcoin/commit/8b75834396b1731f36f57712ba962074b3f7c6c1 but that's not pretty.  The only way `LearnAllRelatedScripts` produces a different result from `LearnRelatedScripts` is if you reserved a key for a legacy change address. I'm a bit confused about the other code paths that could end up calling `Learn(All)RelatedScripts`, but even if we don't already, I don't see any harm in adding redundant segwit scripts for legacy change addresses.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557794121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/559155298",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-559155298",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 559155298,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1OTE1NTI5OA==",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-27T16:17:25Z",
    "updated_at": "2019-11-27T16:17:25Z",
    "author_association": "MEMBER",
    "body": "utACK https://github.com/bitcoin/bitcoin/pull/17373/commits/66b82896d5c9d40abb9e62a7035a97025aa8aad3\r\n\r\nonly changes are the ones suggested in my previous review",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/559155298/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/561130581",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#issuecomment-561130581",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17373",
    "id": 561130581,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2MTEzMDU4MQ==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-03T11:41:16Z",
    "updated_at": "2019-12-03T11:41:16Z",
    "author_association": "MEMBER",
    "body": "Code review re-ACK 886f1731bec4393dd342403ac34069a3a4f95eea\r\n\r\n(original nit about `m_reserved_key_to_index` in 386a994b853bc5b3a2ed0d812673465b8ffa4849 description still stands, not worth losing ACKs)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/561130581/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342634238",
    "pull_request_review_id": 311826649,
    "id": 342634238,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjYzNDIzOA==",
    "diff_hunk": "@@ -3242,9 +3242,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }",
    "path": "src/wallet/wallet.cpp",
    "position": 6,
    "original_position": 6,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "4e9c2a59f500d017dbc1e3b6a3548f7b93977459",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: remove one more line",
    "created_at": "2019-11-05T15:41:47Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342634238",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342634238"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342634238"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342634238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3303,
    "original_line": 3303,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342636404",
    "pull_request_review_id": 311826649,
    "id": 342636404,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjYzNjQwNA==",
    "diff_hunk": "@@ -3246,16 +3246,14 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }\n     assert(vchPubKey.IsValid());",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "763c298e7fe1858c03c178d62bd58f31d40de32b",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Move assert for `vchPubKey.IsValid()` as well? (I know it's deleted later, but that commit is still under discussion)",
    "created_at": "2019-11-05T15:45:42Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342636404",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342636404"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342636404"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342636404/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3256,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748149",
    "pull_request_review_id": 311977188,
    "id": 342748149,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc0ODE0OQ==",
    "diff_hunk": "@@ -3242,9 +3242,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }",
    "path": "src/wallet/wallet.cpp",
    "position": 6,
    "original_position": 6,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "4e9c2a59f500d017dbc1e3b6a3548f7b93977459",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Does it really matter? It's removed a few commits later anyways.",
    "created_at": "2019-11-05T19:15:39Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748149",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748149"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748149"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3303,
    "original_line": 3303,
    "side": "LEFT",
    "in_reply_to_id": 342634238
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748706",
    "pull_request_review_id": 311977938,
    "id": 342748706,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc0ODcwNg==",
    "diff_hunk": "@@ -3246,16 +3246,14 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }\n     assert(vchPubKey.IsValid());",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "763c298e7fe1858c03c178d62bd58f31d40de32b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ignoring that it's removed later, the check matters here. since the pubkey should always be valid after GetReservedDestination. Either it was fetched earlier, or it was fetched just then.",
    "created_at": "2019-11-05T19:16:54Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748706",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748706"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342748706"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342748706/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3256,
    "side": "RIGHT",
    "in_reply_to_id": 342636404
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342778921",
    "pull_request_review_id": 312017276,
    "id": 342778921,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Mjc3ODkyMQ==",
    "diff_hunk": "@@ -3242,9 +3242,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }",
    "path": "src/wallet/wallet.cpp",
    "position": 6,
    "original_position": 6,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "4e9c2a59f500d017dbc1e3b6a3548f7b93977459",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No, it's a nit :-)",
    "created_at": "2019-11-05T20:21:42Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342778921",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342778921"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r342778921"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/342778921/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3303,
    "original_line": 3303,
    "side": "LEFT",
    "in_reply_to_id": 342634238
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346548666",
    "pull_request_review_id": 317263779,
    "id": 346548666,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU0ODY2Ng==",
    "diff_hunk": "@@ -3252,9 +3252,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {",
    "path": "src/wallet/wallet.cpp",
    "position": 4,
    "original_position": 4,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "f034e5748aa2fac9fb8c9010c806d00b2b8d79ba",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move CanGetAddresses call\" (f034e5748aa2fac9fb8c9010c806d00b2b8d79ba)\r\n\r\nMaybe say something like \"Call LegacyScriptPubKeyMan::CanGetAddresses directly instead of calling CWallet::CanGetAddresses to only query the relevant key manager\" in the commit description be clearer about what the change is supposed to do.\r\n\r\nIn case it helps anybody else, after 9b161a718f3c9d301419940cc9456f2065f8ca58 from #17261 there can more than keymanager and CWallet::CanGetAddresses will return false any of them can't generate addresses, so it wouldn't be right to call that method here.\r\n",
    "created_at": "2019-11-14T21:14:02Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346548666",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346548666"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346548666"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346548666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3301,
    "original_line": 3301,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346554060",
    "pull_request_review_id": 317263779,
    "id": 346554060,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU1NDA2MA==",
    "diff_hunk": "@@ -271,6 +271,8 @@ bool LegacyScriptPubKeyMan::GetReservedDestination(const OutputType type, bool i\n     if (!ReserveKeyFromKeyPool(index, keypool, internal)) {\n         return false;\n     }\n+    LearnRelatedScripts(keypool.vchPubKey, type);\n+    address = GetDestinationForKey(keypool.vchPubKey, type);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 23,
    "original_position": 14,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "35c37b59c5bb918c15aca3092b6506ef3974e50c",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (35c37b59c5bb918c15aca3092b6506ef3974e50c)\r\n\r\nMaybe point out in the commit description that addresses are determined by LegacyScriptPubKeyMan::GetReservedDestination \r\ninstead of ReserveDestination::GetReservedDestination because other key manager implementations might construct them in other ways.",
    "created_at": "2019-11-14T21:26:59Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346554060",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346554060"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346554060"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346554060/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 274,
    "original_line": 274,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346558726",
    "pull_request_review_id": 317263779,
    "id": 346558726,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU1ODcyNg==",
    "diff_hunk": "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move TopUp call\" (8b9a1ed9fb5ef64385d3881b1423059e4daaef13)\r\n\r\nSorry if this is a dumb question, because my understanding here is not great, but the PR description says this call has to be moved so \"it will work after future changes where m_spk_man is not a global thing in CWallet and is fetched based on type and internal-ness\".\r\n\r\nBut why couldn't the code here just look up the right keyman object using the type above and the internal-ness which it already knows?\r\n\r\nNot saying this shouldn't be moved, just that this doesn't seem to explain the move",
    "created_at": "2019-11-14T21:37:30Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346558726",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346558726"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346558726"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346558726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3125,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346562487",
    "pull_request_review_id": 317263779,
    "id": 346562487,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU2MjQ4Nw==",
    "diff_hunk": "@@ -3252,6 +3250,7 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n+    m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move TopUp call\" (8b9a1ed9fb5ef64385d3881b1423059e4daaef13)\r\n\r\nSince aside from the call in `GetNewChangeDestination` this code is also called from `CWallet::CreateTransaction`, I'm wondering if this is a change in behavior. Is topup already called when creating transactions? Wondering if this the \"unsollicited keypool topup\" refered to by https://github.com/bitcoin/bitcoin/pull/16341#issuecomment-510903836\r\n",
    "created_at": "2019-11-14T21:46:00Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346562487",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346562487"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346562487"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346562487/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3256,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346568939",
    "pull_request_review_id": 317289718,
    "id": 346568939,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU2ODkzOQ==",
    "diff_hunk": "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The place it is moved to does the lookup as well. It was redundant to do the lookup twice.",
    "created_at": "2019-11-14T22:01:29Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346568939",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346568939"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346568939"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346568939/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3125,
    "side": "LEFT",
    "in_reply_to_id": 346558726
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346570868",
    "pull_request_review_id": 317292296,
    "id": 346570868,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU3MDg2OA==",
    "diff_hunk": "@@ -3252,6 +3250,7 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n+    m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is not a change in behavior because `TopUp` is called in `LegacyScriptPubKeyMan::ReserveKeyFromKeyPool`",
    "created_at": "2019-11-14T22:06:16Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346570868",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346570868"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346570868"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346570868/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3256,
    "side": "RIGHT",
    "in_reply_to_id": 346562487
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575149",
    "pull_request_review_id": 317297747,
    "id": 346575149,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU3NTE0OQ==",
    "diff_hunk": "@@ -3252,9 +3252,6 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {",
    "path": "src/wallet/wallet.cpp",
    "position": 4,
    "original_position": 4,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "f034e5748aa2fac9fb8c9010c806d00b2b8d79ba",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-11-14T22:16:47Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346575149",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575149"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346575149"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3301,
    "original_line": 3301,
    "side": "LEFT",
    "in_reply_to_id": 346548666
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575165",
    "pull_request_review_id": 317297772,
    "id": 346575165,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NjU3NTE2NQ==",
    "diff_hunk": "@@ -271,6 +271,8 @@ bool LegacyScriptPubKeyMan::GetReservedDestination(const OutputType type, bool i\n     if (!ReserveKeyFromKeyPool(index, keypool, internal)) {\n         return false;\n     }\n+    LearnRelatedScripts(keypool.vchPubKey, type);\n+    address = GetDestinationForKey(keypool.vchPubKey, type);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 23,
    "original_position": 14,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "35c37b59c5bb918c15aca3092b6506ef3974e50c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-11-14T22:16:51Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346575165",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575165"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r346575165"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346575165/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 274,
    "original_line": 274,
    "side": "RIGHT",
    "in_reply_to_id": 346554060
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348146744",
    "pull_request_review_id": 319325957,
    "id": 348146744,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODE0Njc0NA==",
    "diff_hunk": "@@ -271,6 +271,8 @@ bool LegacyScriptPubKeyMan::GetReservedDestination(const OutputType type, bool i\n     if (!ReserveKeyFromKeyPool(index, keypool, internal)) {\n         return false;\n     }\n+    LearnRelatedScripts(keypool.vchPubKey, type);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "863655ae1c1325d9dbb3b1e73ec82f4fe16e9425",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (863655ae1c1325d9dbb3b1e73ec82f4fe16e9425)\r\n\r\nNote (mainly for myself): #17237 moves LearnRelatedScripts \r\n\r\n`ReserveDestination::GetReservedDestination -> ReserveDestination::KeepDestination`\r\n\r\nwhile this moves it:\r\n\r\n`ReserveDestination::GetReservedDestination -> LegacyScriptPubKeyMan::GetReservedDestination`\r\n\r\nSo I guess ultimately it will be called from `LegacyScriptPubKeyMan::KeepDestination`",
    "created_at": "2019-11-19T20:20:40Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348146744",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348146744"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348146744"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348146744/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 274,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348161590",
    "pull_request_review_id": 319325957,
    "id": 348161590,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODE2MTU5MA==",
    "diff_hunk": "@@ -3252,6 +3250,7 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n+    m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> This is not a change in behavior because `TopUp` is called in `LegacyScriptPubKeyMan::ReserveKeyFromKeyPool`\r\n\r\n:dizzy_face:\r\n\r\nSo if it's already called then why do we need to add a call here?\r\n\r\nIn any case, could we move all of this stuff (keyman lookup and topup call) inside the nIndex == -1 block? It seems less confusing to do lookup, topup, reservation all at once, and also maybe more efficient",
    "created_at": "2019-11-19T20:54:24Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348161590",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348161590"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348161590"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348161590/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3256,
    "side": "RIGHT",
    "in_reply_to_id": 346562487
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348182343",
    "pull_request_review_id": 319325957,
    "id": 348182343,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODE4MjM0Mw==",
    "diff_hunk": "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move TopUp call\" (a175268f0e406336cc5d97a0ed458b8f4a805b91)\r\n\r\n> The place it is moved to does the lookup as well. It was redundant to do the lookup twice.\r\n\r\nOk, so \"so that it will work after future changes\" in the PR description could be clarified to \"so that it will work without an extra address type -> keyman lookup after future changes\".\r\n\r\nI'd suggest replacing this commit description something like \"Not calling TopUp in CWallet::GetNewChangeDestination is a simplification that will avoid the need to look up a key manager based on address type when the wallet get multiple key managers later. Removing the TopUp call does not change behavior because the key pool will get topped up anyway in LegacyScriptPubKeyMan::ReserveKeyFromKeyPool.\"\r\n\r\nSorry for getting stuck on this change. When I see change that looks good and safe, but I have no idea what motivated it (a hard requirement, a code cleanup, or a chance to optimize), sometimes it's hard to get past.",
    "created_at": "2019-11-19T21:39:29Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348182343",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348182343"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348182343"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348182343/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3125,
    "side": "LEFT",
    "in_reply_to_id": 346558726
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348198405",
    "pull_request_review_id": 319325957,
    "id": 348198405,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODE5ODQwNQ==",
    "diff_hunk": "@@ -3049,6 +3049,9 @@ unsigned int CWallet::GetKeyPoolSize() const\n \n bool CWallet::TopUpKeyPool(unsigned int kpSize)\n {\n+    if (IsWalletFlagSet(WALLET_FLAG_BLANK_WALLET) || IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "b12121d52f46ac7e8455479bc9ded100cfccc841",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Make TopUp fail if unexpected wallet flags are set\" (b12121d52f46ac7e8455479bc9ded100cfccc841)\r\n\r\nThere should be a code comment here to explain what's mentioned in the PR description: that the blank wallet check is needed for TopUp to return false instead of true in a wallet without any keyman objects. It would also be good to say why that's important, because on the surface it seems like a bad choice to return failure when nothing failed.\r\n\r\nRelatedly, I would love to be able to drop this commit if it isn't actually necessary or if there isn't a specific example of a bug you could imagine this check preventing. Wallet flag code is confusing and just referencing flags in random places for no apparent reason and with no explanation isn't the greatest thing.\r\n\r\nIt's one thing to add sanity checks in asserts or CHECK_NONFATAL calls, but something else to add sanity checks in real code without clear \"this condition is never expected to happen\" comments so people reading the code don't waste time trying to imagine cases where it could actually do anything.",
    "created_at": "2019-11-19T22:15:27Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348198405",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348198405"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348198405"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348198405/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3052,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202544",
    "pull_request_review_id": 319325957,
    "id": 348202544,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwMjU0NA==",
    "diff_hunk": "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\n`assert(m_reserved_key_to_index.count(nIndex) == 0);` could be reassuring here",
    "created_at": "2019-11-19T22:26:23Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348202544",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202544"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348202544"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202544/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1184,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202997",
    "pull_request_review_id": 319325957,
    "id": 348202997,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwMjk5Nw==",
    "diff_hunk": "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
    "path": "src/wallet/scriptpubkeyman.h",
    "position": null,
    "original_position": 14,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\nShould there be separate map for internal / external key indexes? Or should map key be an (index_number, is_internal) pair? Otherwise how do you know the internal/external index numbers don't overlap?",
    "created_at": "2019-11-19T22:27:34Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348202997",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202997"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348202997"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348202997/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 250,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348205511",
    "pull_request_review_id": 319325957,
    "id": 348205511,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwNTUxMQ==",
    "diff_hunk": "@@ -281,9 +281,10 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n     KeepKey(index);\n }\n \n-void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CTxDestination& addr)\n {\n-    ReturnKey(index, internal, pubkey);\n+    ReturnKey(index, internal, m_reserved_key_to_index[index]);\n+    m_reserved_key_to_index.erase(index);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\nI still don't understand why there is this distinction between ReturnKey and ReturnDestination. Why not just rename ReturnKey to ReturnDestination and get rid of the awkward wrapping?\r\n\r\nPrevious: https://github.com/bitcoin/bitcoin/pull/17304#discussion_r340311958\r\n",
    "created_at": "2019-11-19T22:34:17Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348205511",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348205511"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348205511"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348205511/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 287,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348206310",
    "pull_request_review_id": 319325957,
    "id": 348206310,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwNjMxMA==",
    "diff_hunk": "@@ -281,9 +281,10 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n     KeepKey(index);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 1,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\nWhy doesn't this need to call m_reserved_key_to_index.erase?",
    "created_at": "2019-11-19T22:36:25Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348206310",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348206310"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348206310"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348206310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 281,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348207366",
    "pull_request_review_id": 319325957,
    "id": 348207366,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIwNzM2Ng==",
    "diff_hunk": "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (06d411488c1c669f00a1c947416267941dbb7f7b)\r\n\r\nThis commit needs a better description. The current handwavy placeholder text doesn't explain very much. Suggest replacing it with the explanation in your PR description \"In order for ScriptPubKeyMan to be generic...\"",
    "created_at": "2019-11-19T22:39:16Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348207366",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348207366"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348207366"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348207366/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1184,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348230649",
    "pull_request_review_id": 319433029,
    "id": 348230649,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMDY0OQ==",
    "diff_hunk": "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
    "path": "src/wallet/scriptpubkeyman.h",
    "position": null,
    "original_position": 14,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The indexes do not overlap. See https://github.com/bitcoin/bitcoin/blob/b4a1da9ef8e4b673c290d5b882527e627ae1b43a/src/wallet/scriptpubkeyman.cpp#L1079-L1093",
    "created_at": "2019-11-19T23:56:14Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348230649",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348230649"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348230649"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348230649/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 250,
    "side": "RIGHT",
    "in_reply_to_id": 348202997
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233119",
    "pull_request_review_id": 319436141,
    "id": 348233119,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzExOQ==",
    "diff_hunk": "@@ -3076,8 +3076,6 @@ bool CWallet::GetNewChangeDestination(const OutputType type, CTxDestination& des\n {\n     error.clear();\n \n-    m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Updated the commit message.",
    "created_at": "2019-11-20T00:06:13Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233119",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233119"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233119"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233119/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3125,
    "side": "LEFT",
    "in_reply_to_id": 346558726
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233366",
    "pull_request_review_id": 319436436,
    "id": 348233366,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzM2Ng==",
    "diff_hunk": "@@ -3252,6 +3250,7 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n+    m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 13,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8b9a1ed9fb5ef64385d3881b1423059e4daaef13",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> So if it's already called then why do we need to add a call here?\r\n\r\nIt's a belt-and-suspenders as not all ScriptPubKeyMans are guaranteed to do this.\r\n\r\nI've moved it inside the block.",
    "created_at": "2019-11-20T00:07:08Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233366",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233366"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233366"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233366/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3256,
    "side": "RIGHT",
    "in_reply_to_id": 346562487
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233485",
    "pull_request_review_id": 319436579,
    "id": 348233485,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzQ4NQ==",
    "diff_hunk": "@@ -3049,6 +3049,9 @@ unsigned int CWallet::GetKeyPoolSize() const\n \n bool CWallet::TopUpKeyPool(unsigned int kpSize)\n {\n+    if (IsWalletFlagSet(WALLET_FLAG_BLANK_WALLET) || IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "b12121d52f46ac7e8455479bc9ded100cfccc841",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Looking at this change further, I don't think it's needed, so I've removed this commit.",
    "created_at": "2019-11-20T00:07:35Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233485",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233485"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233485"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233485/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3052,
    "side": "RIGHT",
    "in_reply_to_id": 348198405
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233531",
    "pull_request_review_id": 319436633,
    "id": 348233531,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzUzMQ==",
    "diff_hunk": "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-11-20T00:07:46Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233531",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233531"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233531"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233531/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1184,
    "side": "RIGHT",
    "in_reply_to_id": 348202544
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233753",
    "pull_request_review_id": 319436907,
    "id": 348233753,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzc1Mw==",
    "diff_hunk": "@@ -281,9 +281,10 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n     KeepKey(index);\n }\n \n-void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CTxDestination& addr)\n {\n-    ReturnKey(index, internal, pubkey);\n+    ReturnKey(index, internal, m_reserved_key_to_index[index]);\n+    m_reserved_key_to_index.erase(index);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The wrapper was for the original PR to make it clearer that things were being moved. As that no longer matters, I've added a commit to rename them.",
    "created_at": "2019-11-20T00:08:41Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233753",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233753"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233753"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 287,
    "side": "RIGHT",
    "in_reply_to_id": 348205511
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233792",
    "pull_request_review_id": 319436959,
    "id": 348233792,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzMzc5Mg==",
    "diff_hunk": "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Updated the commit message.",
    "created_at": "2019-11-20T00:08:52Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233792",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233792"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233792"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348233792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1184,
    "side": "RIGHT",
    "in_reply_to_id": 348207366
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348234425",
    "pull_request_review_id": 319437786,
    "id": 348234425,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODIzNDQyNQ==",
    "diff_hunk": "@@ -281,9 +281,10 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n     KeepKey(index);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 1,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It should, and I've added it.\r\n\r\nThis wasn't necessarily a bug as it doesn't effect behavior.",
    "created_at": "2019-11-20T00:11:33Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348234425",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348234425"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348234425"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348234425/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 281,
    "side": "RIGHT",
    "in_reply_to_id": 348206310
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348360598",
    "pull_request_review_id": 319682957,
    "id": 348360598,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODM2MDU5OA==",
    "diff_hunk": "@@ -1088,15 +1088,16 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex)",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit: in the previous commit you renamed `nIndex` to `index`.",
    "created_at": "2019-11-20T09:04:53Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348360598",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348360598"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348360598"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348360598/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1090,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348362355",
    "pull_request_review_id": 319682957,
    "id": 348362355,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODM2MjM1NQ==",
    "diff_hunk": "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "You lost the assert (https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233531)",
    "created_at": "2019-11-20T09:07:53Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348362355",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348362355"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348362355"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348362355/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1184,
    "side": "RIGHT",
    "in_reply_to_id": 348202544
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348598174",
    "pull_request_review_id": 320101753,
    "id": 348598174,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODU5ODE3NA==",
    "diff_hunk": "@@ -3252,9 +3250,10 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-\n     if (nIndex == -1)\n     {\n+        m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "d195dcf841e4037a517ead16db063db9d496b42b",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move TopUp call\" (d195dcf841e4037a517ead16db063db9d496b42b)\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348233366\r\n\r\n> It's a belt-and-suspenders as not all ScriptPubKeyMans are guaranteed to do this.\r\n\r\nWould encourage adding this TopUp call in a new commit (see below), or possibly not doing it in this PR. Commit title \"Key pool: Move TopUp call\" is misleading. This isn't moving a TopUp call so much as removing a useless TopUp call in one place, and adding a new, slightly justified \"belt and suspenders\" TopUp call in a different place. \r\n\r\nSubstantively, it looks like this is a good location for the the topup. I think in general the wallet, not the key manager should be responsible for any opportunistic, unchecked topups so we don't have bugs caused by differences between key manager implementations. Also, since the wallet not the key manager is responsible for locking and unlocking, this would avoid key manager methods having different undocumented side effects depending on what wallet state they are called under.\r\n\r\nFollowing this design would lead to three small commits:\r\n- One commit removing useless topup from `CWallet::GetNewChangeDestination`.\r\n- One commit moving opportunistic topup from `LegacyScriptPubKeyMan::ReserveKeyFromKeyPool` to `ReserveDestination::GetReservedDestination` for greater key manager simplicity and goodness.\r\n- One commit moving the other opportunistic topup from `LegacyScriptPubKeyMan::GetNewDestination` to `CWallet::GetNewDestination`\r\n\r\nRelatedly, I want to emphasize how much wasted time and confusion undocumented \"belt and suspenders\" wallet code causes for me. I can understand code that does the right things, and I can understand code that does the wrong things, but when I see code checking for conditions that will never happen, or just not doing _anything_, I have 0 indication (positive or negative) code is doing what the author intended, and I waste time going back questioning fundamental assumptions to see if some inscrutable piece of code is superfluous or has some important effect in a case I never thought about. Personally, I prefer code that triggers errors or logs warnings when unexpected conditions happen instead of just silently continuing and \"working anyway\". But in cases where you prefer the belt and suspenders style, having simple \"This condition will never happen\" or \"This code should not be necessary\" comments is **hugely** helpful.",
    "created_at": "2019-11-20T16:28:48Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348598174",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348598174"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348598174"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348598174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3255,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348611654",
    "pull_request_review_id": 320101753,
    "id": 348611654,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODYxMTY1NA==",
    "diff_hunk": "@@ -1098,15 +1088,15 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t index)",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "1fecf5d0e681a266ea6adb6ae3c695b404cd3b94",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Rename Keep/ReturnKey to Keep/ReturnDestination and remove the wrapper\" (1fecf5d0e681a266ea6adb6ae3c695b404cd3b94)\r\n\r\nShould be nIndex (this commit doesn't compile)",
    "created_at": "2019-11-20T16:38:53Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348611654",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348611654"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348611654"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348611654/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1091,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348622786",
    "pull_request_review_id": 320101753,
    "id": 348622786,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODYyMjc4Ng==",
    "diff_hunk": "@@ -1108,7 +1109,9 @@ void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, cons\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_reserved_key_to_index[nIndex];",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (8707ba99cf78c556ddda42bf74ddcda164ec9db9)\r\n\r\nWould be good to change `[nIndex]` to `.at(nIndex)` here and move this before the inserts above. Safer throw an exception if a bad index is provided than insert nonsense into the keypool.",
    "created_at": "2019-11-20T16:49:00Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348622786",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348622786"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348622786"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348622786/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1112,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348626943",
    "pull_request_review_id": 320101753,
    "id": 348626943,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODYyNjk0Mw==",
    "diff_hunk": "@@ -1088,15 +1088,16 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex)\n {\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    m_reserved_key_to_index.erase(nIndex);\n     WalletLogPrintf(\"keypool keep %d\\n\", nIndex);\n }\n \n-void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::ReturnDestination(int64_t nIndex, bool fInternal, const CTxDestination& addr)",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (8707ba99cf78c556ddda42bf74ddcda164ec9db9)\r\n\r\nMaybe change `const CTxDestination& addr` to `const CTxDestination&` to make it more obvious the address argument is not used by this implementation.",
    "created_at": "2019-11-20T16:53:35Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348626943",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348626943"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348626943"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348626943/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1100,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646936",
    "pull_request_review_id": 320146692,
    "id": 348646936,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0NjkzNg==",
    "diff_hunk": "@@ -3252,9 +3250,10 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-\n     if (nIndex == -1)\n     {\n+        m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "d195dcf841e4037a517ead16db063db9d496b42b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I've dropped this commit for now.",
    "created_at": "2019-11-20T17:31:32Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646936",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646936"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646936"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646936/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3255,
    "side": "RIGHT",
    "in_reply_to_id": 348598174
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646964",
    "pull_request_review_id": 320146733,
    "id": 348646964,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0Njk2NA==",
    "diff_hunk": "@@ -1098,15 +1088,15 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t index)",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "1fecf5d0e681a266ea6adb6ae3c695b404cd3b94",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed",
    "created_at": "2019-11-20T17:31:36Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646964",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646964"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646964"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646964/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1091,
    "side": "RIGHT",
    "in_reply_to_id": 348611654
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646993",
    "pull_request_review_id": 320146783,
    "id": 348646993,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0Njk5Mw==",
    "diff_hunk": "@@ -1108,7 +1109,9 @@ void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, cons\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_reserved_key_to_index[nIndex];",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 24,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-11-20T17:31:41Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646993",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646993"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348646993"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348646993/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1112,
    "side": "RIGHT",
    "in_reply_to_id": 348622786
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647019",
    "pull_request_review_id": 320146823,
    "id": 348647019,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0NzAxOQ==",
    "diff_hunk": "@@ -1088,15 +1088,16 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex)\n {\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    m_reserved_key_to_index.erase(nIndex);\n     WalletLogPrintf(\"keypool keep %d\\n\", nIndex);\n }\n \n-void LegacyScriptPubKeyMan::ReturnDestination(int64_t index, bool internal, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::ReturnDestination(int64_t nIndex, bool fInternal, const CTxDestination& addr)",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-11-20T17:31:44Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647019",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647019"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647019"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647019/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1100,
    "side": "RIGHT",
    "in_reply_to_id": 348626943
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647055",
    "pull_request_review_id": 320146872,
    "id": 348647055,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0NzA1NQ==",
    "diff_hunk": "@@ -1088,15 +1088,16 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t index)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex)",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8707ba99cf78c556ddda42bf74ddcda164ec9db9",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed",
    "created_at": "2019-11-20T17:31:49Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647055",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647055"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647055"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1090,
    "side": "RIGHT",
    "in_reply_to_id": 348360598
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647091",
    "pull_request_review_id": 320146927,
    "id": 348647091,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY0NzA5MQ==",
    "diff_hunk": "@@ -1185,6 +1186,7 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        m_reserved_key_to_index[nIndex] = keypool.vchPubKey.GetID();",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "oops fixed",
    "created_at": "2019-11-20T17:31:55Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647091",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647091"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348647091"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348647091/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1184,
    "side": "RIGHT",
    "in_reply_to_id": 348202544
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348658200",
    "pull_request_review_id": 320161269,
    "id": 348658200,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODY1ODIwMA==",
    "diff_hunk": "@@ -3252,9 +3250,10 @@ bool ReserveDestination::GetReservedDestination(const OutputType type, CTxDestin\n         return false;\n     }\n \n-\n     if (nIndex == -1)\n     {\n+        m_spk_man->TopUp();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "d195dcf841e4037a517ead16db063db9d496b42b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done as #17537",
    "created_at": "2019-11-20T17:55:22Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348658200",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348658200"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r348658200"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348658200/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 3255,
    "side": "RIGHT",
    "in_reply_to_id": 348598174
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349634553",
    "pull_request_review_id": 321597340,
    "id": 349634553,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0OTYzNDU1Mw==",
    "diff_hunk": "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
    "path": "src/wallet/scriptpubkeyman.h",
    "position": null,
    "original_position": 14,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "s/m_reserved_key_to_index/m_index_to_pool_key/ ? As-is I expected it to be a map from keys to index...",
    "created_at": "2019-11-22T14:53:49Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r349634553",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349634553"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r349634553"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349634553/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 250,
    "side": "RIGHT",
    "in_reply_to_id": 348202997
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349639850",
    "pull_request_review_id": 321597340,
    "id": 349639850,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0OTYzOTg1MA==",
    "diff_hunk": "@@ -1108,7 +1109,9 @@ void LegacyScriptPubKeyMan::ReturnDestination(int64_t nIndex, bool fInternal, co\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_reserved_key_to_index.at(nIndex);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "b4696cd3aaadc5dfb449f7c0de295a7b2d074243",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Do we really want to crash if that entry doesn't exist?\r\n\r\nI guess this is supposed to never happen, since `nIndex==-1` unless it was set otherwise in `GetReservedDestination` where `m_reserved_key_to_index` is also populated.\r\n\r\n",
    "created_at": "2019-11-22T15:03:37Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r349639850",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349639850"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r349639850"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349639850/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1114,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493216",
    "pull_request_review_id": 322666939,
    "id": 350493216,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDQ5MzIxNg==",
    "diff_hunk": "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "c593c2e96351677821e367a6c7aae1ca58f81ff7",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (c593c2e96351677821e367a6c7aae1ca58f81ff7)\r\n\r\nWould move this call outside the assert. It's bad to execute code that has side effects in an assert because in a build with NDEBUG defined it the code will be skipped. We don't support these builds currently, but we may in the future, and it's bad that the breakage caused by this could be subtle and hard to debug.\r\n\r\nAlso, running code in an assert can be bad for readability if you are used to being able to skim past logic in assert statements.",
    "created_at": "2019-11-26T00:38:42Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350493216",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493216"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350493216"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493216/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1106,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493783",
    "pull_request_review_id": 322666939,
    "id": 350493783,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDQ5Mzc4Mw==",
    "diff_hunk": "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "c593c2e96351677821e367a6c7aae1ca58f81ff7",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (c593c2e96351677821e367a6c7aae1ca58f81ff7)\r\n\r\nThis commit doesn't compile because m_reserved_key_to_index isn't defined yet.",
    "created_at": "2019-11-26T00:41:15Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350493783",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493783"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350493783"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350493783/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1106,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495492",
    "pull_request_review_id": 322666939,
    "id": 350495492,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDQ5NTQ5Mg==",
    "diff_hunk": "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));\n+    LearnAllRelatedScripts(pk);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "c593c2e96351677821e367a6c7aae1ca58f81ff7",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (c593c2e96351677821e367a6c7aae1ca58f81ff7)\r\n\r\nI don't like calling LearnAllRelatedScripts here. There's no reason for nonsense scripts to be added to memory, and it's crazy when wallet code just does random stuff like this with no explanation. Also I don't think this PR needs to be subtly changing behavior more than its already doing, especially without being explained or even mentioned in the commit.",
    "created_at": "2019-11-26T00:48:43Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350495492",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495492"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350495492"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1107,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495953",
    "pull_request_review_id": 322666939,
    "id": 350495953,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDQ5NTk1Mw==",
    "diff_hunk": "@@ -3302,23 +3302,21 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }\n     assert(vchPubKey.IsValid());\n-    address = GetDestinationForKey(vchPubKey, type);\n-    dest = address;\n     return true;\n }\n \n void ReserveDestination::KeepDestination()\n {\n     if (nIndex != -1) {\n         m_spk_man->KeepDestination(nIndex);\n-        m_spk_man->LearnRelatedScripts(vchPubKey, type);",
    "path": "src/wallet/wallet.cpp",
    "position": 28,
    "original_position": 22,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "c593c2e96351677821e367a6c7aae1ca58f81ff7",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (c593c2e96351677821e367a6c7aae1ca58f81ff7)\r\n\r\nSecond half of the commit message \"There is a minor change in behavior\" is now out of date and should be updated.",
    "created_at": "2019-11-26T00:50:38Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350495953",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495953"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350495953"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350495953/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3324,
    "original_line": 3321,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350555210",
    "pull_request_review_id": 322744363,
    "id": 350555210,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDU1NTIxMA==",
    "diff_hunk": "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));\n+    LearnAllRelatedScripts(pk);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "c593c2e96351677821e367a6c7aae1ca58f81ff7",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't see a good way to fix that. i don't really like adding the type as an argument to KeepDestination as it isn't useful in other ScriptPubKeyMans.\r\n\r\nThis also doesn't actually change anything since those scripts are already in memory as they are added via `ImplicitlyLearnRelatedScripts` which is called during key loading. This just writes them to the wallet file.",
    "created_at": "2019-11-26T05:58:33Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350555210",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350555210"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350555210"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350555210/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1107,
    "side": "RIGHT",
    "in_reply_to_id": 350495492
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350710206",
    "pull_request_review_id": 322940149,
    "id": 350710206,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDcxMDIwNg==",
    "diff_hunk": "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));\n+    LearnAllRelatedScripts(pk);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "c593c2e96351677821e367a6c7aae1ca58f81ff7",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> This just writes them to the wallet file.\r\n\r\nWow, that is even worse. If you think this is a good idea please add a comment here explaining that this is doing something nonsensical because design considerations make it not possible for the `KeepDestination` function to be aware of the destination type.\r\n\r\nBut I'd encourage you to take a look at my straight refactoring of this code in https://github.com/ryanofsky/bitcoin/commits/review.17373.6-fix which doesn't change behavior, doesn't write garbage to files with no explanation, but does (yes) add a `type` context parameter to the `KeepDestination` function, exactly analogous to the `internal` context parameter passed to `ReturnDestination` function, with the understanding that the whole point of having a ScriptPubKeyMan virtual class is to have subclasses that will be implemented differently, and not every implementation will require the exact same information do to every operation.",
    "created_at": "2019-11-26T12:25:25Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350710206",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350710206"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350710206"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350710206/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1107,
    "side": "RIGHT",
    "in_reply_to_id": 350495492
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870174",
    "pull_request_review_id": 323144039,
    "id": 350870174,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDg3MDE3NA==",
    "diff_hunk": "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "c593c2e96351677821e367a6c7aae1ca58f81ff7",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-11-26T17:03:51Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870174",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870174"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870174"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1106,
    "side": "RIGHT",
    "in_reply_to_id": 350493216
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870216",
    "pull_request_review_id": 323144094,
    "id": 350870216,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDg3MDIxNg==",
    "diff_hunk": "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "c593c2e96351677821e367a6c7aae1ca58f81ff7",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed",
    "created_at": "2019-11-26T17:03:55Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870216",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870216"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870216"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870216/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1106,
    "side": "RIGHT",
    "in_reply_to_id": 350493783
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870468",
    "pull_request_review_id": 323144447,
    "id": 350870468,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDg3MDQ2OA==",
    "diff_hunk": "@@ -1101,6 +1102,9 @@ void LegacyScriptPubKeyMan::KeepKey(int64_t nIndex)\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    CPubKey pk;\n+    assert(GetPubKey(m_reserved_key_to_index.at(nIndex), pk));\n+    LearnAllRelatedScripts(pk);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "c593c2e96351677821e367a6c7aae1ca58f81ff7",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't see how this is at all \"nonsensical\" or \"even worse'. But whatever, I've learned my lesson from the multiple days spent stuck on `TopUp()` so it's changed.",
    "created_at": "2019-11-26T17:04:29Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870468",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870468"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350870468"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350870468/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1107,
    "side": "RIGHT",
    "in_reply_to_id": 350495492
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350986220",
    "pull_request_review_id": 323292818,
    "id": 350986220,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDk4NjIyMA==",
    "diff_hunk": "@@ -1091,6 +1092,7 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& ty\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    LearnRelatedScripts(pubkey, type);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 62,
    "original_position": 21,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "094f0545d2d1309ad85eb66f107dec52746490df",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (094f0545d2d1309ad85eb66f107dec52746490df)\r\n\r\nCommit description \"There is a minor change in behavior\" seems out of date. Would just say \"This commit does not change behavior\".\r\n\r\nThe previous description was referring to LearnRelatedScripts call moving under the GetReservedDestination `nIndex == -1` check in the old version of this PR before #17237.\r\n\r\n\r\n",
    "created_at": "2019-11-26T21:22:39Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350986220",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350986220"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350986220"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350986220/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1098,
    "original_line": 1098,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350987323",
    "pull_request_review_id": 323292818,
    "id": 350987323,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MDk4NzMyMw==",
    "diff_hunk": "@@ -1087,16 +1087,19 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& type, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& type)",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 54,
    "original_position": 5,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8e70f2b4150ca2d25f06cc65295cb27a86c49681",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Change ReturnDestination interface to take address instead of key\" (8e70f2b4150ca2d25f06cc65295cb27a86c49681)\r\n\r\nThis should call `m_reserved_key_to_index.erase(nIndex);` to clean up",
    "created_at": "2019-11-26T21:25:25Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350987323",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350987323"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r350987323"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/350987323/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1090,
    "original_line": 1090,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351328532",
    "pull_request_review_id": 323727636,
    "id": 351328532,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTMyODUzMg==",
    "diff_hunk": "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
    "path": "src/wallet/scriptpubkeyman.h",
    "position": null,
    "original_position": 14,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "as noted a few days ago, this should be renamed",
    "created_at": "2019-11-27T14:47:19Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351328532",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351328532"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351328532"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351328532/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 250,
    "side": "RIGHT",
    "in_reply_to_id": 348202997
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379175",
    "pull_request_review_id": 323793455,
    "id": 351379175,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTM3OTE3NQ==",
    "diff_hunk": "@@ -1091,6 +1092,7 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& ty\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    LearnRelatedScripts(pubkey, type);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 62,
    "original_position": 21,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "094f0545d2d1309ad85eb66f107dec52746490df",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2019-11-27T16:15:23Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379175",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379175"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379175"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379175/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1098,
    "original_line": 1098,
    "side": "RIGHT",
    "in_reply_to_id": 350986220
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379228",
    "pull_request_review_id": 323793515,
    "id": 351379228,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTM3OTIyOA==",
    "diff_hunk": "@@ -1087,16 +1087,19 @@ void LegacyScriptPubKeyMan::AddKeypoolPubkeyWithDB(const CPubKey& pubkey, const\n     m_pool_key_to_index[pubkey.GetID()] = index;\n }\n \n-void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& type, const CPubKey& pubkey)\n+void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& type)",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 54,
    "original_position": 5,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "8e70f2b4150ca2d25f06cc65295cb27a86c49681",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2019-11-27T16:15:27Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379228",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379228"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379228"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379228/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1090,
    "original_line": 1090,
    "side": "RIGHT",
    "in_reply_to_id": 350987323
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379620",
    "pull_request_review_id": 323794018,
    "id": 351379620,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MTM3OTYyMA==",
    "diff_hunk": "@@ -246,6 +246,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     std::set<int64_t> set_pre_split_keypool GUARDED_BY(cs_wallet);\n     int64_t m_max_keypool_index GUARDED_BY(cs_wallet) = 0;\n     std::map<CKeyID, int64_t> m_pool_key_to_index;\n+    // Tracks keypool indexes to CKeyIDs of keys that have been taken out of the keypool but may be returned to it\n+    std::map<int64_t, CKeyID> m_reserved_key_to_index;",
    "path": "src/wallet/scriptpubkeyman.h",
    "position": null,
    "original_position": 14,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "06d411488c1c669f00a1c947416267941dbb7f7b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Renamed it.",
    "created_at": "2019-11-27T16:16:08Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379620",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379620"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r351379620"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/351379620/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 250,
    "side": "RIGHT",
    "in_reply_to_id": 348202997
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352074009",
    "pull_request_review_id": 324640823,
    "id": 352074009,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjA3NDAwOQ==",
    "diff_hunk": "@@ -3305,31 +3305,27 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n         if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n-        vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n         address = dest;\n     }\n-    assert(vchPubKey.IsValid());",
    "path": "src/wallet/wallet.cpp",
    "position": 18,
    "original_position": 8,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "5a8a2f20b4408ae71750a3254a4b74cc6d5b1bf3",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Note to other reviewers: this assert is lost, but `GetReservedDestination` calls `ReserveKeyFromKeyPool` which throws if `!keypool.vchPubKey.IsValid()`",
    "created_at": "2019-11-29T10:37:54Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352074009",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352074009"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352074009"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352074009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3314,
    "original_line": 3314,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352391220",
    "pull_request_review_id": 324982208,
    "id": 352391220,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjM5MTIyMA==",
    "diff_hunk": "@@ -3302,23 +3302,21 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }",
    "path": "src/wallet/wallet.cpp",
    "position": 17,
    "original_position": 11,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "393315354da454eb0f9322b92ad736bd23606f97",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"Key pool: Move LearnRelated and GetDestination calls\" (393315354da454eb0f9322b92ad736bd23606f97\r\n\r\nDo we need:\r\n\r\n```diff\r\n@@ -3308,6 +3308,8 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\r\n         vchPubKey = keypool.vchPubKey;\r\n         fInternal = keypool.fInternal;\r\n         address = dest;\r\n+    } else {\r\n+        dest = address;\r\n     }\r\n     assert(vchPubKey.IsValid());\r\n     return true;\r\n```\r\n\r\nIt seems like `dest` is currently left unset in the `nIndex != -1` case where previously it was always set.\r\n\r\nEDIT: Actually a better fix would probably be to undelete the previous `dest = address;` line below and pass `address` instead of `dest` to `GetReservedDestination`",
    "created_at": "2019-12-02T01:24:36Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352391220",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352391220"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352391220"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352391220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3309,
    "original_line": 3309,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352640636",
    "pull_request_review_id": 325295800,
    "id": 352640636,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjY0MDYzNg==",
    "diff_hunk": "@@ -3302,23 +3302,21 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }",
    "path": "src/wallet/wallet.cpp",
    "position": 17,
    "original_position": 11,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "393315354da454eb0f9322b92ad736bd23606f97",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done as suggested.",
    "created_at": "2019-12-02T14:56:58Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352640636",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352640636"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352640636"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352640636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3309,
    "original_line": 3309,
    "side": "RIGHT",
    "in_reply_to_id": 352391220
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352703450",
    "pull_request_review_id": 325375630,
    "id": 352703450,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjcwMzQ1MA==",
    "diff_hunk": "@@ -1091,6 +1092,7 @@ void LegacyScriptPubKeyMan::KeepDestination(int64_t nIndex, const OutputType& ty\n     // Remove from key pool\n     WalletBatch batch(m_storage.GetDatabase());\n     batch.ErasePool(nIndex);\n+    LearnRelatedScripts(pubkey, type);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 62,
    "original_position": 21,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "094f0545d2d1309ad85eb66f107dec52746490df",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352391220\r\n\r\n> Done as suggested.\r\n\r\nNote: This change was done in the wrong commit \"Change ReturnDestination interface\" (82dbc9344c33217e01c16b27d1418f042d0d0d77) instead the suggested \"Move LearnRelated and GetDestination\" (393315354da454eb0f9322b92ad736bd23606f97), so `dest` return value is temporarily left unset by the earlier commit and then fixed again in a later unrelated commit. Would be nice to fix but not important.",
    "created_at": "2019-12-02T16:41:52Z",
    "updated_at": "2019-12-02T16:59:00Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352703450",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352703450"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352703450"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352703450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1098,
    "original_line": 1098,
    "side": "RIGHT",
    "in_reply_to_id": 350986220
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352713871",
    "pull_request_review_id": 325388331,
    "id": 352713871,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjcxMzg3MQ==",
    "diff_hunk": "@@ -3302,23 +3302,21 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, dest, nIndex, keypool)) {\n             return false;\n         }\n         vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n+        address = dest;\n     }",
    "path": "src/wallet/wallet.cpp",
    "position": 17,
    "original_position": 11,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "393315354da454eb0f9322b92ad736bd23606f97",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oops, moved it to the right commit.",
    "created_at": "2019-12-02T16:59:47Z",
    "updated_at": "2019-12-02T16:59:48Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352713871",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352713871"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352713871"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352713871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3309,
    "original_line": 3309,
    "side": "RIGHT",
    "in_reply_to_id": 352391220
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352719014",
    "pull_request_review_id": 325395003,
    "id": 352719014,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MjcxOTAxNA==",
    "diff_hunk": "@@ -3298,43 +3298,34 @@ bool ReserveDestination::GetReservedDestination(CTxDestination& dest, bool inter\n         return false;\n     }\n \n-    if (!pwallet->CanGetAddresses(internal)) {\n-        return false;\n-    }\n \n     if (nIndex == -1)\n     {\n         CKeyPool keypool;\n-        if (!m_spk_man->GetReservedDestination(type, internal, nIndex, keypool)) {\n+        if (!m_spk_man->GetReservedDestination(type, internal, address, nIndex, keypool)) {\n             return false;\n         }\n-        vchPubKey = keypool.vchPubKey;\n         fInternal = keypool.fInternal;\n     }\n-    assert(vchPubKey.IsValid());\n-    address = GetDestinationForKey(vchPubKey, type);\n     dest = address;",
    "path": "src/wallet/wallet.cpp",
    "position": 20,
    "original_position": 20,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "future work: address vs dest clarification via renaming would be great, even just `m_dest` vs `dest`",
    "created_at": "2019-12-02T17:09:58Z",
    "updated_at": "2019-12-02T17:10:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352719014",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352719014"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r352719014"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/352719014/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3310,
    "original_line": 3310,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354953549",
    "pull_request_review_id": 328357774,
    "id": 354953549,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NDk1MzU0OQ==",
    "diff_hunk": "@@ -1112,13 +1112,15 @@ void LegacyScriptPubKeyMan::ReturnKey(int64_t nIndex, bool fInternal, const CPub\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_index_to_reserved_key.at(nIndex);\n+        m_pool_key_to_index[pubkey_id] = nIndex;\n+        m_index_to_reserved_key.erase(nIndex);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 79,
    "original_position": 79,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, could avoid 2nd lookup:\r\n```\r\nauto it = find(index)\r\n...\r\nerase(it)\r\n```",
    "created_at": "2019-12-06T17:46:20Z",
    "updated_at": "2019-12-06T17:51:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354953549",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354953549"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354953549"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354953549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1117,
    "original_line": 1117,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354954643",
    "pull_request_review_id": 328357774,
    "id": 354954643,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NDk1NDY0Mw==",
    "diff_hunk": "@@ -1179,6 +1181,8 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        assert(m_index_to_reserved_key.count(nIndex) == 0);\n+        m_index_to_reserved_key[nIndex] = keypool.vchPubKey.GetID();",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 104,
    "original_position": 104,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, could also avoid 2nd lookup:\r\n```\r\nauto res = emplace(nIndex, ...)\r\nassert(res.second)\r\n```",
    "created_at": "2019-12-06T17:49:05Z",
    "updated_at": "2019-12-06T17:51:33Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354954643",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354954643"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354954643"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354954643/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1185,
    "original_line": 1185,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960510",
    "pull_request_review_id": 328366714,
    "id": 354960510,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NDk2MDUxMA==",
    "diff_hunk": "@@ -1112,13 +1112,15 @@ void LegacyScriptPubKeyMan::ReturnKey(int64_t nIndex, bool fInternal, const CPub\n         } else {\n             setExternalKeyPool.insert(nIndex);\n         }\n-        m_pool_key_to_index[pubkey.GetID()] = nIndex;\n+        CKeyID& pubkey_id = m_index_to_reserved_key.at(nIndex);\n+        m_pool_key_to_index[pubkey_id] = nIndex;\n+        m_index_to_reserved_key.erase(nIndex);",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 79,
    "original_position": 79,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Leaving as is to keep ACKs",
    "created_at": "2019-12-06T18:03:32Z",
    "updated_at": "2019-12-06T18:03:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354960510",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960510"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354960510"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960510/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1117,
    "original_line": 1117,
    "side": "RIGHT",
    "in_reply_to_id": 354953549
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960526",
    "pull_request_review_id": 328366744,
    "id": 354960526,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1NDk2MDUyNg==",
    "diff_hunk": "@@ -1179,6 +1181,8 @@ bool LegacyScriptPubKeyMan::ReserveKeyFromKeyPool(int64_t& nIndex, CKeyPool& key\n             throw std::runtime_error(std::string(__func__) + \": keypool entry invalid\");\n         }\n \n+        assert(m_index_to_reserved_key.count(nIndex) == 0);\n+        m_index_to_reserved_key[nIndex] = keypool.vchPubKey.GetID();",
    "path": "src/wallet/scriptpubkeyman.cpp",
    "position": 104,
    "original_position": 104,
    "commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "original_commit_id": "886f1731bec4393dd342403ac34069a3a4f95eea",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Leaving as is to keep ACKs",
    "created_at": "2019-12-06T18:03:36Z",
    "updated_at": "2019-12-06T18:03:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354960526",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960526"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17373#discussion_r354960526"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17373"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/354960526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1185,
    "original_line": 1185,
    "side": "RIGHT",
    "in_reply_to_id": 354954643
  }
]