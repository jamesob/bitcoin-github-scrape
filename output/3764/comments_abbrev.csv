laanwj,2014-02-28T08:48:27Z,"I like the idea of logging node IDs instead of logging IP addresses.\n\nIn principle, all `-logips` then has to do is log a node ID to IP:port mapping once on connection and it's possible to figure out the IPs if necessary (Though it may be more useful in practice to actually log IPs in every message anyway).\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36331603,36331603,
sipa,2014-02-28T13:04:04Z,Concept ACK; I haven't reviewed the code\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36348179,36348179,
rebroad,2014-02-28T18:29:10Z,"@laanwj yes, could make -logips display IPs instead of NodeIDs, if this is what most people want. I went with just correlating them once (upon first connection). so that it keeps the debug.log more readable and smaller in size, but the info is still there if it needs to be referenced.\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36379785,36379785,
luke-jr,2014-02-28T18:30:53Z,node=(IP-or-id) seems ideal to me\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36379964,36379964,
rebroad,2014-02-28T18:32:48Z,@luke-jr = instead of : ?\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36380155,36380155,
luke-jr,2014-02-28T18:35:05Z,@rebroad Whatever matches the existing style. The points I was making were 1) use the same key whether showing ID or IP; 2) show IP in every place ID would normally be\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36380372,36380372,
rebroad,2014-02-28T19:13:45Z,@luke-jr Now using node=\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36384205,36384205,
rebroad,2014-02-28T23:10:53Z,"@luke-jr has suggested that the IP address could be added to each and every line of debug.log instead of the node number, whereas I prefer that debug.log correlates the node number with the IP address only once, so reduce debug.log output and to make it more readable.\n\nCan I seek consensus on this please? I'm happy to adapt this pull to the majority preference.\n\n(Luke's suggestion might possib",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36404289,36404289,
laanwj,2014-03-01T07:36:46Z,"I like the approach of logging the IP:port info for a node only once, on connection. \nAfter that, log only the Node ID for messages concerning that node. \n\nThis minimizes the code difference between the `-logips` and `-nologips` case (ie: one message) and avoids ugly if() statements duplicating the debug message apart from the IP information...\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36418761,36418761,
gmaxwell,2014-03-01T20:40:51Z,"I like the general ID of always logging a node ID with every message we emit which can be resolved against getpeerinfo— enabling after the fact diagnosis of a source while the client is still up. It needs to be a nonce though, not a sequential ID or we can correlate them based on connect time. The the logips logging can just make the connect message emit the nodeids.\n\nThere is some privacy leak,",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36435897,36435897,
rebroad,2014-03-02T00:30:17Z,@gmaxwell I'm not sure I understand you. How would a nonce be more useful than the node id? How/when/where would you want getpeerinfo to be used?\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36441770,36441770,
gmaxwell,2014-03-02T01:05:17Z,"I'm not sure what you don't understand.  Right now the connect messages show IPs and so you get some good idea of what order nodes are, so the IDs would be linking. Thats bad. Additionally, esp if we later add crypto, I worry about metadata only attackers who can observe what order people connected in.  The linkage between IDs and IPs should not be externally observable.\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36442478,36442478,
rebroad,2014-03-02T07:31:34Z,"@gmaxwell the IPs as they are currently shown will no longer be shown by default once this patch is applied, only when the -logips option is given for the very reasons you mention.\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36448272,36448272,
gmaxwell,2014-03-02T10:17:54Z,"Can you please reread my answer, including the second half of it?\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36450677,36450677,
ghost,2014-03-02T18:47:38Z,"Wouldn't these changes like this make the current ongoing mtgox\ninvestigations harder why is this even being prioritized.\nOn Mar 2, 2014 1:44 PM, ""R E Broadley"" notifications@github.com wrote:\n\n> @gmaxwell https://github.com/gmaxwell I already read your answer 3\n> times, and on the 4th reading my interpretation of it is no different.\n> \n> ## \n> \n> Reply to this email directly or view it o",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36462342,36462342,
laanwj,2014-03-03T06:20:22Z,"No priority IMO, this is just @rebroad's pet peeve.\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36484318,36484318,
gmaxwell,2014-03-03T06:25:59Z,"@rebroad ""Additionally, esp if we later add crypto, I worry about metadata only attackers who can observe what order people connected in. The linkage between IDs and IPs should not be externally observable.""   someone watching who connects in what order would know the IDs even if they didn't know the content of the messages. getting the logs would tell them the content.\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36484527,36484527,
luke-jr,2014-03-03T06:37:02Z,Logging IPs is a security regression IMO.\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36484909,36484909,
laanwj,2014-03-03T06:43:14Z,"Thinking about it, we already concluded in #3741: \n- The point was to not log IPs (esp. those associated with transactions) by default\n- We are logging almost no IPs _by default_ already: only on connect and some kinds of misbehavior:\n  - Nearly all of the messages affected in this pull are only logged when specific debug classes (mempool, net) are active\n\nSo I'm not entirely sure what is the",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36485132,36485132,
rebroad,2014-03-03T18:25:00Z,"@gmaxwell I'm not understanding what you're not understanding. There would be no linkage as you mention unless this optional command line argument is given. Logging which node is doing what is a useful debugging too, especially when working on code such as parallel block download or anything which needs to correlate what was sent to nodes and what was received from nodes. It needs to be a debug op",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36540756,36540756,
sipa,2014-03-03T19:08:31Z,"@rebroad: @gmaxwell is saying that if someone is able to monitor your network activity (just metadata, nor the actual traffic) + has access to these logs (even without `-logips`) this would allow reconstructing which nodes were talking to eachother.\n\nI personally think this is a very limited problem, and the solution suggested (using random instead of sequentially assigned identifiers) doesn't h",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36546521,36546521,
rebroad,2014-03-03T23:47:03Z,"@sipa thanks. So, from the sounds of what you're saying, it doesn't sound like I can make any further improvements to this pull request?\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-36575873,36575873,
rebroad,2014-04-02T00:44:47Z,"@laanjw - this is primarily motivated by helping to debug block sync. Would it be better if it wasn't displayed in the commandline help, and perhaps only displayed node id for blocks and not for txs?\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-39278020,39278020,
sipa,2014-04-06T14:19:18Z,"ACK, apart from minor nit above.\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-39669531,39669531,
rebroad,2014-04-30T06:14:28Z,@sipa Hopefully I've addressed your minor nit.\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-41764092,41764092,
rebroad,2014-05-09T01:52:32Z,What is holding this up please?\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-42626498,42626498,
rebroad,2014-05-16T02:37:06Z,"@sipa @laanwj Ok, I've just rebased this again. Is there anything still holding this up?\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-43289619,43289619,
rebroad,2014-05-16T02:39:16Z,@luke-jr This pull request makes the logging of IPs optional instead of done by default as it currently is - so hopefully addresses your security concerns.\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-43289712,43289712,
luke-jr,2014-05-16T02:43:28Z,I know.\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-43289888,43289888,
sipa,2014-05-18T17:34:05Z,"I don't really care about adding an optional and by-default-off method for listing IPs. For debugging it is useful, and nobody will turn it on for any reason but that.\n\nThe arguments against even providing the ability to link log messages from the same node are interesting. I'm not sure it's such a big deal. If it is, maybe we can list the peer=id message piece only when -logips is provided as w",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-43445919,43445919,
rebroad,2014-05-21T11:40:51Z,@sipa point addressed all except the making the peer logged only if a command line option is specified. I can do this if it's preferred. What is the consensus on this? @gmaxwell @laanwj @luke-jr @gavinandresen @jgarzik ?\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-43743741,43743741,
rebroad,2014-06-28T02:49:32Z,"rebaed, and nits addressed.\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-47416133,47416133,
laanwj,2014-07-01T08:10:57Z,@rebroad you still need to define the IdentityNode function as suggested  by me/@sipa to avoid `if (fLogIPs)` all over the place.\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-47628510,47628510,
rebroad,2014-07-02T03:40:29Z,"@laanwj There is now only one place where there is an if (fLogIPs), so the function is not needed since this would add more code than it removes.\n",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-47734365,47734365,
BitcoinPullTester,2014-07-04T04:47:39Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p3764_2e36866fecb7420cd73047a7aa762a6e5e225695/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-te",https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-48008732,48008732,
gmaxwell,2014-07-15T13:54:23Z,Was was this merged without adding the peer index to getpeerinfo? The peer numbers given in the logs are not useful.\n,https://github.com/bitcoin/bitcoin/pull/3764#issuecomment-49034365,49034365,
laanwj,2014-03-01T07:38:50Z,"_If_ you want -logips to affect every one of these messages I'd suggest another implementation:\n- Define a function IdenfityNode or such that returns a string with either the node ID or IP, based on fLogIPs\n- Use this function in all the concerned debug messages\n\nThis avoids these kinds of duplicated messages everywhere.\n",https://github.com/bitcoin/bitcoin/pull/3764#discussion_r10189780,10189780,src/net.cpp
rebroad,2014-03-01T20:15:18Z,@laanwj Could you point me towards a function that already does this please?\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r10192283,10192283,src/net.cpp
laanwj,2014-03-02T09:57:48Z,You will have to implement it yourself. It doesn't exist yet.\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r10194802,10194802,src/net.cpp
sipa,2014-03-04T00:14:08Z,"Nit: I'd call it ""peer"" rather than ""node"". I know the source code is already confused in that regard, but it's not really an identifier of a particular node we're showing - just which # peer it is for us.\n",https://github.com/bitcoin/bitcoin/pull/3764#discussion_r10237015,10237015,src/main.cpp
sipa,2014-03-04T00:21:39Z,"Alternative: only have one place where the actual IP is logged.\n\nMy suggestion: in net.h, at the end of the CNode::CNode() constructor:\n\nif (hSocket != INVALID_SOCKET)\n    LogPrint(""net"", ""Added connection to %s peer=%d"", addrNameIn, id);\n",https://github.com/bitcoin/bitcoin/pull/3764#discussion_r10237275,10237275,src/net.cpp
sipa,2014-04-06T14:19:02Z,"Can you print the peer id instead of the ip here, in this case?\n",https://github.com/bitcoin/bitcoin/pull/3764#discussion_r11326357,11326357,src/net.cpp
sipa,2014-05-18T17:22:42Z,List the nodeid here as well? So you can correlate a messages back to what IP sent them if necessary (only with -logips) anyway.\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r12774602,12774602,src/net.cpp
sipa,2014-05-18T17:26:45Z,"```\n  std::string IdentityNode(const CNode *pnode) {\n    if (fLogIPs)\n      return pnode->addr.ToString();\n    else\n      return strprintf(""%d"", pnode->GetId());\n  }\n```\n\nUse a function like that, please?\n",https://github.com/bitcoin/bitcoin/pull/3764#discussion_r12774613,12774613,src/net.cpp
sipa,2014-05-18T17:28:00Z,Why?\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r12774618,12774618,src/net.h
sipa,2014-05-18T17:28:27Z,Optional: the .c_str() could be dropped here.\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r12774620,12774620,src/net.h
rebroad,2014-05-21T11:34:42Z,done\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r12891540,12891540,src/net.cpp
rebroad,2014-05-21T11:34:53Z,mistake. undone.\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r12891545,12891545,src/net.h
rebroad,2014-05-21T11:38:19Z,done\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r12891646,12891646,src/net.h
laanwj,2014-06-27T13:55:28Z,@sipa agreed\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r14293338,14293338,src/net.cpp
Diapolo,2014-07-01T11:34:55Z,Nit²: This needs to be placed above `-logtimestamps`.\n,https://github.com/bitcoin/bitcoin/pull/3764#discussion_r14399030,14399030,src/init.cpp
