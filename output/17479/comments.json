[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553988839",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-553988839",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 553988839,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1Mzk4ODgzOQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-14T17:18:17Z",
    "updated_at": "2019-11-14T17:18:17Z",
    "author_association": "MEMBER",
    "body": "This is the first two commits from #16279. Thanks for your work, @TheBlueMatt!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/553988839/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554036805",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554036805",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 554036805,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDAzNjgwNQ==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-14T19:15:18Z",
    "updated_at": "2020-08-25T03:20:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19791 ([net processing] Move Misbehaving() to PeerManager by jnewbery)\n* #15545 ([doc] explain why CheckBlock() is called before AcceptBlock by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554036805/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554084723",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554084723",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 554084723,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDA4NDcyMw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-14T21:19:41Z",
    "updated_at": "2019-11-14T21:19:41Z",
    "author_association": "MEMBER",
    "body": "I've added a commit that deduplicates post-block-checking code, which makes the main commit in this PR smaller and (I hope) easier to understand.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554084723/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554110522",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554110522",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 554110522,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDExMDUyMg==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-14T22:28:29Z",
    "updated_at": "2019-11-14T22:28:29Z",
    "author_association": "MEMBER",
    "body": "I've taken the final (behaviour change) commit from #16279 and PR'ed it as #17485. That gives some justification for this PR. If we get the anti-dos / mutation checks back from validation immediately, we can use that state to mark the block as no longer in-flight, rather than by indirectly checking that the block has been written to disk.\r\n\r\nSeparating into two PRs makes this easier to review. This PR should result in no behaviour changes (modulo the `BlockChecked()` callback in net processing now being called immediately instead of on the background scheduler thread), and the follow-up PR has the (minor) behaviour change along with lots of commenting and justification.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554110522/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554528497",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554528497",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 554528497,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDUyODQ5Nw==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-15T21:06:51Z",
    "updated_at": "2019-11-15T21:06:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "I found the last commit in this PR (71867666388bf1137b431f944fd430f262480eba) a bit hard to parse, so I split it up in my branch here: https://github.com/bitcoin/bitcoin/compare/master...dongcarl:2019-11-processnewblock-early-return-redo-last. The main change in the last commit on this branch resides in f46102be8fdd1ef8a21b821c121ed9fa027c9d32 on mine, and f46102be8fdd1ef8a21b821c121ed9fa027c9d32 also retains the same commit message. Feel free to use/use only to review/not use.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554528497/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554551727",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-554551727",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 554551727,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDU1MTcyNw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-15T22:19:05Z",
    "updated_at": "2019-11-15T22:19:05Z",
    "author_association": "MEMBER",
    "body": "Thanks for the branch @dongcarl ! I've reset to that and made a couple of minor comment changes.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554551727/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557700722",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-557700722",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 557700722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzcwMDcyMg==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-22T21:27:01Z",
    "updated_at": "2019-11-22T21:27:01Z",
    "author_association": "MEMBER",
    "body": "Thanks for the review @jkczyz . I've updated the function comment to be less redundant.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557700722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/567627381",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-567627381",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 567627381,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NzYyNzM4MQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-19T19:23:12Z",
    "updated_at": "2019-12-19T19:23:12Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/567627381/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598904334",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-598904334",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 598904334,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODkwNDMzNA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-13T20:46:18Z",
    "updated_at": "2020-03-13T20:46:18Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598904334/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602137630",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-602137630",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 602137630,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjEzNzYzMA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-22T02:18:49Z",
    "updated_at": "2020-03-22T02:18:49Z",
    "author_association": "MEMBER",
    "body": "Thanks :octopus: . I've rebased on master.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602137630/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614274230",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-614274230",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 614274230,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDI3NDIzMA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-15T20:52:55Z",
    "updated_at": "2020-04-15T20:52:55Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614274230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614853019",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-614853019",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 614853019,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDg1MzAxOQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-16T19:33:07Z",
    "updated_at": "2020-04-16T19:33:07Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614853019/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628872357",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-628872357",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 628872357,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyODg3MjM1Nw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-14T20:34:07Z",
    "updated_at": "2020-05-14T20:34:07Z",
    "author_association": "MEMBER",
    "body": "Oops. Bad rebase. Should be fixed now.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/628872357/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655319425",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-655319425",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 655319425,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NTMxOTQyNQ==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-08T06:37:47Z",
    "updated_at": "2020-07-08T06:37:47Z",
    "author_association": "MEMBER",
    "body": "Concept ACK, will review after rebase.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655319425/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/657247766",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-657247766",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 657247766,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NzI0Nzc2Ng==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-12T16:47:53Z",
    "updated_at": "2020-07-12T16:47:53Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/657247766/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658293827",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-658293827",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 658293827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODI5MzgyNw==",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?u=62e3204f6586795420395a7059ec7dc7c4a40c7d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-14T16:54:19Z",
    "updated_at": "2020-07-14T16:54:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Took some time to prove to myself that there are no unintended behaviour changes. It wasn't obvious to me that 5e5d58c829001a774e2481a4a8c3598917b06e53 is trivially correct, so I'm most likely missing some context here.\r\n\r\nMy understanding is that prior to 5e5d58c829001a774e2481a4a8c3598917b06e53, `BlockChecked` is only called when `CheckBlock` or `AcceptBlock` returns false in `ProcessNewBlock`, causing `ProcessNewBlock` to return early right after calling `BlockChecked`.\r\n\r\nHowever, it seems that after 5e5d58c829001a774e2481a4a8c3598917b06e53, it is possible for both `CheckBlock` and `AcceptBlock` to return true, but for `dos_state.IsValid()` to be false, causing `BlockChecked` to be called in `BlockProcessed` where it wouldn't have before. Perhaps this is fine and intended, but I just wanted to make sure.\r\n\r\nHere's the diff I used for testing, and it seems to fail at `validation_block_tests/processnewblock_signals_ordering`:\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex 524ae94b9a..3f5737fd35 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -3856,9 +3856,11 @@ bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const s\r\n             ret = ::ChainstateActive().AcceptBlock(pblock, dos_state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\r\n         }\r\n         if (!ret) {\r\n+            assert(!dos_state.IsValid());  // We should always trigger BlockChecked in BlockProcessed in this codepath\r\n             return error(\"%s: AcceptBlock FAILED (%s)\", __func__, dos_state.ToString());\r\n         }\r\n     }\r\n+    assert(dos_state.IsValid());  // We should NOT trigger BlockChecked in BlockProcessed in this codepath\r\n \r\n     NotifyHeaderTip();\r\n \r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/658293827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659433523",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-659433523",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 659433523,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1OTQzMzUyMw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-16T14:03:02Z",
    "updated_at": "2020-07-16T14:03:02Z",
    "author_association": "MEMBER",
    "body": "The first commit has now been merged in #19533. I've rebased the remaining commits on master.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659433523/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/679162173",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-679162173",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 679162173,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3OTE2MjE3Mw==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-24T14:30:38Z",
    "updated_at": "2020-08-24T14:30:38Z",
    "author_association": "MEMBER",
    "body": "rebased",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/679162173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688452423",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-688452423",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 688452423,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODQ1MjQyMw==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-07T17:41:21Z",
    "updated_at": "2020-09-07T17:41:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n\ud83d\udc19 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/688452423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693284719",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#issuecomment-693284719",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17479",
    "id": 693284719,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MzI4NDcxOQ==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-16T09:21:37Z",
    "updated_at": "2020-09-16T09:21:37Z",
    "author_association": "MEMBER",
    "body": "I'm focused on other things right now, so I'm going to close this with the intention of opening it again at some point in the future.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/693284719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347011474",
    "pull_request_review_id": 317869779,
    "id": 347011474,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzAxMTQ3NA==",
    "diff_hunk": "@@ -199,22 +199,33 @@ static const uint64_t MIN_DISK_SPACE_FOR_BLOCK_FILES = 550 * 1024 * 1024;\n  * block is made active. Note that it does not, however, guarantee that the\n  * specific block passed to it has been checked for validity!\n  *\n- * If you want to *possibly* get feedback on whether pblock is valid, you must\n- * install a CValidationInterface (see validationinterface.h) - this will have\n- * its BlockChecked method called whenever *any* block completes validation.\n+ * Performs initial sanity checks using the provided BlockValidationState before\n+ * connecting any block(s). If you want to *possibly* get feedback on whether\n+ * pblock is valid beyond just cursory mutation/DoS checks, you must install\n+ * a CValidationInterface (see validationinterface.h) - this will have its\n+ * BlockChecked method called whenever *any* block completes validation (note",
    "path": "src/validation.h",
    "position": null,
    "original_position": 11,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "71867666388bf1137b431f944fd430f262480eba",
    "user": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Perhaps I'm understanding wrong but this shouldn't apply anymore?",
    "created_at": "2019-11-15T21:07:35Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347011474",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347011474"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347011474"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347011474/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 205,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 154,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347035231",
    "pull_request_review_id": 317901418,
    "id": 347035231,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzAzNTIzMQ==",
    "diff_hunk": "@@ -199,22 +199,33 @@ static const uint64_t MIN_DISK_SPACE_FOR_BLOCK_FILES = 550 * 1024 * 1024;\n  * block is made active. Note that it does not, however, guarantee that the\n  * specific block passed to it has been checked for validity!\n  *\n- * If you want to *possibly* get feedback on whether pblock is valid, you must\n- * install a CValidationInterface (see validationinterface.h) - this will have\n- * its BlockChecked method called whenever *any* block completes validation.\n+ * Performs initial sanity checks using the provided BlockValidationState before\n+ * connecting any block(s). If you want to *possibly* get feedback on whether\n+ * pblock is valid beyond just cursory mutation/DoS checks, you must install\n+ * a CValidationInterface (see validationinterface.h) - this will have its\n+ * BlockChecked method called whenever *any* block completes validation (note",
    "path": "src/validation.h",
    "position": null,
    "original_position": 11,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "71867666388bf1137b431f944fd430f262480eba",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "BlockChecked is called for any block that we try to connect to the chain. See the call in `ConnectTip()`:\r\n\r\n- if the call to `ConnectBlock()` failed, then we'll call `BlockChecked()` with a state that is NOT `IsValid()`.\r\n- if the call to `ConnectBlock()` succeeded, then the block has been connected and is part of the main chain, and we'll call `BlockChecked()` with a state that IS `IsValid()`.\r\n\r\nNote that we may never even call `ConnectTip()` if we don't try to connect the block to the most work chain.",
    "created_at": "2019-11-15T22:23:13Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347035231",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347035231"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347035231"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347035231/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 205,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 154,
    "side": "RIGHT",
    "in_reply_to_id": 347011474
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347577049",
    "pull_request_review_id": 318587270,
    "id": 347577049,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU3NzA0OQ==",
    "diff_hunk": "@@ -784,6 +784,9 @@ static UniValue submitblock(const JSONRPCRequest& request)\n     if (!new_block && accepted) {\n         return \"duplicate\";\n     }\n+    if (!dos_state.IsValid()) {\n+        return BIP22ValidationResult(dos_state);",
    "path": "src/rpc/mining.cpp",
    "position": 22,
    "original_position": 5,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`submitblock_StateCacher` is the last client of validationinterface, I think we can go further, tweak it a bit and remove definitely `BlockChecked`, see : https://github.com/ariard/bitcoin/commits/2019-11-processnewblock-review\r\n(but maybe to include this in a follow-up cleanup PR?)",
    "created_at": "2019-11-18T19:50:34Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347577049",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347577049"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347577049"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347577049/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 971,
    "original_line": 971,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347580252",
    "pull_request_review_id": 318587270,
    "id": 347580252,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU4MDI1Mg==",
    "diff_hunk": "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {",
    "path": "src/net_processing.cpp",
    "position": 41,
    "original_position": 15,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Isn't this check break `BlockChecked` where we check `state.IsValid` for promoting peer to compact block announcement?",
    "created_at": "2019-11-18T19:57:34Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347580252",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347580252"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347580252"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347580252/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2101,
    "original_line": 2101,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347582776",
    "pull_request_review_id": 318587270,
    "id": 347582776,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzU4Mjc3Ng==",
    "diff_hunk": "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {\n+        // The block failed anti-dos / mutation checks. Call BlockChecked() callback here.\n+        // This clears the block from mapBlockSource.\n+        BlockChecked(*pblock, state, connman);\n+    } else if (!new_block) {\n+        // Block was valid but we've seen it before. Clear it from mapBlockSource.\n         LOCK(cs_main);\n         ::mapBlockSource.erase(pblock->GetHash());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Can't this branch combined with `BlockChecked` by passing new_block as param? Even wonder if we still need `fNewBlock` in PNB, as  `BlockChecked`  erase block from `mapBlockSource` independently of validity/novelty",
    "created_at": "2019-11-18T20:03:34Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347582776",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347582776"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347582776"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347582776/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2007,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347617540",
    "pull_request_review_id": 318640247,
    "id": 347617540,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzYxNzU0MA==",
    "diff_hunk": "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {",
    "path": "src/net_processing.cpp",
    "position": 41,
    "original_position": 15,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No. `BlockProcessed` is only called when `ProcessNewBlock()` returns early because the block failed `CheckBlock()` or `AcceptBlock()`. The logic you're talking about for promoting a peer to compact block announcement in `BlockChecked()` is only invoked when `BlockChecked()` is called after successfully connecting a valid block.",
    "created_at": "2019-11-18T21:25:55Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347617540",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347617540"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347617540"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347617540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2101,
    "original_line": 2101,
    "side": "RIGHT",
    "in_reply_to_id": 347580252
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347618870",
    "pull_request_review_id": 318640247,
    "id": 347618870,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzYxODg3MA==",
    "diff_hunk": "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {\n+        // The block failed anti-dos / mutation checks. Call BlockChecked() callback here.\n+        // This clears the block from mapBlockSource.\n+        BlockChecked(*pblock, state, connman);\n+    } else if (!new_block) {\n+        // Block was valid but we've seen it before. Clear it from mapBlockSource.\n         LOCK(cs_main);\n         ::mapBlockSource.erase(pblock->GetHash());",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 22,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`BlockChecked()` will only be called from `BlockProcessed()` if the block failed `CheckBlock()`/`AcceptBlock()`. This else branch is catching the case where the block didn't fail, but we've seen it before.\r\n\r\nIf you think this can be cleaned up further, perhaps we can do it in a follow-up PR.",
    "created_at": "2019-11-18T21:29:00Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347618870",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347618870"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347618870"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347618870/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2007,
    "side": "RIGHT",
    "in_reply_to_id": 347582776
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347619936",
    "pull_request_review_id": 318640247,
    "id": 347619936,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0NzYxOTkzNg==",
    "diff_hunk": "@@ -784,6 +784,9 @@ static UniValue submitblock(const JSONRPCRequest& request)\n     if (!new_block && accepted) {\n         return \"duplicate\";\n     }\n+    if (!dos_state.IsValid()) {\n+        return BIP22ValidationResult(dos_state);",
    "path": "src/rpc/mining.cpp",
    "position": 22,
    "original_position": 5,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, I was planning to do this as a follow-up PR.\r\n\r\nI've had a quick look at your branch. I think it misses breaks the 'promote to announcing compact blocks' behaviour. We'd want to move that to a different validation interface event (probably `UpdatedBlockTip()`)",
    "created_at": "2019-11-18T21:31:33Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347619936",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347619936"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r347619936"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/347619936/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 971,
    "original_line": 971,
    "side": "RIGHT",
    "in_reply_to_id": 347577049
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348037038",
    "pull_request_review_id": 319183434,
    "id": 348037038,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODAzNzAzOA==",
    "diff_hunk": "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {",
    "path": "src/net_processing.cpp",
    "position": 41,
    "original_position": 15,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Right, right, the call to `BlockChecked` is still in `ConnectTip` path on your branch. I still think that's counter-intuitive to have both peer punishment and compact blocks promotion in one function, so would be down to split in a follow-up PR and like you said previously rely on `UpdatedBlockTip` for the latter.",
    "created_at": "2019-11-19T16:38:50Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r348037038",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348037038"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r348037038"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348037038/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2101,
    "original_line": 2101,
    "side": "RIGHT",
    "in_reply_to_id": 347580252
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348038837",
    "pull_request_review_id": 319185866,
    "id": 348038837,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0ODAzODgzNw==",
    "diff_hunk": "@@ -784,6 +784,9 @@ static UniValue submitblock(const JSONRPCRequest& request)\n     if (!new_block && accepted) {\n         return \"duplicate\";\n     }\n+    if (!dos_state.IsValid()) {\n+        return BIP22ValidationResult(dos_state);",
    "path": "src/rpc/mining.cpp",
    "position": 22,
    "original_position": 5,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ah yes, agree with you, better to do it in a follow-up PR to avoid breaking things inadvertently.",
    "created_at": "2019-11-19T16:41:52Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r348038837",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348038837"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r348038837"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/348038837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 971,
    "original_line": 971,
    "side": "RIGHT",
    "in_reply_to_id": 347577049
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349358840",
    "pull_request_review_id": 321241524,
    "id": 349358840,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0OTM1ODg0MA==",
    "diff_hunk": "@@ -1888,16 +1888,23 @@ void static ProcessOrphanTx(CConnman* connman, std::set<uint256>& orphan_work_se\n }\n \n /**\n- *  A block has been processed. If this is the first time we've seen the block,\n+ *  A block has been processed. If the block was failed anti-dos / mutation checks, then\n+ *  call BlockChecked() to maybe punish peer. If this is the first time we've seen the block,\n  *  update the node's nLastBlockTime. Otherwise erase it from mapBlockSource.",
    "path": "src/net_processing.cpp",
    "position": null,
    "original_position": 7,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "jkczyz",
      "id": 4015903,
      "node_id": "MDQ6VXNlcjQwMTU5MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4015903?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jkczyz",
      "html_url": "https://github.com/jkczyz",
      "followers_url": "https://api.github.com/users/jkczyz/followers",
      "following_url": "https://api.github.com/users/jkczyz/following{/other_user}",
      "gists_url": "https://api.github.com/users/jkczyz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jkczyz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jkczyz/subscriptions",
      "organizations_url": "https://api.github.com/users/jkczyz/orgs",
      "repos_url": "https://api.github.com/users/jkczyz/repos",
      "events_url": "https://api.github.com/users/jkczyz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jkczyz/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The documentation strikes me as repetitive with the code. Perhaps it could be phrased differently such that if the code changes the comment doesn't need to be updated.\r\n\r\nnit: s/was failed/failed",
    "created_at": "2019-11-21T22:53:01Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r349358840",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349358840"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r349358840"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349358840/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 1891,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 1893,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349799232",
    "pull_request_review_id": 321816657,
    "id": 349799232,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0OTc5OTIzMg==",
    "diff_hunk": "@@ -784,6 +784,9 @@ static UniValue submitblock(const JSONRPCRequest& request)\n     if (!new_block && accepted) {\n         return \"duplicate\";\n     }\n+    if (!dos_state.IsValid()) {\n+        return BIP22ValidationResult(dos_state);",
    "path": "src/rpc/mining.cpp",
    "position": 22,
    "original_position": 5,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a49a153f7cab063ce4f9ae898c9ffa94e8fcf510",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Work in progress: https://github.com/jnewbery/bitcoin/tree/2019-11-remove-block-checked",
    "created_at": "2019-11-22T21:21:32Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r349799232",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349799232"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r349799232"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/349799232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 971,
    "original_line": 971,
    "side": "RIGHT",
    "in_reply_to_id": 347577049
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430114946",
    "pull_request_review_id": 417920876,
    "id": 430114946,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExNDk0Ng==",
    "diff_hunk": "@@ -157,12 +157,13 @@ extern uint64_t nPruneTarget;\n  * May not be called in a\n  * validationinterface callback.\n  *\n- * @param[in]   pblock  The block we want to process.\n- * @param[in]   fForceProcessing Process this block even if unrequested; used for non-network block sources and whitelisted peers.\n- * @param[out]  fNewBlock A boolean which is set to indicate if the block was first received via this call\n- * @returns     If the block was processed, independently of block validity\n+ * @param[in]   pblock            The block we want to process.\n+ * @param[out]  state             Currently unused.",
    "path": "src/validation.h",
    "position": null,
    "original_position": 9,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "db0eecc2bd674c7c0b4400630dfbd40f1f6243a0",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "db0eecc\r\n\r\nnit: Is there any guidelines on parameters sorting ? You can sort by param[in] then param[out]. It makes easier to reason on function. You can also precise in commit that new `dos_state` isn't used.",
    "created_at": "2020-05-26T01:31:47Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430114946",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430114946"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430114946"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430114946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 161,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430115761",
    "pull_request_review_id": 417920876,
    "id": 430115761,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExNTc2MQ==",
    "diff_hunk": "@@ -1332,8 +1332,11 @@ void PeerLogicValidation::UpdatedBlockTip(const CBlockIndex *pindexNew, const CB\n /**\n  * Handle invalid block rejection and consequent peer banning, maintain which\n  * peers announce compact blocks.\n+ * Called both in case of cursory DoS checks failing (implying the peer is likely\n+ * sending us bogus data) and after full validation of the block fails (which may",
    "path": "src/net_processing.cpp",
    "position": 5,
    "original_position": 5,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "a85e8b7393b37e74ddd7ce0e5639bc1944f756f5",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "a85e8b7\r\n\r\nIn `ConnectTip`, we call `ConnectBlock` then `BlockChecked` callback independently of success or failure of block validation ?",
    "created_at": "2020-05-26T01:35:49Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430115761",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430115761"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430115761"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430115761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1389,
    "original_line": 1389,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430116434",
    "pull_request_review_id": 417920876,
    "id": 430116434,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExNjQzNA==",
    "diff_hunk": "@@ -147,18 +147,29 @@ extern uint64_t nPruneTarget;\n  * block is made active. Note that it does not, however, guarantee that the\n  * specific block passed to it has been checked for validity!\n  *\n- * If you want to *possibly* get feedback on whether pblock is valid, you must\n- * install a CValidationInterface (see validationinterface.h) - this will have\n- * its BlockChecked method called whenever *any* block completes validation.\n+ * Performs initial sanity checks using the provided BlockValidationState before\n+ * connecting any block(s). If you want to *possibly* get feedback on whether\n+ * pblock is valid beyond just cursory mutation/DoS checks, you must install\n+ * a CValidationInterface (see validationinterface.h) - this will have its\n+ * BlockChecked method called whenever *any* block completes validation (note\n+ * that any invalidity returned via state will *not* also be provided via\n+ * BlockChecked). There is, of course, no guarantee that any given block which\n+ * is not a part of the eventual best chain will ever be checked.\n  *\n- * Note that we guarantee that either the proof-of-work is valid on pblock, or\n- * (and possibly also) BlockChecked will have been called.\n+ * If the block pblock is built on is in our header tree, and pblock is a\n+ * candidate for accepting to disk (either because it is a candidate for the\n+ * best chain soon, or fForceProcessing is set), but pblock has been mutated,\n+ * state is guaranteed to be some non-IsValid() state.\n  *\n- * May not be called in a\n- * validationinterface callback.\n+ * If fForceProcessing is set (or fNewBlock returns true), and state.IsValid(),\n+ * barring pruning and a desire to re-download a pruned block, there should\n+ * never be any reason to re-ProcessNewBlock any block with the same hash.\n+ *\n+ * May not be called in a validationinterface callback.\n  *\n  * @param[in]   pblock            The block we want to process.\n- * @param[out]  state             Currently unused.\n+ * @param[out]  state             Only used for failures in CheckBlock/AcceptBlock. For failure in block connection,",
    "path": "src/validation.h",
    "position": null,
    "original_position": 33,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "8fc192c3ecb40695ebddbe736684b152081ea4df",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "8fc192c\r\n\r\nIs commit message right ? It mentions \"Net processing now passes a BlockValidationState object into\r\nProcessNewBlock()\" but in fact it's passing this object to `BlockProcessed` therefore making it used.",
    "created_at": "2020-05-26T01:39:39Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430116434",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430116434"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430116434"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430116434/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 171,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430116965",
    "pull_request_review_id": 417920876,
    "id": 430116965,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExNjk2NQ==",
    "diff_hunk": "@@ -147,18 +147,29 @@ extern uint64_t nPruneTarget;\n  * block is made active. Note that it does not, however, guarantee that the\n  * specific block passed to it has been checked for validity!\n  *\n- * If you want to *possibly* get feedback on whether pblock is valid, you must\n- * install a CValidationInterface (see validationinterface.h) - this will have\n- * its BlockChecked method called whenever *any* block completes validation.\n+ * Performs initial sanity checks using the provided BlockValidationState before\n+ * connecting any block(s). If you want to *possibly* get feedback on whether\n+ * pblock is valid beyond just cursory mutation/DoS checks, you must install\n+ * a CValidationInterface (see validationinterface.h) - this will have its\n+ * BlockChecked method called whenever *any* block completes validation (note\n+ * that any invalidity returned via state will *not* also be provided via\n+ * BlockChecked). There is, of course, no guarantee that any given block which\n+ * is not a part of the eventual best chain will ever be checked.\n  *\n- * Note that we guarantee that either the proof-of-work is valid on pblock, or\n- * (and possibly also) BlockChecked will have been called.\n+ * If the block pblock is built on is in our header tree, and pblock is a\n+ * candidate for accepting to disk (either because it is a candidate for the\n+ * best chain soon, or fForceProcessing is set), but pblock has been mutated,\n+ * state is guaranteed to be some non-IsValid() state.\n  *\n- * May not be called in a\n- * validationinterface callback.\n+ * If fForceProcessing is set (or fNewBlock returns true), and state.IsValid(),\n+ * barring pruning and a desire to re-download a pruned block, there should\n+ * never be any reason to re-ProcessNewBlock any block with the same hash.\n+ *\n+ * May not be called in a validationinterface callback.\n  *\n  * @param[in]   pblock            The block we want to process.\n- * @param[out]  state             Currently unused.\n+ * @param[out]  state             Only used for failures in CheckBlock/AcceptBlock. For failure in block connection,",
    "path": "src/validation.h",
    "position": null,
    "original_position": 33,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "8fc192c3ecb40695ebddbe736684b152081ea4df",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "8fc192c\r\n\r\nStill on commit message, \"Net processing wants to know about those failed check immediately...\" Can you explain why ? Overall, PR needs better motivation, I think you can point to changes in #18963, and the [asynchronicity gain](https://github.com/bitcoin/bitcoin/pull/18963/commits/7532cf6c56d015e8bae646138d71df825d2684ab), instead of compact blocks ones.  ",
    "created_at": "2020-05-26T01:42:40Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430116965",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430116965"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430116965"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430116965/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 171,
    "side": "RIGHT",
    "in_reply_to_id": 430116434
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430117481",
    "pull_request_review_id": 417920876,
    "id": 430117481,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExNzQ4MQ==",
    "diff_hunk": "@@ -1981,15 +1981,21 @@ void static ProcessOrphanTx(CConnman* connman, CTxMemPool& mempool, std::set<uin\n }\n \n /**\n- *  A block has been processed. Do housekeeping.\n+ *  A block has been processed. Handle potential peer punishment and housekeeping.\n  */\n-void static BlockProcessed(CNode* pfrom, std::shared_ptr<CBlock> pblock, bool new_block)\n+void static BlockProcessed(CNode* pfrom, CConnman* connman, std::shared_ptr<CBlock> pblock, BlockValidationState& state, bool new_block)\n {\n-    if (new_block) {\n-        pfrom->nLastBlockTime = GetTime();\n-    } else {\n+    if (!state.IsValid()) {\n+        // The block failed anti-dos / mutation checks. Call BlockChecked() callback here.\n+        // This clears the block from mapBlockSource.\n+        BlockChecked(*pblock, state, connman);\n+    } else if (!new_block) {",
    "path": "src/net_processing.cpp",
    "position": 45,
    "original_position": 17,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "8fc192c3ecb40695ebddbe736684b152081ea4df",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "8fc192c\r\n\r\nHow does this new check behaves with regards to write-failure, first-seen block ? In `AcceptBlock`, if `blockPos` returned by `SaveBlockToDisk` is null, an error is set and not an invalid state, so it won't be erased by above `BlockChecked` call. I think it's catch up in current code but not after changes.",
    "created_at": "2020-05-26T01:45:17Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430117481",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430117481"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430117481"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430117481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2105,
    "original_line": 2105,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430118345",
    "pull_request_review_id": 417920876,
    "id": 430118345,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExODM0NQ==",
    "diff_hunk": "@@ -147,18 +147,29 @@ extern uint64_t nPruneTarget;\n  * block is made active. Note that it does not, however, guarantee that the\n  * specific block passed to it has been checked for validity!\n  *\n- * If you want to *possibly* get feedback on whether pblock is valid, you must\n- * install a CValidationInterface (see validationinterface.h) - this will have\n- * its BlockChecked method called whenever *any* block completes validation.\n+ * Performs initial sanity checks using the provided BlockValidationState before\n+ * connecting any block(s). If you want to *possibly* get feedback on whether\n+ * pblock is valid beyond just cursory mutation/DoS checks, you must install\n+ * a CValidationInterface (see validationinterface.h) - this will have its\n+ * BlockChecked method called whenever *any* block completes validation (note\n+ * that any invalidity returned via state will *not* also be provided via\n+ * BlockChecked). There is, of course, no guarantee that any given block which\n+ * is not a part of the eventual best chain will ever be checked.",
    "path": "src/validation.h",
    "position": null,
    "original_position": 14,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "8fc192c3ecb40695ebddbe736684b152081ea4df",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "8fc192c\r\n\r\nI think this whole comment can be made clearer. \r\n\r\n\"You have 2 types of feedbacks:\r\n- unconditional : submitted block validity with regards to mutation, anti-Dos is returned through `BlockValidationState`. It may be used for housekeeping as in `BlockProcessed`\r\n- conditional : if caller subscribe to `CValidationInterface` and if submitted block passed those first checks, `ActivateBestChain`,  will be called to try to make progress towards the best known block and make it the tip of our block chain. Submitted block may be among such tip candidates. Consensus-validity feedback on best known block may be used for peer punishment and compact block promotion as in `BlockChecked`.\"",
    "created_at": "2020-05-26T01:49:32Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430118345",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430118345"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r430118345"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/430118345/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 157,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460174174",
    "pull_request_review_id": 455041949,
    "id": 460174174,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3NDE3NA==",
    "diff_hunk": "@@ -833,22 +833,34 @@ class ChainstateManager\n      * block is made active. Note that it does not, however, guarantee that the\n      * specific block passed to it has been checked for validity!\n      *\n-     * If you want to *possibly* get feedback on whether pblock is valid, you must\n-     * install a CValidationInterface (see validationinterface.h) - this will have\n-     * its BlockChecked method called whenever *any* block completes validation.\n+     * Performs initial sanity checks using the provided BlockValidationState before\n+     * connecting any block(s). If you want to *possibly* get feedback on whether\n+     * pblock is valid beyond just cursory mutation/DoS checks, you must install\n+     * a CValidationInterface (see validationinterface.h) - this will have its\n+     * BlockChecked method called whenever *any* block completes validation (note\n+     * that any invalidity returned via state will *not* also be provided via\n+     * BlockChecked). There is, of course, no guarantee that any given block which\n+     * is not a part of the eventual best chain will ever be checked.\n      *\n-     * Note that we guarantee that either the proof-of-work is valid on pblock, or\n-     * (and possibly also) BlockChecked will have been called.\n+     * If the block pblock is built on is in our header tree, and pblock is a\n+     * candidate for accepting to disk (either because it is a candidate for the\n+     * best chain soon, or fForceProcessing is set), but pblock has been mutated,\n+     * state is guaranteed to be some non-IsValid() state.\n      *\n-     * May not be called in a\n-     * validationinterface callback.\n+     * If fForceProcessing is set (or fNewBlock returns true), and state.IsValid(),\n+     * barring pruning and a desire to re-download a pruned block, there should\n+     * never be any reason to re-ProcessNewBlock any block with the same hash.\n+     *\n+     * May not be called in a validationinterface callback.\n      *\n-     * @param[in]   pblock  The block we want to process.\n-     * @param[in]   fForceProcessing Process this block even if unrequested; used for non-network block sources.\n-     * @param[out]  fNewBlock A boolean which is set to indicate if the block was first received via this call\n-     * @returns     If the block was processed, independently of block validity\n+     * @param[in]   pblock            The block we want to process.\n+     * @param[out]  state             Only used for failures in CheckBlock/AcceptBlock. For failure in block connection,\n+     *                                a CValidationInterface BlockChecked callback is used to notify clients of validity.\n+     * @param[in]   fForceProcessing  This block was requested from the peer or came from a non-network source.\n+     * @param[out]  fNewBlock         A boolean which is set to indicate if the block was first received via this call\n+     * @returns     bool              If the block was processed, independently of block validity\n      */\n-    bool ProcessNewBlock(const CChainParams& chainparams, const std::shared_ptr<const CBlock> pblock, bool fForceProcessing, bool* fNewBlock) LOCKS_EXCLUDED(cs_main);\n+    bool ProcessNewBlock(const CChainParams& chainparams, const std::shared_ptr<const CBlock> pblock, BlockValidationState& state, bool fForceProcessing, bool* fNewBlock) LOCKS_EXCLUDED(cs_main);",
    "path": "src/validation.h",
    "position": 43,
    "original_position": 43,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "2adc864a0ea9363aecb57067e1348d5091db5b61",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "1dd78f41 \r\n\r\n- params order: can the `[out]` param `state` be inserted after the `[in]` params?\r\n\r\n- should `@param[in] chainparams` be added to the doxygen comment?\r\n\r\n- maybe I'm missing something obvious; any reason to not name `state`/`dos_state` consistently throughout, while adding it?",
    "created_at": "2020-07-24T16:55:13Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460174174",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460174174"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460174174"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460174174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 892,
    "original_line": 892,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460177889",
    "pull_request_review_id": 455041949,
    "id": 460177889,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3Nzg4OQ==",
    "diff_hunk": "@@ -2011,6 +2018,25 @@ void static ProcessOrphanTx(CConnman& connman, CTxMemPool& mempool, std::set<uin\n     }\n }\n \n+/**\n+ *  A block has been processed. Handle potential peer punishment and housekeeping.\n+ */\n+void static BlockProcessed(CNode& pfrom, CConnman& connman, CBlock& pblock, BlockValidationState& state, bool new_block)",
    "path": "src/net_processing.cpp",
    "position": 39,
    "original_position": 31,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "2adc864a0ea9363aecb57067e1348d5091db5b61",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In 6730b5931 and 372913c9dfe4, can doxygen documentation be added for `BlockProcessed` params as they are added?",
    "created_at": "2020-07-24T17:02:42Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460177889",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460177889"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460177889"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460177889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2099,
    "original_line": 2099,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460180340",
    "pull_request_review_id": 455041949,
    "id": 460180340,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE4MDM0MA==",
    "diff_hunk": "@@ -2011,6 +2018,25 @@ void static ProcessOrphanTx(CConnman& connman, CTxMemPool& mempool, std::set<uin\n     }\n }\n \n+/**\n+ *  A block has been processed. Handle potential peer punishment and housekeeping.\n+ */\n+void static BlockProcessed(CNode& pfrom, CConnman& connman, CBlock& pblock, BlockValidationState& state, bool new_block)\n+{\n+    if (!state.IsValid()) {\n+        // The block failed anti-dos / mutation checks. Call BlockChecked() callback here.\n+        // This clears the block from mapBlockSource.\n+        BlockChecked(pblock, state, &connman);\n+    } else if (!new_block) {\n+        // Block was valid but we've seen it before. Clear it from mapBlockSource.\n+        LOCK(cs_main);\n+        ::mapBlockSource.erase(pblock.GetHash());\n+    } else {\n+        // Block is valid and we haven't seen it before. set nLastBlockTime for this peer.",
    "path": "src/net_processing.cpp",
    "position": 50,
    "original_position": 42,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "2adc864a0ea9363aecb57067e1348d5091db5b61",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "372913c9df nits:\r\n\r\n- slightly clearer, more differentiating wording could be `s/we've/we have/` and \r\n`s/we haven't/we have not/`\r\n\r\n- why is past tense used above (\"block failed\", \"was valid\") and here present tense (\"is valid\")\r\n\r\n- s/set/Set/",
    "created_at": "2020-07-24T17:07:45Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460180340",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460180340"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460180340"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460180340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2110,
    "original_line": 2110,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460183117",
    "pull_request_review_id": 455041949,
    "id": 460183117,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE4MzExNw==",
    "diff_hunk": "@@ -3837,37 +3837,35 @@ bool CChainState::AcceptBlock(const std::shared_ptr<const CBlock>& pblock, Block\n     return true;\n }\n \n-bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const std::shared_ptr<const CBlock> pblock, bool fForceProcessing, bool* fNewBlock)\n+bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const std::shared_ptr<const CBlock> pblock, BlockValidationState& dos_state, bool fForceProcessing, bool* fNewBlock)\n {\n     AssertLockNotHeld(cs_main);\n \n     {\n         CBlockIndex *pindex = nullptr;\n         if (fNewBlock) *fNewBlock = false;\n-        BlockValidationState state;\n \n         // CheckBlock() does not support multi-threaded block validation because CBlock::fChecked can cause data race.\n         // Therefore, the following critical section must include the CheckBlock() call as well.\n         LOCK(cs_main);\n \n         // Ensure that CheckBlock() passes before calling AcceptBlock, as\n         // belt-and-suspenders.\n-        bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n+        bool ret = CheckBlock(*pblock, dos_state, chainparams.GetConsensus());",
    "path": "src/validation.cpp",
    "position": 21,
    "original_position": 21,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "2adc864a0ea9363aecb57067e1348d5091db5b61",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "1dd78f4 Is there a reason to rename `state` to `dos_state` throughout this function? Doing so adds a fair amount of noise.",
    "created_at": "2020-07-24T17:13:31Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460183117",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460183117"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460183117"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460183117/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3845,
    "original_line": 3845,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460184856",
    "pull_request_review_id": 455041949,
    "id": 460184856,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE4NDg1Ng==",
    "diff_hunk": "@@ -3837,37 +3837,35 @@ bool CChainState::AcceptBlock(const std::shared_ptr<const CBlock>& pblock, Block\n     return true;\n }\n \n-bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const std::shared_ptr<const CBlock> pblock, bool fForceProcessing, bool* fNewBlock)\n+bool ChainstateManager::ProcessNewBlock(const CChainParams& chainparams, const std::shared_ptr<const CBlock> pblock, BlockValidationState& dos_state, bool fForceProcessing, bool* fNewBlock)\n {\n     AssertLockNotHeld(cs_main);\n \n     {\n         CBlockIndex *pindex = nullptr;\n         if (fNewBlock) *fNewBlock = false;\n-        BlockValidationState state;\n \n         // CheckBlock() does not support multi-threaded block validation because CBlock::fChecked can cause data race.\n         // Therefore, the following critical section must include the CheckBlock() call as well.\n         LOCK(cs_main);\n \n         // Ensure that CheckBlock() passes before calling AcceptBlock, as\n         // belt-and-suspenders.\n-        bool ret = CheckBlock(*pblock, state, chainparams.GetConsensus());\n+        bool ret = CheckBlock(*pblock, dos_state, chainparams.GetConsensus());\n         if (ret) {\n             // Store to disk\n-            ret = ::ChainstateActive().AcceptBlock(pblock, state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n+            ret = ::ChainstateActive().AcceptBlock(pblock, dos_state, chainparams, &pindex, fForceProcessing, nullptr, fNewBlock);\n         }\n         if (!ret) {\n-            GetMainSignals().BlockChecked(*pblock, state);\n-            return error(\"%s: AcceptBlock FAILED (%s)\", __func__, state.ToString());\n+            return error(\"%s: AcceptBlock FAILED (%s)\", __func__, dos_state.ToString());\n         }\n     }\n \n     NotifyHeaderTip();\n \n-    BlockValidationState state; // Only used to report errors, not invalidity - ignore it\n-    if (!::ChainstateActive().ActivateBestChain(state, chainparams, pblock))\n-        return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\n+    BlockValidationState dummy_state; // Only used to report errors, not invalidity - ignore it",
    "path": "src/validation.cpp",
    "position": 39,
    "original_position": 39,
    "commit_id": "17170a5dc393ebdd5f03ff1b9536a16eb249d387",
    "original_commit_id": "2adc864a0ea9363aecb57067e1348d5091db5b61",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "5f552a0a34 This change could be done in the same commit 1dd78f4 that adds `state/dos_state` to the params. That said, is it strictly necessary? (a) The change adds noise and ISTM the comment and code position make it clear enough; (b) *dummy* is the kind of naming, like certain others (e.g. *master/slave*, *whitelist/blacklist*, etc.) that is perhaps a bit in decline nowadays and being deprecated, so perhaps no need to add it.",
    "created_at": "2020-07-24T17:16:41Z",
    "updated_at": "2020-08-24T14:30:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460184856",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460184856"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17479#discussion_r460184856"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17479"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/460184856/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3857,
    "original_line": 3857,
    "side": "RIGHT"
  }
]