[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479694760",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-479694760",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 479694760,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTY5NDc2MA==",
    "user": {
      "login": "gwillen",
      "id": 458997,
      "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gwillen",
      "html_url": "https://github.com/gwillen",
      "followers_url": "https://api.github.com/users/gwillen/followers",
      "following_url": "https://api.github.com/users/gwillen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gwillen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gwillen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
      "organizations_url": "https://api.github.com/users/gwillen/orgs",
      "repos_url": "https://api.github.com/users/gwillen/repos",
      "events_url": "https://api.github.com/users/gwillen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gwillen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-03T23:30:47Z",
    "updated_at": "2019-04-03T23:30:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "utACK although it would be good to factor out the counting into a WalletWriteCache or something, that flushes itself at intervals so you don't have to do it manually.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479694760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479712248",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-479712248",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 479712248,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTcxMjI0OA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-04T01:10:15Z",
    "updated_at": "2019-05-24T08:38:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#15876](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15876.html) ([rpc] signer bump fee by Sjors)\n* [#15761](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15761.html) (Replace -upgradewallet startup option with upgradewallet RPC by achow101)\n* [#15424](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15424.html) ([wallet] wallet-tool: command to remove key metadata by Sjors)\n* [#15414](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/15414.html) ([wallet] allow adding pubkeys from imported private keys to keypool by Sjors)\n* [#14912](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14912.html) ([WIP] External signer support (e.g. hardware wallet) by Sjors)\n* [#13756](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/13756.html) (wallet: \"avoid_reuse\" wallet flag for improved privacy by kallewoof)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479712248/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479819136",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-479819136",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 479819136,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTgxOTEzNg==",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?u=a1574ca2038ff1dfaa9a7764c59ea5ff4f305b5d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-04T09:18:16Z",
    "updated_at": "2019-04-04T09:35:50Z",
    "author_association": "MEMBER",
    "body": "https://github.com/Empact/bitcoin/commit/dd5b0aaf58d843c2532b3ca1829bf90482e9dc52 `CWallet::AddKeyOrigin(const CPubKey& pubkey, const KeyOriginInfo& info)` and `CWallet::WriteKeyMetadata(const CKeyMetadata& meta, const CPubKey& pubkey, const bool overwrite)` can be removed.\r\n\r\nhttps://github.com/Empact/bitcoin/commit/c5d9eec6529cb2ce185be92d199ac50790a400ff How about moving this functionality into `CWallet`, so that we don't operate externally on `CWallet::database` any more than we already do. As the `GetDBHandle` comments say:\r\nhttps://github.com/bitcoin/bitcoin/blob/ba54342c9dd3f2e5cdeed9ac57f1924f0d885cc6/src/wallet/wallet.h#L750-L753\r\n\r\nPractically speaking, this also explicitly limits the scope of the batch operations on `database` to within the lifecycle of the `CWallet` instance.\r\n\r\nhttps://github.com/Empact/bitcoin/commit/b363aa785eb2d2cfb95a69f6cb1ddb6ebe89db18 Could also apply the batch treatment to `SetAddressBook`\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479819136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479831135",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-479831135",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 479831135,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTgzMTEzNQ==",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?u=a1574ca2038ff1dfaa9a7764c59ea5ff4f305b5d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-04T09:53:11Z",
    "updated_at": "2019-04-04T09:53:11Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479831135/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479996852",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-479996852",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 479996852,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTk5Njg1Mg==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-04T17:46:53Z",
    "updated_at": "2019-04-04T17:46:53Z",
    "author_association": "MEMBER",
    "body": "See also:  \r\n\r\n* Use a single wallet batch for UpgradeKeyMetadata #15433 ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/479996852/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480005407",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-480005407",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 480005407,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDAwNTQwNw==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-04T18:10:45Z",
    "updated_at": "2019-04-04T18:10:45Z",
    "author_association": "MEMBER",
    "body": "I've pulled in @Empact's changes (Empact@dd5b0aa was squashed into 59ec41257f37f2a0438b10ef9776bf7ea3488e9a, cherry-picked the other two commits).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480005407/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480092953",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-480092953",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 480092953,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDA5Mjk1Mw==",
    "user": {
      "login": "gwillen",
      "id": 458997,
      "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gwillen",
      "html_url": "https://github.com/gwillen",
      "followers_url": "https://api.github.com/users/gwillen/followers",
      "following_url": "https://api.github.com/users/gwillen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gwillen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gwillen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
      "organizations_url": "https://api.github.com/users/gwillen/orgs",
      "repos_url": "https://api.github.com/users/gwillen/repos",
      "events_url": "https://api.github.com/users/gwillen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gwillen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-04T22:59:32Z",
    "updated_at": "2019-04-04T22:59:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Especially if there are now multiple places we're manually batching writes like this, and more where we're considering it: Let me suggest again and more strongly that the batch object should be handling autoflushing after every X calls, instead of open-coding it in the caller like this. If it's appropriate for every caller, it could go into WalletBatch, else into a new class that's an extremely thin wrapper around it. I bet the total number of lines added in this PR would actually go down.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480092953/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480119266",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-480119266",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 480119266,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDExOTI2Ng==",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T01:32:44Z",
    "updated_at": "2019-04-05T01:32:44Z",
    "author_association": "MEMBER",
    "body": "Concept ACK. I tried the first two commits (so without address book change) with #14145 and importing 2x 1000 keys seems about 6 times faster. ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480119266/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480141948",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-480141948",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 480141948,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDE0MTk0OA==",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?u=a1574ca2038ff1dfaa9a7764c59ea5ff4f305b5d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T04:09:19Z",
    "updated_at": "2019-04-05T04:09:19Z",
    "author_association": "MEMBER",
    "body": "@gwillen Agree it should be done but would be appropriate as a follow-up ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480141948/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480246084",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-480246084",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 480246084,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDI0NjA4NA==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T11:45:05Z",
    "updated_at": "2019-04-05T11:45:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like `AddKeypoolPubkey` is no longer used and can be removed?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480246084/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480394233",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-480394233",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 480394233,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDM5NDIzMw==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T19:24:36Z",
    "updated_at": "2019-04-05T19:24:36Z",
    "author_association": "MEMBER",
    "body": "I've implemented @gwillen's suggestion. `WalletBatch` will flush to disk automatically after every 1000 writes. This appears to be faster too as it does not close and reopen the database on every flush. With this change, I've also updated `UpgradeKeyMetadata`.\r\n\r\n> Looks like `AddKeypoolPubkey` is no longer used and can be removed?\r\n\r\nDone",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480394233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480433154",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-480433154",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 480433154,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDQzMzE1NA==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T21:50:04Z",
    "updated_at": "2019-04-05T21:50:04Z",
    "author_association": "MEMBER",
    "body": "I'm unsure why tests are currently failing.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/480433154/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493664957",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-493664957",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 493664957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzY2NDk1Nw==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-18T10:05:48Z",
    "updated_at": "2019-05-18T10:07:57Z",
    "author_association": "MEMBER",
    "body": "@achow101 looks like `CWallet::UnsetWalletFlag` should reuse the batch instance:\r\n<img width=\"670\" alt=\"Screenshot 2019-05-18 at 10 45 19\" src=\"https://user-images.githubusercontent.com/3534524/57967966-95483400-795c-11e9-817f-07c3174a05a9.png\">\r\n<img width=\"533\" alt=\"Screenshot 2019-05-18 at 11 07 28\" src=\"https://user-images.githubusercontent.com/3534524/57968029-2e774a80-795d-11e9-8d0c-a53de755b54e.png\">\r\nPlease test/banchmark with 76c3906d751442ddb1b9bf1662d3e2effb53e950 (https://github.com/promag/bitcoin/tree/pr15741), at least here it gives a significant improvement.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493664957/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493665506",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-493665506",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 493665506,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzY2NTUwNg==",
    "user": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?u=eab5d0cdbb6cc25087cb61d4ca4a6f85255f42a7&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-18T10:14:09Z",
    "updated_at": "2019-05-18T10:14:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493665506/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493680256",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-493680256",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 493680256,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzY4MDI1Ng==",
    "user": {
      "login": "jb55",
      "id": 45598,
      "node_id": "MDQ6VXNlcjQ1NTk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/45598?u=2ba2cccaa0fd357b363507ce5694ce3cf5e56220&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jb55",
      "html_url": "https://github.com/jb55",
      "followers_url": "https://api.github.com/users/jb55/followers",
      "following_url": "https://api.github.com/users/jb55/following{/other_user}",
      "gists_url": "https://api.github.com/users/jb55/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jb55/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jb55/subscriptions",
      "organizations_url": "https://api.github.com/users/jb55/orgs",
      "repos_url": "https://api.github.com/users/jb55/repos",
      "events_url": "https://api.github.com/users/jb55/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jb55/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-18T14:15:05Z",
    "updated_at": "2019-05-18T14:15:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "@promag's patch brings my import speeds down from 8 minutes to about 10 seconds for 10000 keys",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493680256/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493689626",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-493689626",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 493689626,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzY4OTYyNg==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-18T16:30:51Z",
    "updated_at": "2019-05-18T16:37:16Z",
    "author_association": "MEMBER",
    "body": "I've pulled in @promag's patch and updated it to match the convention we've been using for passing in a `WalletBatch`.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493689626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493690061",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-493690061",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 493690061,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzY5MDA2MQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-18T16:37:29Z",
    "updated_at": "2019-05-18T16:37:29Z",
    "author_association": "MEMBER",
    "body": "@achow101 please update times in OP.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493690061/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493692982",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-493692982",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 493692982,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzY5Mjk4Mg==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-18T17:21:36Z",
    "updated_at": "2019-05-18T17:21:36Z",
    "author_association": "MEMBER",
    "body": "I noticed that importing scripts would also be slow so I've added `AddCScriptWIthDB` in order to apply the same batching performance boost to such imports.\r\n\r\nAlso updated OP.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493692982/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493732077",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-493732077",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 493732077,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzczMjA3Nw==",
    "user": {
      "login": "jb55",
      "id": 45598,
      "node_id": "MDQ6VXNlcjQ1NTk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/45598?u=2ba2cccaa0fd357b363507ce5694ce3cf5e56220&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jb55",
      "html_url": "https://github.com/jb55",
      "followers_url": "https://api.github.com/users/jb55/followers",
      "following_url": "https://api.github.com/users/jb55/following{/other_user}",
      "gists_url": "https://api.github.com/users/jb55/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jb55/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jb55/subscriptions",
      "organizations_url": "https://api.github.com/users/jb55/orgs",
      "repos_url": "https://api.github.com/users/jb55/repos",
      "events_url": "https://api.github.com/users/jb55/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jb55/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-19T06:52:53Z",
    "updated_at": "2019-05-19T06:54:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "tACK 87f7befca04a095a06af003f9fe20d2e3c155d2f sooo fast. tested a rescan with my all my trezor keys from HWI and it worked great. thanks @achow101, hw wallet + core is actually usable now (at least for watching :)!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493732077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493773979",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-493773979",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 493773979,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Mzc3Mzk3OQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-19T17:06:13Z",
    "updated_at": "2019-05-19T17:06:13Z",
    "author_association": "MEMBER",
    "body": "Restarted travis, it was failing with \ud83d\ude15\r\n```\r\n47/121 - rpc_psbt.py failed, Duration: 5 s\r\nstdout:\r\n2019-05-18T17:46:43.670000Z TestFramework (INFO): Initializing test directory /tmp/test_runner_\u20bf_\ud83c\udfc3_20190518_173555/rpc_psbt_71\r\n2019-05-18T17:46:47.538000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-unknown-linux-gnu/test/functional/test_framework/test_framework.py\", line 194, in main\r\n    self.run_test()\r\n  File \"/home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-unknown-linux-gnu/test/functional/rpc_psbt.py\", line 156, in run_test\r\n    assert_raises_rpc_error(-22, \"\", self.nodes[0].converttopsbt, signedtx['hex'])\r\n  File \"/home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-unknown-linux-gnu/test/functional/test_framework/util.py\", line 105, in assert_raises_rpc_error\r\n    assert try_rpc(code, message, fun, *args, **kwds), \"No exception raised\"\r\nAssertionError: No exception raised\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493773979/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493789580",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-493789580",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 493789580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Mzc4OTU4MA==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-19T20:36:29Z",
    "updated_at": "2019-05-19T20:36:29Z",
    "author_association": "MEMBER",
    "body": "utACK 87f7bef. nit, ampersand should be before space.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/493789580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496311817",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-496311817",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 496311817,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjMxMTgxNw==",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?u=a1574ca2038ff1dfaa9a7764c59ea5ff4f305b5d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-27T21:57:10Z",
    "updated_at": "2019-05-27T21:57:10Z",
    "author_association": "MEMBER",
    "body": "utACK https://github.com/bitcoin/bitcoin/pull/15741/commits/87f7befca04a095a06af003f9fe20d2e3c155d2f",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496311817/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496700447",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-496700447",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 496700447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NjcwMDQ0Nw==",
    "user": {
      "login": "jb55",
      "id": 45598,
      "node_id": "MDQ6VXNlcjQ1NTk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/45598?u=2ba2cccaa0fd357b363507ce5694ce3cf5e56220&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jb55",
      "html_url": "https://github.com/jb55",
      "followers_url": "https://api.github.com/users/jb55/followers",
      "following_url": "https://api.github.com/users/jb55/following{/other_user}",
      "gists_url": "https://api.github.com/users/jb55/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jb55/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jb55/subscriptions",
      "organizations_url": "https://api.github.com/users/jb55/orgs",
      "repos_url": "https://api.github.com/users/jb55/repos",
      "events_url": "https://api.github.com/users/jb55/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jb55/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-28T21:40:15Z",
    "updated_at": "2019-05-28T21:40:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "utACK 0db94e5",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496700447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496757067",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-496757067",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 496757067,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Njc1NzA2Nw==",
    "user": {
      "login": "ariard",
      "id": 23310655,
      "node_id": "MDQ6VXNlcjIzMzEwNjU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ariard",
      "html_url": "https://github.com/ariard",
      "followers_url": "https://api.github.com/users/ariard/followers",
      "following_url": "https://api.github.com/users/ariard/following{/other_user}",
      "gists_url": "https://api.github.com/users/ariard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ariard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
      "organizations_url": "https://api.github.com/users/ariard/orgs",
      "repos_url": "https://api.github.com/users/ariard/repos",
      "events_url": "https://api.github.com/users/ariard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ariard/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-29T02:16:35Z",
    "updated_at": "2019-05-29T02:16:35Z",
    "author_association": "MEMBER",
    "body": "Tested ACK 0db94e5\r\n\r\nDrop import time for 10000 keys ranged descriptor from 495.57s to 3.626s with 2.8 GHz Intel Core i7.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496757067/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496765704",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#issuecomment-496765704",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15741",
    "id": 496765704,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Njc2NTcwNA==",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?u=a1574ca2038ff1dfaa9a7764c59ea5ff4f305b5d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-29T03:05:54Z",
    "updated_at": "2019-05-29T03:05:54Z",
    "author_association": "MEMBER",
    "body": "re-utACK https://github.com/bitcoin/bitcoin/pull/15741/commits/0db94e55dcbbfc741df463c404818d9033b4fff1 only change is re the privacy of `UnsetWalletFlagWithDB` and `AddCScriptWithDB`.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/496765704/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271971255",
    "pull_request_review_id": 222501439,
    "id": 271971255,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MTk3MTI1NQ==",
    "diff_hunk": "@@ -1282,33 +1287,46 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             }\n              const CPubKey& pubkey = entry->second;\n              CPubKey temp;\n-             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnly(GetScriptForRawPubKey(pubkey), timestamp)) {\n+             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnlyWithDB(*batch, GetScriptForRawPubKey(pubkey), timestamp)) {",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 29,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "508c4860644e818023735d77e706efa490db744a",
    "user": {
      "login": "gwillen",
      "id": 458997,
      "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gwillen",
      "html_url": "https://github.com/gwillen",
      "followers_url": "https://api.github.com/users/gwillen/followers",
      "following_url": "https://api.github.com/users/gwillen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gwillen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gwillen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
      "organizations_url": "https://api.github.com/users/gwillen/orgs",
      "repos_url": "https://api.github.com/users/gwillen/repos",
      "events_url": "https://api.github.com/users/gwillen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gwillen/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "There is a weird indentation glitch here, although it looks like it was preexisting.",
    "created_at": "2019-04-03T23:31:53Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r271971255",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271971255"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r271971255"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271971255/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1290,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271971423",
    "pull_request_review_id": 222501439,
    "id": 271971423,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MTk3MTQyMw==",
    "diff_hunk": "@@ -1282,33 +1287,46 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             }\n              const CPubKey& pubkey = entry->second;\n              CPubKey temp;\n-             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnly(GetScriptForRawPubKey(pubkey), timestamp)) {\n+             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnlyWithDB(*batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n             }\n+            if (++cnt % 1000 == 0) {\n+                batch.reset(new WalletBatch(pwallet->GetDBHandle()));\n+            }\n             const auto& key_orig_it = import_data.key_origins.find(id);\n             if (key_orig_it != import_data.key_origins.end()) {\n-                pwallet->AddKeyOrigin(pubkey, key_orig_it->second);\n+                pwallet->AddKeyOriginWithDB(*batch, pubkey, key_orig_it->second);\n+                if (++cnt % 1000 == 0) {\n+                    batch.reset(new WalletBatch(pwallet->GetDBHandle()));\n+                }\n             }\n             pwallet->mapKeyMetadata[id].nCreateTime = timestamp;\n \n             // Add to keypool only works with pubkeys\n             if (add_keypool) {\n-                pwallet->AddKeypoolPubkey(pubkey, internal);\n+                pwallet->AddKeypoolPubkeyWithDB(pubkey, internal, *batch);\n+                if (++cnt % 1000 == 0) {\n+                    batch.reset(new WalletBatch(pwallet->GetDBHandle()));\n+                }\n             }\n         }\n \n         for (const CScript& script : script_pub_keys) {\n             if (!have_solving_data || !::IsMine(*pwallet, script)) { // Always call AddWatchOnly for non-solvable watch-only, so that watch timestamp gets updated\n-                if (!pwallet->AddWatchOnly(script, timestamp)) {\n+                if (!pwallet->AddWatchOnlyWithDB(*batch, script, timestamp)) {\n                     throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n                 }\n+                if (++cnt % 1000 == 0) {\n+                    batch.reset(new WalletBatch(pwallet->GetDBHandle()));\n+                }\n             }\n             CTxDestination dest;\n             ExtractDestination(script, dest);\n             if (!internal && IsValidDestination(dest)) {\n                 pwallet->SetAddressBook(dest, label, \"receive\");\n             }\n         }\n+        batch.reset();",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 71,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "508c4860644e818023735d77e706efa490db744a",
    "user": {
      "login": "gwillen",
      "id": 458997,
      "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gwillen",
      "html_url": "https://github.com/gwillen",
      "followers_url": "https://api.github.com/users/gwillen/followers",
      "following_url": "https://api.github.com/users/gwillen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gwillen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gwillen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
      "organizations_url": "https://api.github.com/users/gwillen/orgs",
      "repos_url": "https://api.github.com/users/gwillen/repos",
      "events_url": "https://api.github.com/users/gwillen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gwillen/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Is this necessary? It's about to go out of scope, right?",
    "created_at": "2019-04-03T23:32:40Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r271971423",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271971423"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r271971423"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/271971423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1329,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272102808",
    "pull_request_review_id": 222662248,
    "id": 272102808,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MjEwMjgwOA==",
    "diff_hunk": "@@ -1222,6 +1224,7 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n \n     /** Add a KeyOriginInfo to the wallet */\n     bool AddKeyOrigin(const CPubKey& pubkey, const KeyOriginInfo& info);\n+    bool AddKeyOriginWithDB(WalletBatch& batch, const CPubKey& pubkey, const KeyOriginInfo& info);",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 20,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "508c4860644e818023735d77e706efa490db744a",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: May be a bad example to follow, but `AddKeypoolPubkeyWithDB` has `batch` as the last argument, which makes as much sense to me.",
    "created_at": "2019-04-04T09:52:44Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272102808",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272102808"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272102808"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272102808/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1227,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272164997",
    "pull_request_review_id": 222743348,
    "id": 272164997,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MjE2NDk5Nw==",
    "diff_hunk": "@@ -1263,17 +1263,22 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding script to wallet\");\n              }\n          }\n+         std::unique_ptr<WalletBatch> batch = MakeUnique<WalletBatch>(pwallet->GetDBHandle());\n+         size_t cnt = 0;\n          for (const auto& entry : privkey_map) {\n              const CKey& key = entry.second;\n              CPubKey pubkey = key.GetPubKey();\n              const CKeyID& id = entry.first;\n              assert(key.VerifyPubKey(pubkey));\n              pwallet->mapKeyMetadata[id].nCreateTime = timestamp;\n              // If the private key is not present in the wallet, insert it.\n-             if (!pwallet->HaveKey(id) && !pwallet->AddKeyPubKey(key, pubkey)) {\n+             if (!pwallet->HaveKey(id) && !pwallet->AddKeyPubKeyWithDB(*batch, key, pubkey)) {\n                  throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding key to wallet\");\n              }\n              pwallet->UpdateTimeFirstKey(timestamp);\n+             if (++cnt % 1000 == 0) {",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "508c4860644e818023735d77e706efa490db744a",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What is the problem of one batch only?",
    "created_at": "2019-04-04T12:57:53Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272164997",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272164997"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272164997"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272164997/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1279,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272303357",
    "pull_request_review_id": 222922919,
    "id": 272303357,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MjMwMzM1Nw==",
    "diff_hunk": "@@ -1263,17 +1263,22 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding script to wallet\");\n              }\n          }\n+         std::unique_ptr<WalletBatch> batch = MakeUnique<WalletBatch>(pwallet->GetDBHandle());\n+         size_t cnt = 0;\n          for (const auto& entry : privkey_map) {\n              const CKey& key = entry.second;\n              CPubKey pubkey = key.GetPubKey();\n              const CKeyID& id = entry.first;\n              assert(key.VerifyPubKey(pubkey));\n              pwallet->mapKeyMetadata[id].nCreateTime = timestamp;\n              // If the private key is not present in the wallet, insert it.\n-             if (!pwallet->HaveKey(id) && !pwallet->AddKeyPubKey(key, pubkey)) {\n+             if (!pwallet->HaveKey(id) && !pwallet->AddKeyPubKeyWithDB(*batch, key, pubkey)) {\n                  throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding key to wallet\");\n              }\n              pwallet->UpdateTimeFirstKey(timestamp);\n+             if (++cnt % 1000 == 0) {",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 18,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "508c4860644e818023735d77e706efa490db744a",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The batch can get very large in memory if lots of keys are involved, so we limit the size to avoid blowing up memory during imports.",
    "created_at": "2019-04-04T18:11:17Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272303357",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272303357"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272303357"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272303357/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1279,
    "side": "RIGHT",
    "in_reply_to_id": 272164997
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272303687",
    "pull_request_review_id": 222923339,
    "id": 272303687,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MjMwMzY4Nw==",
    "diff_hunk": "@@ -1222,6 +1224,7 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n \n     /** Add a KeyOriginInfo to the wallet */\n     bool AddKeyOrigin(const CPubKey& pubkey, const KeyOriginInfo& info);\n+    bool AddKeyOriginWithDB(WalletBatch& batch, const CPubKey& pubkey, const KeyOriginInfo& info);",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 20,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "508c4860644e818023735d77e706efa490db744a",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I was following the `AddKeyPubKeyWithDB` way of argument ordering.",
    "created_at": "2019-04-04T18:12:04Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272303687",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272303687"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272303687"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272303687/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1227,
    "side": "RIGHT",
    "in_reply_to_id": 272102808
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272303803",
    "pull_request_review_id": 222923489,
    "id": 272303803,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MjMwMzgwMw==",
    "diff_hunk": "@@ -1282,33 +1287,46 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             }\n              const CPubKey& pubkey = entry->second;\n              CPubKey temp;\n-             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnly(GetScriptForRawPubKey(pubkey), timestamp)) {\n+             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnlyWithDB(*batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n             }\n+            if (++cnt % 1000 == 0) {\n+                batch.reset(new WalletBatch(pwallet->GetDBHandle()));\n+            }\n             const auto& key_orig_it = import_data.key_origins.find(id);\n             if (key_orig_it != import_data.key_origins.end()) {\n-                pwallet->AddKeyOrigin(pubkey, key_orig_it->second);\n+                pwallet->AddKeyOriginWithDB(*batch, pubkey, key_orig_it->second);\n+                if (++cnt % 1000 == 0) {\n+                    batch.reset(new WalletBatch(pwallet->GetDBHandle()));\n+                }\n             }\n             pwallet->mapKeyMetadata[id].nCreateTime = timestamp;\n \n             // Add to keypool only works with pubkeys\n             if (add_keypool) {\n-                pwallet->AddKeypoolPubkey(pubkey, internal);\n+                pwallet->AddKeypoolPubkeyWithDB(pubkey, internal, *batch);\n+                if (++cnt % 1000 == 0) {\n+                    batch.reset(new WalletBatch(pwallet->GetDBHandle()));\n+                }\n             }\n         }\n \n         for (const CScript& script : script_pub_keys) {\n             if (!have_solving_data || !::IsMine(*pwallet, script)) { // Always call AddWatchOnly for non-solvable watch-only, so that watch timestamp gets updated\n-                if (!pwallet->AddWatchOnly(script, timestamp)) {\n+                if (!pwallet->AddWatchOnlyWithDB(*batch, script, timestamp)) {\n                     throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n                 }\n+                if (++cnt % 1000 == 0) {\n+                    batch.reset(new WalletBatch(pwallet->GetDBHandle()));\n+                }\n             }\n             CTxDestination dest;\n             ExtractDestination(script, dest);\n             if (!internal && IsValidDestination(dest)) {\n                 pwallet->SetAddressBook(dest, label, \"receive\");\n             }\n         }\n+        batch.reset();",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 71,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "508c4860644e818023735d77e706efa490db744a",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Probably not. I did that just as a belt-and-suspenders thing.",
    "created_at": "2019-04-04T18:12:21Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272303803",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272303803"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272303803"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272303803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1329,
    "side": "RIGHT",
    "in_reply_to_id": 271971423
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272733923",
    "pull_request_review_id": 223466050,
    "id": 272733923,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MjczMzkyMw==",
    "diff_hunk": "@@ -389,15 +388,10 @@ void CWallet::UpgradeKeyMetadata()\n             // Write meta to wallet\n             CPubKey pubkey;\n             if (GetPubKey(meta_pair.first, pubkey)) {\n-                batch->WriteKeyMetadata(meta, pubkey, true);\n-                if (++cnt % 1000 == 0) {\n-                    // avoid creating overlarge in-memory batches in case the wallet contains large amounts of keys\n-                    batch.reset(new WalletBatch(*database));\n-                }\n+                batch.WriteKeyMetadata(meta, pubkey, true);\n             }\n         }\n     }\n-    batch.reset(); //write before setting the flag",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "ebb0ea85539b3e2f515fca89231c20ac86fb52d5",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "in commit ebb0ea85539b3e2f515fca89231c20ac86fb52d5:\r\n\r\nWhy is this no longer needed?",
    "created_at": "2019-04-05T20:29:51Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272733923",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272733923"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272733923"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272733923/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 409,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272753131",
    "pull_request_review_id": 223490974,
    "id": 272753131,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mjc1MzEzMQ==",
    "diff_hunk": "@@ -389,15 +388,10 @@ void CWallet::UpgradeKeyMetadata()\n             // Write meta to wallet\n             CPubKey pubkey;\n             if (GetPubKey(meta_pair.first, pubkey)) {\n-                batch->WriteKeyMetadata(meta, pubkey, true);\n-                if (++cnt % 1000 == 0) {\n-                    // avoid creating overlarge in-memory batches in case the wallet contains large amounts of keys\n-                    batch.reset(new WalletBatch(*database));\n-                }\n+                batch.WriteKeyMetadata(meta, pubkey, true);\n             }\n         }\n     }\n-    batch.reset(); //write before setting the flag",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "ebb0ea85539b3e2f515fca89231c20ac86fb52d5",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "When batch goes out of scope, it will write. This was just a belt and suspenders.",
    "created_at": "2019-04-05T21:44:18Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272753131",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272753131"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272753131"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272753131/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 409,
    "side": "LEFT",
    "in_reply_to_id": 272733923
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272755099",
    "pull_request_review_id": 223493473,
    "id": 272755099,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mjc1NTA5OQ==",
    "diff_hunk": "@@ -389,15 +388,10 @@ void CWallet::UpgradeKeyMetadata()\n             // Write meta to wallet\n             CPubKey pubkey;\n             if (GetPubKey(meta_pair.first, pubkey)) {\n-                batch->WriteKeyMetadata(meta, pubkey, true);\n-                if (++cnt % 1000 == 0) {\n-                    // avoid creating overlarge in-memory batches in case the wallet contains large amounts of keys\n-                    batch.reset(new WalletBatch(*database));\n-                }\n+                batch.WriteKeyMetadata(meta, pubkey, true);\n             }\n         }\n     }\n-    batch.reset(); //write before setting the flag",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "ebb0ea85539b3e2f515fca89231c20ac86fb52d5",
    "user": {
      "login": "gwillen",
      "id": 458997,
      "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gwillen",
      "html_url": "https://github.com/gwillen",
      "followers_url": "https://api.github.com/users/gwillen/followers",
      "following_url": "https://api.github.com/users/gwillen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gwillen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gwillen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
      "organizations_url": "https://api.github.com/users/gwillen/orgs",
      "repos_url": "https://api.github.com/users/gwillen/repos",
      "events_url": "https://api.github.com/users/gwillen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gwillen/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The comment suggests that in this case -- unlike the batch write in importmulti -- there's a specific reason to force it to write before the end of the scope.",
    "created_at": "2019-04-05T21:53:43Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272755099",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272755099"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272755099"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272755099/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 409,
    "side": "LEFT",
    "in_reply_to_id": 272733923
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272757790",
    "pull_request_review_id": 223496976,
    "id": 272757790,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mjc1Nzc5MA==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I get that this makes the code simple, but IMO this defeats the batch purpose. Like, it shouldn't be something to worry about here.",
    "created_at": "2019-04-05T22:08:11Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272757790",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272757790"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272757790"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272757790/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272758955",
    "pull_request_review_id": 223496976,
    "id": 272758955,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mjc1ODk1NQ==",
    "diff_hunk": "@@ -614,7 +614,9 @@ void BerkeleyBatch::Flush()\n     if (fReadOnly)\n         nMinutes = 1;\n \n-    env->dbenv->txn_checkpoint(nMinutes ? gArgs.GetArg(\"-dblogsize\", DEFAULT_WALLET_DBLOGSIZE) * 1024 : 0, nMinutes, 0);\n+    if (env) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why this change?",
    "created_at": "2019-04-05T22:14:33Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272758955",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272758955"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272758955"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272758955/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 617,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272761260",
    "pull_request_review_id": 223501541,
    "id": 272761260,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mjc2MTI2MA==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "gwillen",
      "id": 458997,
      "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gwillen",
      "html_url": "https://github.com/gwillen",
      "followers_url": "https://api.github.com/users/gwillen/followers",
      "following_url": "https://api.github.com/users/gwillen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gwillen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gwillen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
      "organizations_url": "https://api.github.com/users/gwillen/orgs",
      "repos_url": "https://api.github.com/users/gwillen/repos",
      "events_url": "https://api.github.com/users/gwillen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gwillen/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't understand what you mean by 'defeats the batch purpose'. Are there cases where the caller is depending on the batch not being flushed?\r\n\r\nI think it is far better engineering practice to deal with periodic flushing once, inside the batch-management code, than to deal with it independently at each callsite. If there's some situation where periodic flushing is undesirable, I think it would be better to offer both versions.",
    "created_at": "2019-04-05T22:28:12Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272761260",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272761260"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272761260"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272761260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272761472",
    "pull_request_review_id": 223501806,
    "id": 272761472,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mjc2MTQ3Mg==",
    "diff_hunk": "@@ -614,7 +614,9 @@ void BerkeleyBatch::Flush()\n     if (fReadOnly)\n         nMinutes = 1;\n \n-    env->dbenv->txn_checkpoint(nMinutes ? gArgs.GetArg(\"-dblogsize\", DEFAULT_WALLET_DBLOGSIZE) * 1024 : 0, nMinutes, 0);\n+    if (env) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "So that tests pass. When there's a dummy database, env will be `nulltpr` and this causes a segfault in tests which use a dummy database.",
    "created_at": "2019-04-05T22:29:35Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272761472",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272761472"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272761472"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272761472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 617,
    "side": "RIGHT",
    "in_reply_to_id": 272758955
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272763479",
    "pull_request_review_id": 223504283,
    "id": 272763479,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mjc2MzQ3OQ==",
    "diff_hunk": "@@ -389,15 +388,10 @@ void CWallet::UpgradeKeyMetadata()\n             // Write meta to wallet\n             CPubKey pubkey;\n             if (GetPubKey(meta_pair.first, pubkey)) {\n-                batch->WriteKeyMetadata(meta, pubkey, true);\n-                if (++cnt % 1000 == 0) {\n-                    // avoid creating overlarge in-memory batches in case the wallet contains large amounts of keys\n-                    batch.reset(new WalletBatch(*database));\n-                }\n+                batch.WriteKeyMetadata(meta, pubkey, true);\n             }\n         }\n     }\n-    batch.reset(); //write before setting the flag",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "ebb0ea85539b3e2f515fca89231c20ac86fb52d5",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "reverted",
    "created_at": "2019-04-05T22:42:12Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272763479",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272763479"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r272763479"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/272763479/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 409,
    "side": "LEFT",
    "in_reply_to_id": 272733923
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273055021",
    "pull_request_review_id": 223854543,
    "id": 273055021,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MzA1NTAyMQ==",
    "diff_hunk": "@@ -614,7 +614,9 @@ void BerkeleyBatch::Flush()\n     if (fReadOnly)\n         nMinutes = 1;\n \n-    env->dbenv->txn_checkpoint(nMinutes ? gArgs.GetArg(\"-dblogsize\", DEFAULT_WALLET_DBLOGSIZE) * 1024 : 0, nMinutes, 0);\n+    if (env) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Can't we make `env` is defined instead? Otherwise a comment would make sense as this doesn't really happen.",
    "created_at": "2019-04-08T13:48:32Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273055021",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273055021"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273055021"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273055021/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 617,
    "side": "RIGHT",
    "in_reply_to_id": 272758955
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273055976",
    "pull_request_review_id": 223855662,
    "id": 273055976,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MzA1NTk3Ng==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@gwillen I mean you should be able to create a batch with 1001 changes no? I was suggesting something on top of `WalletBatch` to do that.",
    "created_at": "2019-04-08T13:50:18Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273055976",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273055976"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273055976"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273055976/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273128590",
    "pull_request_review_id": 223947306,
    "id": 273128590,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MzEyODU5MA==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "gwillen",
      "id": 458997,
      "node_id": "MDQ6VXNlcjQ1ODk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/458997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gwillen",
      "html_url": "https://github.com/gwillen",
      "followers_url": "https://api.github.com/users/gwillen/followers",
      "following_url": "https://api.github.com/users/gwillen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gwillen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gwillen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gwillen/subscriptions",
      "organizations_url": "https://api.github.com/users/gwillen/orgs",
      "repos_url": "https://api.github.com/users/gwillen/repos",
      "events_url": "https://api.github.com/users/gwillen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gwillen/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Well, you can add as many changes as you want, it just flushes after every 1000. This should be completely transparent to the user. Unless there is some reason that flushing can hurt, like the caller is using the batch as though it were an atomic transaction?",
    "created_at": "2019-04-08T16:15:33Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273128590",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273128590"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273128590"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273128590/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273145509",
    "pull_request_review_id": 223968690,
    "id": 273145509,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MzE0NTUwOQ==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Unless there is some reason that flushing can hurt, like the caller is using the batch as though it were an atomic transaction?\r\n\r\nThere is only one place where an atomic transaction is used, and if an atomic transaction is active, then `Flush()` will do nothing.",
    "created_at": "2019-04-08T16:58:18Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273145509",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273145509"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273145509"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273145509/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273148040",
    "pull_request_review_id": 223971727,
    "id": 273148040,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3MzE0ODA0MA==",
    "diff_hunk": "@@ -614,7 +614,9 @@ void BerkeleyBatch::Flush()\n     if (fReadOnly)\n         nMinutes = 1;\n \n-    env->dbenv->txn_checkpoint(nMinutes ? gArgs.GetArg(\"-dblogsize\", DEFAULT_WALLET_DBLOGSIZE) * 1024 : 0, nMinutes, 0);\n+    if (env) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Can't we make `env` is defined instead?\r\n\r\nNo. `env` is nullptr for dummy databases which are used in tests. A check like this is used in many other places in this file in the form of `BerkeleyDatabase::IsDummy()`.\r\n\r\n> Otherwise a comment would make sense as this doesn't really happen.\r\n\r\nDone.",
    "created_at": "2019-04-08T17:04:26Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273148040",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273148040"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273148040"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273148040/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 617,
    "side": "RIGHT",
    "in_reply_to_id": 272758955
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273852590",
    "pull_request_review_id": 224836761,
    "id": 273852590,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mzg1MjU5MA==",
    "diff_hunk": "@@ -614,7 +614,9 @@ void BerkeleyBatch::Flush()\n     if (fReadOnly)\n         nMinutes = 1;\n \n-    env->dbenv->txn_checkpoint(nMinutes ? gArgs.GetArg(\"-dblogsize\", DEFAULT_WALLET_DBLOGSIZE) * 1024 : 0, nMinutes, 0);\n+    if (env) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: could deal with it earlier (i.e. early return), and use `IsDummy` to make it more explicit.",
    "created_at": "2019-04-10T08:50:15Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273852590",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273852590"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273852590"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273852590/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 617,
    "side": "RIGHT",
    "in_reply_to_id": 272758955
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273855208",
    "pull_request_review_id": 224840029,
    "id": 273855208,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mzg1NTIwOA==",
    "diff_hunk": "@@ -390,10 +389,6 @@ void CWallet::UpgradeKeyMetadata()\n             CPubKey pubkey;\n             if (GetPubKey(meta_pair.first, pubkey)) {\n                 batch->WriteKeyMetadata(meta, pubkey, true);\n-                if (++cnt % 1000 == 0) {\n-                    // avoid creating overlarge in-memory batches in case the wallet contains large amounts of keys\n-                    batch.reset(new WalletBatch(*database));\n-                }",
    "path": "src/wallet/wallet.cpp",
    "position": 37,
    "original_position": 15,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "cc707d5e12a1af1b98084a4c8d9acb183fa8a917",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: could squash this into the previous",
    "created_at": "2019-04-10T08:56:28Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273855208",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273855208"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273855208"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273855208/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 405,
    "original_line": 405,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273856807",
    "pull_request_review_id": 224842056,
    "id": 273856807,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mzg1NjgwNw==",
    "diff_hunk": "@@ -3404,13 +3404,6 @@ bool CWallet::TopUpKeyPool(unsigned int kpSize)\n     return true;\n }\n \n-void CWallet::AddKeypoolPubkey(const CPubKey& pubkey, const bool internal)\n-{\n-    WalletBatch batch(*database);\n-    AddKeypoolPubkeyWithDB(pubkey, internal, batch);\n-    NotifyCanGetAddressesChanged();\n-}\n-",
    "path": "src/wallet/wallet.cpp",
    "position": 234,
    "original_position": 10,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "a14a5ba2f9f7e7a06d4333018226371b49be211b",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: could squash into https://github.com/bitcoin/bitcoin/pull/15741/commits/c088227bd612920f0e2ea3a34d6e5037490d62c2",
    "created_at": "2019-04-10T09:00:11Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273856807",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273856807"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273856807"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273856807/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3374,
    "original_line": 3374,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273859679",
    "pull_request_review_id": 224845603,
    "id": 273859679,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3Mzg1OTY3OQ==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "How about add an optional argument to `WalletBatch` that indicates the # of updates to flush after? This makes the operation opt-in/explicit and also allows for optionally adjusting the flushes to the number of operations - e.g. 2x600 rather than 1000 and 200, if that's desirable.",
    "created_at": "2019-04-10T09:07:22Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273859679",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273859679"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r273859679"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/273859679/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275159416",
    "pull_request_review_id": 226397964,
    "id": 275159416,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NTE1OTQxNg==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Well I may be wrong but I see the batch as an atomic transaction. Making 1500 updates and then aborting the batch should not commit 1000 updates IMO.",
    "created_at": "2019-04-14T14:24:20Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275159416",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275159416"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275159416"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275159416/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162342",
    "pull_request_review_id": 226400986,
    "id": 275162342,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NTE2MjM0Mg==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Well I may be wrong but I see the batch as an atomic transaction. Making 1500 updates and then aborting the batch should not commit 1000 updates IMO.\r\n\r\nExcept that's not how the batch works normally. Batches are not atomic unless you explicitly make them so by starting a transaction with the underlying `BerkeleyBatch`.  In that case, then the flushing won't do anything. In the normal case, each update in a batch itself is atomic and should be expected to be written to the wallet file. There is no aborting. As soon as a batch goes out of scope, every single update is committed to the file. If you make 1500 updates, the first 1000 will be written after you do the 1000th write operation, and then the last 500 will be written when the batch object is deleted.",
    "created_at": "2019-04-14T15:39:24Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275162342",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162342"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275162342"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162851",
    "pull_request_review_id": 226401488,
    "id": 275162851,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NTE2Mjg1MQ==",
    "diff_hunk": "@@ -390,10 +389,6 @@ void CWallet::UpgradeKeyMetadata()\n             CPubKey pubkey;\n             if (GetPubKey(meta_pair.first, pubkey)) {\n                 batch->WriteKeyMetadata(meta, pubkey, true);\n-                if (++cnt % 1000 == 0) {\n-                    // avoid creating overlarge in-memory batches in case the wallet contains large amounts of keys\n-                    batch.reset(new WalletBatch(*database));\n-                }",
    "path": "src/wallet/wallet.cpp",
    "position": 37,
    "original_position": 15,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "cc707d5e12a1af1b98084a4c8d9acb183fa8a917",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-04-14T15:51:33Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275162851",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162851"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275162851"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162851/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 405,
    "original_line": 405,
    "side": "LEFT",
    "in_reply_to_id": 273855208
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162855",
    "pull_request_review_id": 226401492,
    "id": 275162855,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NTE2Mjg1NQ==",
    "diff_hunk": "@@ -3404,13 +3404,6 @@ bool CWallet::TopUpKeyPool(unsigned int kpSize)\n     return true;\n }\n \n-void CWallet::AddKeypoolPubkey(const CPubKey& pubkey, const bool internal)\n-{\n-    WalletBatch batch(*database);\n-    AddKeypoolPubkeyWithDB(pubkey, internal, batch);\n-    NotifyCanGetAddressesChanged();\n-}\n-",
    "path": "src/wallet/wallet.cpp",
    "position": 234,
    "original_position": 10,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "a14a5ba2f9f7e7a06d4333018226371b49be211b",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-04-14T15:51:38Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275162855",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162855"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275162855"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162855/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 3374,
    "original_line": 3374,
    "side": "LEFT",
    "in_reply_to_id": 273856807
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162888",
    "pull_request_review_id": 226401517,
    "id": 275162888,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI3NTE2Mjg4OA==",
    "diff_hunk": "@@ -614,7 +614,9 @@ void BerkeleyBatch::Flush()\n     if (fReadOnly)\n         nMinutes = 1;\n \n-    env->dbenv->txn_checkpoint(nMinutes ? gArgs.GetArg(\"-dblogsize\", DEFAULT_WALLET_DBLOGSIZE) * 1024 : 0, nMinutes, 0);\n+    if (env) {",
    "path": "src/wallet/db.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`IsDummy` is done by `BerkeleyDatabase`, not `BerkeleyBatch` so is not available to do here (although the check is completely identical).",
    "created_at": "2019-04-14T15:52:26Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275162888",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162888"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r275162888"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/275162888/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 617,
    "side": "RIGHT",
    "in_reply_to_id": 272758955
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284786945",
    "pull_request_review_id": 238496227,
    "id": 284786945,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDc4Njk0NQ==",
    "diff_hunk": "@@ -1288,20 +1289,20 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             }\n              const CPubKey& pubkey = entry->second;\n              CPubKey temp;\n-             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnly(GetScriptForRawPubKey(pubkey), timestamp)) {\n+             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnlyWithDB(batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n             }\n             pwallet->mapKeyMetadata[id].nCreateTime = timestamp;\n \n             // Add to keypool only works with pubkeys\n             if (add_keypool) {\n-                pwallet->AddKeypoolPubkey(pubkey, internal);\n+                pwallet->AddKeypoolPubkeyWithDB(pubkey, internal, batch);",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 37,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "68d2fa32df7133569b5ef93e56cc727feb200b1c",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`NotifyCanGetAddressesChanged()` (I already tested that fixes QT receive screen)",
    "created_at": "2019-05-16T16:10:55Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r284786945",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284786945"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r284786945"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284786945/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1299,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284795411",
    "pull_request_review_id": 238496227,
    "id": 284795411,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NDc5NTQxMQ==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "So is the description of `WalletBatch` out of date? It says `This represents a single transaction at the database. It will be committed when the object goes out of scope.`",
    "created_at": "2019-05-16T16:31:40Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r284795411",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284795411"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r284795411"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/284795411/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285347845",
    "pull_request_review_id": 239204091,
    "id": 285347845,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NTM0Nzg0NQ==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I believe that is out of date",
    "created_at": "2019-05-18T16:21:45Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r285347845",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285347845"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r285347845"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285347845/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285348097",
    "pull_request_review_id": 239204384,
    "id": 285348097,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NTM0ODA5Nw==",
    "diff_hunk": "@@ -157,6 +157,9 @@ class WalletBatch\n             return false;\n         }\n         m_database.IncrementUpdateCounter();\n+        if (m_database.nUpdateCounter % 1000 == 0) {",
    "path": "src/wallet/walletdb.h",
    "position": 19,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "f2b9b32a63b5ff544334e15c2c8040a2572e920c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I've updated the comment.",
    "created_at": "2019-05-18T16:30:36Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r285348097",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285348097"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r285348097"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285348097/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 162,
    "original_line": 162,
    "side": "RIGHT",
    "in_reply_to_id": 272757790
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285348102",
    "pull_request_review_id": 239204389,
    "id": 285348102,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4NTM0ODEwMg==",
    "diff_hunk": "@@ -1288,20 +1289,20 @@ static UniValue ProcessImport(CWallet * const pwallet, const UniValue& data, con\n             }\n              const CPubKey& pubkey = entry->second;\n              CPubKey temp;\n-             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnly(GetScriptForRawPubKey(pubkey), timestamp)) {\n+             if (!pwallet->GetPubKey(id, temp) && !pwallet->AddWatchOnlyWithDB(batch, GetScriptForRawPubKey(pubkey), timestamp)) {\n                 throw JSONRPCError(RPC_WALLET_ERROR, \"Error adding address to wallet\");\n             }\n             pwallet->mapKeyMetadata[id].nCreateTime = timestamp;\n \n             // Add to keypool only works with pubkeys\n             if (add_keypool) {\n-                pwallet->AddKeypoolPubkey(pubkey, internal);\n+                pwallet->AddKeypoolPubkeyWithDB(pubkey, internal, batch);",
    "path": "src/wallet/rpcdump.cpp",
    "position": null,
    "original_position": 37,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "68d2fa32df7133569b5ef93e56cc727feb200b1c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-05-18T16:30:41Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r285348102",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285348102"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r285348102"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/285348102/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1299,
    "side": "RIGHT",
    "in_reply_to_id": 284786945
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287886771",
    "pull_request_review_id": 242395477,
    "id": 287886771,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4Nzg4Njc3MQ==",
    "diff_hunk": "@@ -1204,6 +1204,7 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n \n     /** Unsets a single wallet flag */\n     void UnsetWalletFlag(uint64_t flag);\n+    void UnsetWalletFlagWithDB(WalletBatch& batch, uint64_t flag);",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "87f7befca04a095a06af003f9fe20d2e3c155d2f",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: could be `private`",
    "created_at": "2019-05-27T21:54:00Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r287886771",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287886771"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r287886771"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287886771/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1207,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287886940",
    "pull_request_review_id": 242395685,
    "id": 287886940,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4Nzg4Njk0MA==",
    "diff_hunk": "@@ -872,6 +883,7 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n     //! Adds an encrypted key to the store, without saving it to disk (used by LoadWallet)\n     bool LoadCryptedKey(const CPubKey &vchPubKey, const std::vector<unsigned char> &vchCryptedSecret);\n     bool AddCScript(const CScript& redeemScript) override;\n+    bool AddCScriptWithDB(WalletBatch& batch, const CScript& script);",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 42,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "87f7befca04a095a06af003f9fe20d2e3c155d2f",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: could be `private`",
    "created_at": "2019-05-27T21:56:00Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r287886940",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287886940"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r287886940"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/287886940/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 886,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288153384",
    "pull_request_review_id": 242733062,
    "id": 288153384,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4ODE1MzM4NA==",
    "diff_hunk": "@@ -1204,6 +1204,7 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n \n     /** Unsets a single wallet flag */\n     void UnsetWalletFlag(uint64_t flag);\n+    void UnsetWalletFlagWithDB(WalletBatch& batch, uint64_t flag);",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 4,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "87f7befca04a095a06af003f9fe20d2e3c155d2f",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-05-28T15:04:06Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r288153384",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288153384"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r288153384"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288153384/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 1207,
    "side": "RIGHT",
    "in_reply_to_id": 287886771
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288153407",
    "pull_request_review_id": 242733093,
    "id": 288153407,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4ODE1MzQwNw==",
    "diff_hunk": "@@ -872,6 +883,7 @@ class CWallet final : public CCryptoKeyStore, private interfaces::Chain::Notific\n     //! Adds an encrypted key to the store, without saving it to disk (used by LoadWallet)\n     bool LoadCryptedKey(const CPubKey &vchPubKey, const std::vector<unsigned char> &vchCryptedSecret);\n     bool AddCScript(const CScript& redeemScript) override;\n+    bool AddCScriptWithDB(WalletBatch& batch, const CScript& script);",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 42,
    "commit_id": "0db94e55dcbbfc741df463c404818d9033b4fff1",
    "original_commit_id": "87f7befca04a095a06af003f9fe20d2e3c155d2f",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2019-05-28T15:04:10Z",
    "updated_at": "2019-05-28T15:04:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r288153407",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288153407"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/15741#discussion_r288153407"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15741"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/288153407/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 886,
    "side": "RIGHT",
    "in_reply_to_id": 287886940
  }
]