[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/531651205",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-531651205",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 531651205,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTY1MTIwNQ==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-16T06:05:05Z",
    "updated_at": "2020-07-08T01:15:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/531651205/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/531716989",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-531716989",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 531716989,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTcxNjk4OQ==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-16T10:13:28Z",
    "updated_at": "2019-09-16T10:13:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK\r\n\r\nNice work! If you have the time: consider tackling the remaining `test_deterministic_coverage.sh` suppressions in follow-up PRs. Deterministic line coverage would be great to have! :)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/531716989/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/531773138",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-531773138",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 531773138,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTc3MzEzOA==",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?u=f94120f8b9ec3087fa4792dc4c2f56a8aff1aaa0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-16T13:20:02Z",
    "updated_at": "2019-09-16T13:20:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Concept ACK\r\n> \r\n> Nice work! If you have the time: consider tackling the remaining `test_deterministic_coverage.sh` suppressions in follow-up PRs. Deterministic line coverage would be great to have! :)\r\n\r\nThanks for the review! I addressed your remarks in ffd3953. I indeed plan to tackle those in my free time.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/531773138/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533520776",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-533520776",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 533520776,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzUyMDc3Ng==",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?u=f94120f8b9ec3087fa4792dc4c2f56a8aff1aaa0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-20T11:48:50Z",
    "updated_at": "2019-09-20T11:48:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Could somebody explain why it's not allowed to include `boost/test/unit_test_parameters.hpp`?\r\n```\r\nA new Boost dependency in the form of \"boost/test/unit_test_parameters.hpp\" appears to have been introduced:\r\n\r\nsrc/test/denialofservice_tests.cpp:#include <boost/test/unit_test_parameters.hpp>\r\n\r\n^---- failure generated from test/lint/lint-includes.sh\r\n```\r\nI need it to access the `BOOST_TEST_RANDOM` parameter from within a test. Is there a better way to do it?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533520776/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533525660",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-533525660",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 533525660,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzUyNTY2MA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-20T12:05:19Z",
    "updated_at": "2019-09-20T12:05:19Z",
    "author_association": "MEMBER",
    "body": "I guess, you'd have to add it like this:\r\n\r\n```diff\r\ndiff --git a/test/lint/lint-includes.sh b/test/lint/lint-includes.sh\r\nindex d27e45a23f..c9e1d57ee1 100755\r\n--- a/test/lint/lint-includes.sh\r\n+++ b/test/lint/lint-includes.sh\r\n@@ -68,6 +68,7 @@ EXPECTED_BOOST_INCLUDES=(\r\n     boost/signals2/last_value.hpp\r\n     boost/signals2/signal.hpp\r\n     boost/test/unit_test.hpp\r\n+    boost/test/unit_test_parameters.hpp\r\n     boost/thread.hpp\r\n     boost/thread/condition_variable.hpp\r\n     boost/thread/mutex.hpp\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533525660/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533856395",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-533856395",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 533856395,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzg1NjM5NQ==",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?u=f94120f8b9ec3087fa4792dc4c2f56a8aff1aaa0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-22T07:17:44Z",
    "updated_at": "2019-09-22T07:17:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "@MarcoFalke I see that the changes I made regarding setting the seed to `BOOST_TEST_RANDOM` are causing some trouble - some Travis builds fail while succeeding for me locally so I'm not sure how to debug that as well as the fact that the boost interface might change and I also feel that this is going a bit out of scope for this pull request which aims to make DoS_mapOrphans have deterministic coverage.\r\nWould it be ok if I leave the test with a random, unknown seed for now (that was the case before anyway) and just leave the changes that make the coverage deterministic for this test? I will then attempt to tackle the problem of setting the seed to `BOOST_TEST_RANDOM` in `BasicTestingSetup` in a separate pull request?\r\nOverall, I think this would still add positive value, as this test would have deterministic coverage, as opposed to before, with all else being equal.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533856395/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533910107",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-533910107",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 533910107,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzkxMDEwNw==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-22T19:24:09Z",
    "updated_at": "2019-09-22T19:24:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "ACK ffd3953757051ac50cea4129edbd9e9d5be39d0f -- diff looks correct",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/533910107/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534525858",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-534525858",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 534525858,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNDUyNTg1OA==",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?u=f94120f8b9ec3087fa4792dc4c2f56a8aff1aaa0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-24T12:00:59Z",
    "updated_at": "2019-09-24T12:00:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "How can I remove the \"Waiting for author\" label?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/534525858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/538098710",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-538098710",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 538098710,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzODA5ODcxMA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-03T19:45:04Z",
    "updated_at": "2019-10-03T19:45:04Z",
    "author_association": "MEMBER",
    "body": "Have you seen #16978, which should fix the reproducibility issue",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/538098710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545937714",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-545937714",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 545937714,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTkzNzcxNA==",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?u=f94120f8b9ec3087fa4792dc4c2f56a8aff1aaa0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-24T14:13:40Z",
    "updated_at": "2019-10-24T14:13:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "@laanwj  This PR is waiting for additional reviews, so I don't think this should be labeled as 'Waiting for author'?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/545937714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643754707",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-643754707",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 643754707,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Mzc1NDcwNw==",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?u=f94120f8b9ec3087fa4792dc4c2f56a8aff1aaa0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-14T11:39:10Z",
    "updated_at": "2020-06-14T11:47:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks very much for the review @jonatack ! I rebased on the latest master and addressed the nits in  d90308b.\r\nCould somebody please re-run the travis job? Looks like it timed out on ARM.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/643754707/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659194950",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-659194950",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 659194950,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1OTE5NDk1MA==",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?u=f94120f8b9ec3087fa4792dc4c2f56a8aff1aaa0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-16T06:46:55Z",
    "updated_at": "2020-07-16T06:46:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm running this test multiple times with the `contrib/devtools/test_deterministic_coverage.sh` script and out of 590 runs it detected non-deterministic coverage twice, in a seemingly unrelated location. This line https://github.com/bitcoin/bitcoin/blob/9a714c51dc79993506718617e383294cf6bff0b4/src/checkqueue.h#L99 very rarely doesn't run. I'm thinking that maybe some tests which are not in the list of non-deterministic tests in this script: https://github.com/bitcoin/bitcoin/blob/9a714c51dc79993506718617e383294cf6bff0b4/contrib/devtools/test_deterministic_coverage.sh#L16 might also have non-deterministic behavior if run enough times with the script.\r\n@practicalswift Can you say how many times the script ran for each test before it was considered to be deterministic? I guess there is some threshold number of runs such that if non-deterministic behavior doesn't appear during those runs then this test is considered to be deterministic 'enough'. Is 2 out of 590 runs above or below that threshold?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659194950/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659225225",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-659225225",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 659225225,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1OTIyNTIyNQ==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-16T07:49:21Z",
    "updated_at": "2020-07-16T07:49:21Z",
    "author_association": "MEMBER",
    "body": "You don't need to solve all issues. As long as something is an improvement, it should be good to go",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659225225/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659244243",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-659244243",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 659244243,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1OTI0NDI0Mw==",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?u=5ff13e375b40ea55ecd3c108337dd6a23f68eddf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-16T08:22:11Z",
    "updated_at": "2020-07-16T08:22:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "@davereikher \r\n\r\n> @practicalswift Can you say how many times the script ran for each test before it was considered to be deterministic? I guess there is some threshold number of runs such that if non-deterministic behavior doesn't appear during those runs then this test is considered to be deterministic 'enough'. Is 2 out of 590 runs above or below that threshold?\r\n\r\nPersonally I think 2 out of 590 runs is a great improvement compared to the current state of things: great job! :)\r\n\r\nThanks for tackling testing non-determinism!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659244243/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659265434",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-659265434",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 659265434,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1OTI2NTQzNA==",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?u=f94120f8b9ec3087fa4792dc4c2f56a8aff1aaa0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-16T09:00:13Z",
    "updated_at": "2020-07-16T10:20:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Personally I think 2 out of 590 runs is a great improvement compared to the current state of things: great job! :)\r\n> \r\n> Thanks for tackling testing non-determinism!\r\n\r\nThanks @practicalswift , so do you think this test should be removed from the list of non-deterministic tests then?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/659265434/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/660649155",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-660649155",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 660649155,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MDY0OTE1NQ==",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?u=f94120f8b9ec3087fa4792dc4c2f56a8aff1aaa0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-19T14:09:32Z",
    "updated_at": "2020-07-19T14:09:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, I think it's done. As [stated](https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-659194950), there is still some non-determinism, but it occurs once every several hundred rounds in an unrelated location. I'm assuming it's below the threshold of non-determinism, so I removed this test from the list of non-deterministic tests in `contrib/devtools/test_deterministic_coverage.sh`.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/660649155/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/661676597",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-661676597",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/16878",
    "id": 661676597,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MTY3NjU5Nw==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-21T07:05:50Z",
    "updated_at": "2020-07-21T07:05:50Z",
    "author_association": "MEMBER",
    "body": "ACK 4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/661676597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324598079",
    "pull_request_review_id": 288528958,
    "id": 324598079,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDU5ODA3OQ==",
    "diff_hunk": "@@ -391,7 +418,14 @@ BOOST_AUTO_TEST_CASE(DoS_mapOrphans)\n     // ... and 50 that depend on other orphans:\n     for (int i = 0; i < 50; i++)\n     {\n-        CTransactionRef txPrev = RandomOrphan();\n+        CTransactionRef txPrev;\n+        if (0 == i) {\n+            // This block makes sure that the condition \"if (it == mapOrphanTransactions.end())\" in OrphanByIndex() gets called at least once.\n+            // Otherwise test coverage is non-deterministic.\n+            txPrev = OrphanByIndex(ArithToUint256(arith_uint256(LARGE_NUMBER)));",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 69,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "bf2637cc321b911959278837b657a1750194cb8c",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Could use `std::numeric_limits<uint64_t>::max()` instead of `LARGE_NUMBER`? :)",
    "created_at": "2019-09-16T10:15:45Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324598079",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324598079"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324598079"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324598079/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 425,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324598676",
    "pull_request_review_id": 288529722,
    "id": 324598676,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDU5ODY3Ng==",
    "diff_hunk": "@@ -391,7 +418,14 @@ BOOST_AUTO_TEST_CASE(DoS_mapOrphans)\n     // ... and 50 that depend on other orphans:\n     for (int i = 0; i < 50; i++)\n     {\n-        CTransactionRef txPrev = RandomOrphan();\n+        CTransactionRef txPrev;\n+        if (0 == i) {",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 66,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "bf2637cc321b911959278837b657a1750194cb8c",
    "user": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit: Could avoid non-repo-idiomatic yoda notation :)",
    "created_at": "2019-09-16T10:17:27Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324598676",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324598676"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324598676"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324598676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 422,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324672285",
    "pull_request_review_id": 288624423,
    "id": 324672285,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDY3MjI4NQ==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Looks like the wrong location for this. I fail to understand what CPubKey has to do with the orphan map or even DoS?!",
    "created_at": "2019-09-16T13:24:56Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324672285",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324672285"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324672285"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324672285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324686941",
    "pull_request_review_id": 288643551,
    "id": 324686941,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDY4Njk0MQ==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks for the review! While trying to understand the non-determinism in the coverage, I used the script `contrib/devtools/test_deterministic_coverage.sh`, which uses `gcovr` to show the diff in which lines were and which ones were not executed between two runs with different coverage. \r\n\r\nOver multiple runs of the script, the only two places where the coverage was non-deterministic were: \r\n\r\n- the function `RandomOrphan` in denialofservice_tests.cpp \r\n- lines 135-136, 147-148 in pubkey.cpp, in the function `ecdsa_signature_parse_der_lax`. \r\n\r\nThe latter function is called implicitly from the test `DoS_mapOrphans` via `SignSignature` (`SignSignature` => `ProduceSignature` => `VerifyScript` => `EvalScript` => `CheckSig` => `VerifySignature` => `Verify` => `ecdsa_signature_parse_der_lax`). The private key which generates the signatures in the test `DoS_mapOrphans` is randomly generated, so the `R` and `S` values of the ECDSA signatures for the inputs of the dependant orphans most of the time do not have leading zeros. The lines 135-136, 147-148 run only when there are leading zeroes in `R`, `S`, respectively. This results in those lines sometimes running and sometimes not. \r\n\r\nMy proposed solution is to create a constant signature with leading zeroes in both `R` and `S` and force the function `ecdsa_signature_parse_der_lax` to run on that signature by calling `CPubkey::Verify` on that signature and a corresponding pubkey and hash. This forces the lines 135-136, 147-148 in pubkey.cpp to always run at least once, resulting in deterministic test coverage.",
    "created_at": "2019-09-16T13:52:10Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324686941",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324686941"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324686941"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324686941/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324692872",
    "pull_request_review_id": 288651530,
    "id": 324692872,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDY5Mjg3Mg==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I see. A smaller alternative would be to set the key to a constant?",
    "created_at": "2019-09-16T14:03:07Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324692872",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324692872"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324692872"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324692872/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324713835",
    "pull_request_review_id": 288679280,
    "id": 324713835,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDcxMzgzNQ==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "That could be nice actually if it's acceptable. I didn't want to do it initially because I didn't want to modify the test too much and restricted myself to 'parasitic' changes.\r\nOn the other hand - if I'm not mistaken, this will not work directly, since, if we have transaction B which is using as an input an output from transaction A, part of the data used to calculate the hash of that input for B (this hash is then signed to produce `R` and `S`) is the hash of the transaction A, which contains a random element (the initial non-dependant 50 orphans are created with `tx.vin[0].prevout.hash = InsecureRand256()`), so `R` and `S` would again be random.\r\n\r\nI guess I could use an engineered, non-random value for `tx.vin[0].prevout.hash` for one of the orphans along with an engineered fixed key. But then again, this test would loose the fuzzing feature of making a different key every run.\r\n\r\nWhat do you think?",
    "created_at": "2019-09-16T14:41:02Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324713835",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324713835"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324713835"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324713835/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324719530",
    "pull_request_review_id": 288686677,
    "id": 324719530,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNDcxOTUzMA==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`InsecureRand256` is an alias for `g_insecure_rand_ctx.rand256()`, so it can be made deterministic with a call to `SeedInsecureRand(/* deterministic */ true)`.\r\n\r\n> this test would loose the fuzzing feature of making a different key every run.\r\n\r\nThis \"fuzzing feature\" is useless, as a failure could not be reproduced (when it occurs) and thus not debugged, nor fixed.\r\n\r\nWhen fuzzing is desired, the seed would have to be written to a file or stdout.",
    "created_at": "2019-09-16T14:50:51Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324719530",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324719530"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r324719530"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/324719530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325090401",
    "pull_request_review_id": 289160952,
    "id": 325090401,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTA5MDQwMQ==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I see. Then I can just set a seed which guarantees the widest coverage in the beginning of the test and that should take care of the non-determinism in both `RandomOrphan` and `ecdsa_signature_parse_der_lax`, making the code much simpler.\r\n\r\nStill, I would argue that it's best to leave the fuzzing and write the seed to a file. That would result in an a better coverage over a long period of time. There might be some branches that run very rarely and setting the seed to a constant would prevent them from ever running in the future in the context of this test, reducing it's long-term coverage. As an example the conditions on lines 151, 157, 160 in pubkey.cpp, in `ecdsa_signature_parse_der_lax` may evaluate to false or true. Although their evaluation was deterministic throughout the 1000+ runs I tried and I haven't gone in-depth to try and understand whether they can at all run under this test's conditions or whether they run extremely rarely, but the latter option can be true for other branches I haven't checked.\r\nUnless handling artifacts created by tests involves a lot of overhead, the only disadvantage I see to leaving the fuzzing is more lines of code in the test, some of it being irrelevant to the functionality of the test itself, but I think that is taken care of by a detailed comment explaining the logic for the extra code.",
    "created_at": "2019-09-17T10:20:42Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325090401",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325090401"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325090401"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325090401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325104042",
    "pull_request_review_id": 289178852,
    "id": 325104042,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTEwNDA0Mg==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yeah, up to you if you feel strongly. My opinion is that we shouldn't mix unit tests with fuzz tests, which are designed and compiled separately, see https://github.com/bitcoin/bitcoin/blob/master/doc/fuzzing.md",
    "created_at": "2019-09-17T10:56:20Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325104042",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325104042"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325104042"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325104042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325492476",
    "pull_request_review_id": 289682474,
    "id": 325492476,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTQ5MjQ3Ng==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I agree that fuzz tests should be separate and I wasn't familiar with `src/test/fuzz`. Thanks for pointing me there. However, reading through https://github.com/bitcoin/bitcoin/pull/16320, there are some comments about the positive value of non-determinism in tests (I was trying to understand if the direction is to completely eliminate non-determinism). I think that an effort should be made when writing new tests towards determinism and separating the fuzzy parts into the fuzz framework, but since this test already has non-determinism, I think I will stick with writing the seed to stdout. Separating the fuzzy from the non-fuzzy parts should perhaps be a part of another pull request.\r\nThat brings the question - there are a lot of tests that use random values. I completely agree that randomness in tests is practically useless unless the seed is known. What do you think about setting and writing the seed to stdout as part of the `BasicTestingSetup` fixture so that seeds for all tests are known? This would also prevent code duplication when multiple tests require this.",
    "created_at": "2019-09-18T05:54:03Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325492476",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325492476"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325492476"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325492476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325599568",
    "pull_request_review_id": 289819288,
    "id": 325599568,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTU5OTU2OA==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "We already use `BOOST_TEST_RANDOM` https://www.boost.org/doc/libs/1_71_0/libs/test/doc/html/boost_test/utf_reference/rt_param_reference/random.html, which is logged. So might as well use that as the seed for our test rng?",
    "created_at": "2019-09-18T10:29:15Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325599568",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325599568"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325599568"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325599568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325697287",
    "pull_request_review_id": 289947887,
    "id": 325697287,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTY5NzI4Nw==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sounds good. Do you suggest seeding the rng with `BOOST_TEST_RANDOM` in `BasicTestingSetup` or only in this test for now? I'm thinking the latter, since otherwise it changes the behaviour of all tests that use random numbers when running them locally and it would require adjusting the test execution scripts, as now the seed must be provided externally. For example, `test_deterministic_coverage.sh` will always show deterministic coverage when run locally unless we provide a different value of `BOOST_TEST_RANDOM` every time it's run. I feel handling those issues would be out of the scope of this pull request and may be done separately?",
    "created_at": "2019-09-18T14:08:47Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325697287",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325697287"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325697287"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325697287/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325702113",
    "pull_request_review_id": 289954077,
    "id": 325702113,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTcwMjExMw==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> test_deterministic_coverage.sh will always show deterministic coverage when run locally unless we provide a different value of BOOST_TEST_RANDOM every time it's run. I feel handling those issues would be out of the scope of this pull request and may be done separately?\r\n\r\nI think this is the way the script should work (report non-determinism even when the rng seed is pinned to a constant). As suggested by you this should be done in a separate pull request. Are you interested in working on this as well? Otherwise I will create an issue for others to pick up.",
    "created_at": "2019-09-18T14:16:58Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325702113",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325702113"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325702113"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325702113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325725391",
    "pull_request_review_id": 289984858,
    "id": 325725391,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNTcyNTM5MQ==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, that sounds interesting, since IMO recording the seed for any test that uses random values is important. I'll check whether pinning the seed still results in non determinism between runs and based on that I'll see what can be done about it and about setting the seed to `BOOST_TEST_RANDOM` in `BasicTestingSetup`.\r\nFor now, I guess setting the seed to `BOOST_TEST_RANDOM` just inside this test would be enough?",
    "created_at": "2019-09-18T14:55:44Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325725391",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325725391"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r325725391"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/325725391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 324672285
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326598869",
    "pull_request_review_id": 291123230,
    "id": 326598869,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNjU5ODg2OQ==",
    "diff_hunk": "@@ -393,6 +394,8 @@ static void ForceCoverageInPubKeyVerify()\n \n BOOST_AUTO_TEST_CASE(DoS_mapOrphans)\n {\n+    SeedInsecureRand(ArithToUint256(arith_uint256(boost::unit_test::runtime_config::get<unsigned>( boost::unit_test::runtime_config::btrt_random_seed ))));",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 12,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "bae45e8ab484002451c84c5e0d1ec57f38def48e",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I guess you could move this logic into a helper `SeedInsecureRandWithBoostRandomSeed`?",
    "created_at": "2019-09-20T12:12:22Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r326598869",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326598869"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r326598869"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326598869/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 397,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326675636",
    "pull_request_review_id": 291226952,
    "id": 326675636,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNjY3NTYzNg==",
    "diff_hunk": "@@ -43,6 +45,16 @@ static inline void SeedInsecureRand(bool deterministic = false)\n     g_insecure_rand_ctx = FastRandomContext(deterministic);\n }\n \n+static inline void SeedInsecureRand(const uint256& seed)\n+{\n+    g_insecure_rand_ctx = FastRandomContext(seed);\n+}\n+\n+static inline void SeedInsecureRandWithBoostRandomSeed()\n+{\n+    SeedInsecureRand(ArithToUint256(arith_uint256(boost::unit_test::runtime_config::get<unsigned>( boost::unit_test::runtime_config::btrt_random_seed ))));",
    "path": "src/test/setup_common.h",
    "position": null,
    "original_position": 24,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "f2e7f8b02b49ca747158b8373f6ea90de9833b38",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "not sure how stable that boost interface is. They seem to change it every couple of versions",
    "created_at": "2019-09-20T15:11:08Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r326675636",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326675636"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r326675636"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326675636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 55,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326857875",
    "pull_request_review_id": 291463001,
    "id": 326857875,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMyNjg1Nzg3NQ==",
    "diff_hunk": "@@ -43,6 +45,16 @@ static inline void SeedInsecureRand(bool deterministic = false)\n     g_insecure_rand_ctx = FastRandomContext(deterministic);\n }\n \n+static inline void SeedInsecureRand(const uint256& seed)\n+{\n+    g_insecure_rand_ctx = FastRandomContext(seed);\n+}\n+\n+static inline void SeedInsecureRandWithBoostRandomSeed()\n+{\n+    SeedInsecureRand(ArithToUint256(arith_uint256(boost::unit_test::runtime_config::get<unsigned>( boost::unit_test::runtime_config::btrt_random_seed ))));",
    "path": "src/test/setup_common.h",
    "position": null,
    "original_position": 24,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "f2e7f8b02b49ca747158b8373f6ea90de9833b38",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Is there a better way to access this value? Maybe directly access the environment variable using std::getenv?",
    "created_at": "2019-09-21T12:07:22Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r326857875",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326857875"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r326857875"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/326857875/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 55,
    "side": "RIGHT",
    "in_reply_to_id": 326675636
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/331220386",
    "pull_request_review_id": 297108577,
    "id": 331220386,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzMTIyMDM4Ng==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Still don't like this, maybe it can be removed after https://github.com/bitcoin/bitcoin/pull/16878#issuecomment-538098710 ?",
    "created_at": "2019-10-03T19:46:58Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r331220386",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/331220386"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r331220386"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/331220386/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/331741093",
    "pull_request_review_id": 297784620,
    "id": 331741093,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzMTc0MTA5Mw==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Actually, I ran the `DoS_mapOrphans` test to test the initial version of #16978 and even though the seed was the same between different runs, I still got non-deterministic behaviour for this test. The non-determinism originated from the size of the `mapOrphanTransactions` map. It was different for each run. I didn't dive into the source code to understand why exactly that is but I suspect that it's due to concurrency issues, since the seed was fixed between runs (I printed some `uint256`'s generated by `InsecureRand256()` to make sure and they were the same between runs),  unless there is another, differently seeded RNG used in the process of populating `mapOrphanTransactions`. In any case, if I understand correctly, #16978  is a great solution for setting the seed externally and for logging it, but it won't remove the non-determinism between test runs of this particular test, since I suspect that the non-determinism in this test arises due to concurrency and not due to seeding of an RNG. Though I agree that the fix is ugly, this is unfortunately the only way I can see of fixing the non-deterministic coverage issue for this particular test.",
    "created_at": "2019-10-05T09:50:45Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r331741093",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/331741093"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r331741093"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/331741093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 331220386
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/332149229",
    "pull_request_review_id": 298297425,
    "id": 332149229,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDMzMjE0OTIyOQ==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */\n+static void ForceCoverageInPubKeyVerify()\n+{\n+    std::string coverage_pubkey_str(\"\\x03\\x1c\\xef\\xd3\\xfa\\x1e\\x91\\xd2\\x24\\x7e\\x9d\\x74\\xa1\\xf4\\x31\\x27\\x6e\\xe4\\x74\"\n+        \"\\x5b\\xaf\\x73\\x1d\\xb0\\x0c\\x07\\xa0\\x78\\x81\\xa5\\xca\\x4c\\xc9\", 33);\n+    CPubKey coverage_pubkey(coverage_pubkey_str.begin(), coverage_pubkey_str.end());\n+    std::string vch_sig_str(\"\\x30\\x44\\x02\\x20\\x00\\xa8\\x9f\\x92\\xf4\\x47\\x6e\\x3f\\x0b\\x1f\\x58\\x9f\\x6b\\x3b\\xb9\\xae\\xc0\"\n+        \"\\x99\\x84\\x82\\x22\\x40\\x68\\xf5\\x12\\xf7\\x43\\xbe\\xa7\\x54\\x87\\x7c\\x02\\x20\\x00\\xa1\\x09\\x98\\x60\\x32\\x32\\x71\\x34\"\n+        \"\\xad\\xf6\\x6a\\x9c\\x2f\\xd9\\xd4\\xf3\\xcc\\xf4\\xc8\\x4c\\x38\\xbb\\xd0\\xac\\xde\\xa7\\x3d\\x66\\x28\\xa0\\xe0\", 70);\n+    uint256 hash;\n+    hash.SetHex(std::string(\"6af516422fef8a745aff6acdcc84076c77fb2ecd72bd5711df301230ac58fdd5\"));\n+\n+    coverage_pubkey.Verify(hash, std::vector<unsigned char>(vch_sig_str.begin(), vch_sig_str.end()));\n+}",
    "path": "src/test/denialofservice_tests.cpp",
    "position": 23,
    "original_position": 46,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hmm, ok. Will see if other have an opinion on this.",
    "created_at": "2019-10-07T17:41:54Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r332149229",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/332149229"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r332149229"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/332149229/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 325,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 331220386
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438947512",
    "pull_request_review_id": 429125380,
    "id": 438947512,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk0NzUxMg==",
    "diff_hunk": "@@ -16,6 +16,8 @@\n #include <util/system.h>\n #include <util/time.h>\n #include <validation.h>\n+#include <arith_uint256.h>\n+#include <pubkey.h>",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: sort",
    "created_at": "2020-06-11T17:22:38Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r438947512",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438947512"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r438947512"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438947512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 20,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438956486",
    "pull_request_review_id": 429125380,
    "id": 438956486,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk1NjQ4Ng==",
    "diff_hunk": "@@ -356,16 +358,39 @@ BOOST_AUTO_TEST_CASE(DoS_bantime)\n     peerLogic->FinalizeNode(dummyNode.GetId(), dummy);\n }\n \n-static CTransactionRef RandomOrphan()\n+static CTransactionRef OrphanByIndex(const uint256& orphan_index)\n {\n     std::map<uint256, COrphanTx>::iterator it;\n     LOCK2(cs_main, g_cs_orphans);\n-    it = mapOrphanTransactions.lower_bound(InsecureRand256());\n+    it = mapOrphanTransactions.lower_bound(orphan_index);\n     if (it == mapOrphanTransactions.end())\n         it = mapOrphanTransactions.begin();\n     return it->second.tx;\n }\n \n+static CTransactionRef RandomOrphan()\n+{\n+    return OrphanByIndex(InsecureRand256());\n+}\n+\n+/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\n+ * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\n+ * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\n+ */",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 33,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "ffd3953757051ac50cea4129edbd9e9d5be39d0f",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "suggestion\r\n```diff\r\n-/** This function runs CPubkey::Verify with parameters that result in all branches of the function ecdsa_signature_parse_der_lax to run. Namely, the signature literal\r\n- * in vch_sig_str in the following function is comprised of R and S values which both contain leading zeroes, forcing some branches of said function to run which\r\n- * would otherwise not. This function is called at the end of the DoS_mapOrphans test to force deterministic coverage.\r\n+/** This function runs CPubkey::Verify with parameters that result in all\r\n+ * branches of the function ecdsa_signature_parse_der_lax to run. Namely, the\r\n+ * signature literal in vch_sig_str in the following function is comprised of R\r\n+ * and S values which both contain leading zeroes, forcing some branches of said\r\n+ * function to run which would otherwise not. This function is called at the end\r\n+ * of the DoS_mapOrphans test to force deterministic coverage.\r\n  */\r\n```",
    "created_at": "2020-06-11T17:38:42Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r438956486",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438956486"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r438956486"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/438956486/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 382,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439824826",
    "pull_request_review_id": 430214973,
    "id": 439824826,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgyNDgyNg==",
    "diff_hunk": "@@ -391,7 +419,14 @@ BOOST_AUTO_TEST_CASE(DoS_mapOrphans)\n     // ... and 50 that depend on other orphans:\n     for (int i = 0; i < 50; i++)\n     {\n-        CTransactionRef txPrev = RandomOrphan();\n+        CTransactionRef txPrev;\n+        if (i == 0) {\n+            // This block makes sure that the condition \"if (it == mapOrphanTransactions.end())\" in OrphanByIndex() gets called at least once.\n+            // Otherwise test coverage is non-deterministic.\n+            txPrev = OrphanByIndex(ArithToUint256(arith_uint256(std::numeric_limits<uint64_t>::max())));",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 67,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "d90308badb68760af103c93217dd549ddf269563",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "instead of hardcoding special cases, I'd prefer if the txids were just derived from a deterministic fast random context. If you want, you can explicitly seed it so that the condition is hit at least once.",
    "created_at": "2020-06-14T12:28:45Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r439824826",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439824826"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r439824826"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/439824826/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 426,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441735209",
    "pull_request_review_id": 432652817,
    "id": 441735209,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNTIwOQ==",
    "diff_hunk": "@@ -391,7 +419,14 @@ BOOST_AUTO_TEST_CASE(DoS_mapOrphans)\n     // ... and 50 that depend on other orphans:\n     for (int i = 0; i < 50; i++)\n     {\n-        CTransactionRef txPrev = RandomOrphan();\n+        CTransactionRef txPrev;\n+        if (i == 0) {\n+            // This block makes sure that the condition \"if (it == mapOrphanTransactions.end())\" in OrphanByIndex() gets called at least once.\n+            // Otherwise test coverage is non-deterministic.\n+            txPrev = OrphanByIndex(ArithToUint256(arith_uint256(std::numeric_limits<uint64_t>::max())));",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 67,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "d90308badb68760af103c93217dd549ddf269563",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Ok, I can do that. The RNG can indeed be seeded so that the condition is hit at least once. However, the `ForceCoverageInPubKeyVerify` function must remain, since the non-determinism is not caused by different seeds, but is there due to concurrency issues (please refer to my comment [here](https://github.com/bitcoin/bitcoin/pull/16878?_pjax=%23js-repo-pjax-container#discussion_r331741093) for some details). I therefore don't see another way to remove the non-determinism other than this. Is that ok?",
    "created_at": "2020-06-17T18:11:24Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r441735209",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441735209"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r441735209"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441735209/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 426,
    "side": "RIGHT",
    "in_reply_to_id": 439824826
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441740979",
    "pull_request_review_id": 432660499,
    "id": 441740979,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MDk3OQ==",
    "diff_hunk": "@@ -391,7 +419,14 @@ BOOST_AUTO_TEST_CASE(DoS_mapOrphans)\n     // ... and 50 that depend on other orphans:\n     for (int i = 0; i < 50; i++)\n     {\n-        CTransactionRef txPrev = RandomOrphan();\n+        CTransactionRef txPrev;\n+        if (i == 0) {\n+            // This block makes sure that the condition \"if (it == mapOrphanTransactions.end())\" in OrphanByIndex() gets called at least once.\n+            // Otherwise test coverage is non-deterministic.\n+            txPrev = OrphanByIndex(ArithToUint256(arith_uint256(std::numeric_limits<uint64_t>::max())));",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 67,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "d90308badb68760af103c93217dd549ddf269563",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Generally the tests run in a single thread, so there shouldn't be any concurrency issues. Are you sure the non-determinism is not caused by the random private key, which can also be picked deterministically?",
    "created_at": "2020-06-17T18:21:35Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r441740979",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441740979"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r441740979"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/441740979/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 426,
    "side": "RIGHT",
    "in_reply_to_id": 439824826
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452240106",
    "pull_request_review_id": 445645546,
    "id": 452240106,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDEwNg==",
    "diff_hunk": "@@ -391,7 +419,14 @@ BOOST_AUTO_TEST_CASE(DoS_mapOrphans)\n     // ... and 50 that depend on other orphans:\n     for (int i = 0; i < 50; i++)\n     {\n-        CTransactionRef txPrev = RandomOrphan();\n+        CTransactionRef txPrev;\n+        if (i == 0) {\n+            // This block makes sure that the condition \"if (it == mapOrphanTransactions.end())\" in OrphanByIndex() gets called at least once.\n+            // Otherwise test coverage is non-deterministic.\n+            txPrev = OrphanByIndex(ArithToUint256(arith_uint256(std::numeric_limits<uint64_t>::max())));",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 67,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "d90308badb68760af103c93217dd549ddf269563",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sorry for the long delay, you are right, the additional non-determinism was caused by the fact that the private key is generated by another RNG and not by concurrency issues. I removed the function I added to force coverage and forced the key to be generated by the same RNG for this test. I seeded it so that all branches of the function `ecdsa_signature_parse_der_lax` run. However, after a few dozen times of running this test with the script `contrib/devtools/test_deterministic_coverage.sh`, there was another place where the coverage was not deterministic, in the function `Loop()` in `checkqueue.h`. I'm looking into it.",
    "created_at": "2020-07-09T14:01:04Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r452240106",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452240106"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r452240106"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/452240106/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 426,
    "side": "RIGHT",
    "in_reply_to_id": 439824826
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457093822",
    "pull_request_review_id": 451326745,
    "id": 457093822,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA5MzgyMg==",
    "diff_hunk": "@@ -314,10 +316,27 @@ static CTransactionRef RandomOrphan()\n     return it->second.tx;\n }\n \n+static void MakeNewKeyWithFastRandomContext(CKey& key)\n+{\n+    std::vector<unsigned char> keydata;\n+    do {\n+        keydata = g_insecure_rand_ctx.randbytes(32);\n+        key.Set(keydata.data(), keydata.data() + keydata.size(), /*fCompressedIn*/ true);\n+    } while (!key.IsValid());",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "505938231741a0767bbb2df61c1130f6552b75d5",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: This can simply say\r\n```suggestion\r\n    assert(key.IsValid());\r\n```",
    "created_at": "2020-07-20T06:29:09Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r457093822",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457093822"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r457093822"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457093822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 325,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457526084",
    "pull_request_review_id": 451751826,
    "id": 457526084,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUyNjA4NA==",
    "diff_hunk": "@@ -314,10 +316,27 @@ static CTransactionRef RandomOrphan()\n     return it->second.tx;\n }\n \n+static void MakeNewKeyWithFastRandomContext(CKey& key)\n+{\n+    std::vector<unsigned char> keydata;\n+    do {\n+        keydata = g_insecure_rand_ctx.randbytes(32);\n+        key.Set(keydata.data(), keydata.data() + keydata.size(), /*fCompressedIn*/ true);\n+    } while (!key.IsValid());",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "505938231741a0767bbb2df61c1130f6552b75d5",
    "user": {
      "login": "davereikher",
      "id": 5347350,
      "node_id": "MDQ6VXNlcjUzNDczNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5347350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davereikher",
      "html_url": "https://github.com/davereikher",
      "followers_url": "https://api.github.com/users/davereikher/followers",
      "following_url": "https://api.github.com/users/davereikher/following{/other_user}",
      "gists_url": "https://api.github.com/users/davereikher/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davereikher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davereikher/subscriptions",
      "organizations_url": "https://api.github.com/users/davereikher/orgs",
      "repos_url": "https://api.github.com/users/davereikher/repos",
      "events_url": "https://api.github.com/users/davereikher/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davereikher/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Wouldn't it fail the test if the generated key is invalid instead of retrying?",
    "created_at": "2020-07-20T16:07:15Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r457526084",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457526084"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r457526084"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457526084/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 457093822
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457609103",
    "pull_request_review_id": 451855972,
    "id": 457609103,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYwOTEwMw==",
    "diff_hunk": "@@ -314,10 +316,27 @@ static CTransactionRef RandomOrphan()\n     return it->second.tx;\n }\n \n+static void MakeNewKeyWithFastRandomContext(CKey& key)\n+{\n+    std::vector<unsigned char> keydata;\n+    do {\n+        keydata = g_insecure_rand_ctx.randbytes(32);\n+        key.Set(keydata.data(), keydata.data() + keydata.size(), /*fCompressedIn*/ true);\n+    } while (!key.IsValid());",
    "path": "src/test/denialofservice_tests.cpp",
    "position": null,
    "original_position": 23,
    "commit_id": "4455949d6f0218b40d33d7fe6de6555f8f62192f",
    "original_commit_id": "505938231741a0767bbb2df61c1130f6552b75d5",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, but that should never happen, because the test is deterministic",
    "created_at": "2020-07-20T18:29:12Z",
    "updated_at": "2020-07-21T06:19:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r457609103",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457609103"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/16878#discussion_r457609103"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/16878"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/457609103/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 325,
    "side": "RIGHT",
    "in_reply_to_id": 457093822
  }
]