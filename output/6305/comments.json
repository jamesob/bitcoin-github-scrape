[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113358870",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/6305#issuecomment-113358870",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6305",
    "id": 113358870,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzM1ODg3MA==",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-19T03:53:51Z",
    "updated_at": "2015-06-19T03:53:51Z",
    "author_association": "MEMBER",
    "body": "While there are no other builds in the queue, I'll force-push a few times to try to trigger the NPE\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113358870/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113383354",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/6305#issuecomment-113383354",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6305",
    "id": 113383354,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzM4MzM1NA==",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-19T05:53:37Z",
    "updated_at": "2015-06-19T05:53:37Z",
    "author_association": "MEMBER",
    "body": "Grr, 7 forced rebuilds and no errors. I'm not sure if that's a good thing or not :)\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113383354/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113390255",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/6305#issuecomment-113390255",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6305",
    "id": 113390255,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzM5MDI1NQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-19T06:27:07Z",
    "updated_at": "2015-06-19T06:27:07Z",
    "author_association": "MEMBER",
    "body": "Well it tends to happen in droves, as if it depends on the load on the Travis server.\nI wouldn't applaud yet :)\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113390255/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113507911",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/6305#issuecomment-113507911",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6305",
    "id": 113507911,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzUwNzkxMQ==",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-19T12:58:04Z",
    "updated_at": "2015-06-19T12:58:04Z",
    "author_association": "MEMBER",
    "body": "Going ahead and merging this for troubleshooting improvement.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113507911/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113578450",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/6305#issuecomment-113578450",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6305",
    "id": 113578450,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzU3ODQ1MA==",
    "user": {
      "login": "dexX7",
      "id": 5836089,
      "node_id": "MDQ6VXNlcjU4MzYwODk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5836089?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dexX7",
      "html_url": "https://github.com/dexX7",
      "followers_url": "https://api.github.com/users/dexX7/followers",
      "following_url": "https://api.github.com/users/dexX7/following{/other_user}",
      "gists_url": "https://api.github.com/users/dexX7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dexX7/subscriptions",
      "organizations_url": "https://api.github.com/users/dexX7/orgs",
      "repos_url": "https://api.github.com/users/dexX7/repos",
      "events_url": "https://api.github.com/users/dexX7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dexX7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-19T17:10:36Z",
    "updated_at": "2015-06-19T17:10:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "The issue is still present. I looped it locally, until it failed (took around 30 min):\n\n```\n06:34:40 15 BitcoindComparisonTool$1.onPreMessageReceived: Requested 230386124745549b4a14cb801c16c308568fcc5679b5afd9df0d8601cf938f7e\n06:34:40 15 Peer.processMessage: Received unhandled message: Reject: block 0f863347c378794f3a04e2899158a2f952c3720159fe71b6e13d23cca538f4d2 for reason 'bad-txns-inputs-missingorspent' (16)\n06:34:40 15 Peer.processMessage: Received unhandled message: Reject: block 230386124745549b4a14cb801c16c308568fcc5679b5afd9df0d8601cf938f7e for reason 'bad-blk-sigops' (16)\n06:34:40 1 BitcoindComparisonTool.main: Sent inv with block 0f863347c378794f3a04e2899158a2f952c3720159fe71b6e13d23cca538f4d2\n06:34:40 15 BitcoindComparisonTool$1.onPreMessageReceived: Got empty header message from bitcoind\nException in thread \"main\" java.lang.NullPointerException\n    at com.google.bitcoin.core.BitcoindComparisonTool.main(BitcoindComparisonTool.java:311)\n```\n\ndebug.log:\n\n```\n2015-06-19 16:34:40 received: getheaders (69 bytes) peer=1\n2015-06-19 16:34:40 getheaders -1 to 0000000000000000000000000000000000000000000000000000000000000000 from peer=1\n2015-06-19 16:34:40 sending: headers (1 bytes) peer=1\n2015-06-19 16:34:40 received: ping (8 bytes) peer=1\n2015-06-19 16:34:40 sending: pong (8 bytes) peer=1\n2015-06-19 16:34:41 trying connection 0.0.0.0 lastseen=0.0hrs\n```\n\nIt's caused by [BitcoindComparisonTool.java#L311](https://github.com/theuni/bitcoinj/blob/be0eef774462409df277b2a83d71c30451f107c5/core/src/test/java/com/google/bitcoin/core/BitcoindComparisonTool.java#L311):\n\n``` java\nbitcoind.ping().get();\n```\n\nMore specifically, because `future` of `PendingPing` ([Peer.java#L1424](https://github.com/theuni/bitcoinj/blob/be0eef774462409df277b2a83d71c30451f107c5/core/src/main/java/com/google/bitcoin/core/Peer.java#L1424)) was `null`, which was returned by `ping()`, presumably because a pong was received, and processed via `PendingPing#complete()` ([Peer.java#L1383](https://github.com/theuni/bitcoinj/blob/be0eef774462409df277b2a83d71c30451f107c5/core/src/main/java/com/google/bitcoin/core/Peer.java#L1383)), before it went through:\n\n``` java\n/**\n* Sends the peer a ping message and returns a future that will be invoked when the pong is received back.\n* The future provides a number which is the number of milliseconds elapsed between the ping and the pong.\n* Once the pong is received the value returned by {@link com.google.bitcoin.core.Peer#getLastPingTime()} is\n* updated.\n* @throws ProtocolException if the peer version is too low to support measurable pings.\n*/\npublic ListenableFuture<Long> ping()\n```\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113578450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113580134",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/6305#issuecomment-113580134",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6305",
    "id": 113580134,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzU4MDEzNA==",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-19T17:18:48Z",
    "updated_at": "2015-06-19T17:18:48Z",
    "author_association": "MEMBER",
    "body": "@dexX7 Thanks for having a look. The line numbers didn't change, so it's the same as before.\n\nI came to the same conclusion when I looked into it last time, but @mikehearn was confident that the issue couldn't be here. My guess was that it could be caused by a non-so-random PRNG causing ping lookups to race. In that case, replacing the bitcoind.ping().get() with bitcoind.ping(counter++).get() would avoid the issue I think.\n\n@mikehearn Mind having another look, now that we're sure the line#s are good? Even better, since @dexX7 can reproduce locally, maybe he'll be able to test proposed changes more easily.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113580134/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113623614",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/6305#issuecomment-113623614",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6305",
    "id": 113623614,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzYyMzYxNA==",
    "user": {
      "login": "dexX7",
      "id": 5836089,
      "node_id": "MDQ6VXNlcjU4MzYwODk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5836089?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dexX7",
      "html_url": "https://github.com/dexX7",
      "followers_url": "https://api.github.com/users/dexX7/followers",
      "following_url": "https://api.github.com/users/dexX7/following{/other_user}",
      "gists_url": "https://api.github.com/users/dexX7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dexX7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dexX7/subscriptions",
      "organizations_url": "https://api.github.com/users/dexX7/orgs",
      "repos_url": "https://api.github.com/users/dexX7/repos",
      "events_url": "https://api.github.com/users/dexX7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dexX7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-19T19:51:12Z",
    "updated_at": "2015-06-19T19:51:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "> My guess was that it could be caused by a non-so-random PRNG causing ping lookups to race.\n\nAh, just to clarify: I'm not sure, how it's caused, and this was just a guess.\n\nBut regarding the nonce lookup \"collision\": I gave it a try and it looks like the nonce can be anything, there always seems to be only one ping in the pending pings list (at least in these tests, for what I saw).\n\nI quickly created a [stripped ping-pong only version](https://github.com/theuni/bitcoinj/commit/97eae8a4c8d0214cd87bce226074b88f3df64f94) of the tool with additional log output, and when running via:\n\n```\nqa/pull-tester/run-bitcoind-for-test.sh /usr/bin/java -jar /path/to/bitcoinj/core/target/pull-tests.jar qa/tmp/compTool 0 2>&1\n```\n\nThen the flipped created/clearing log entries further indicate the pong was indeed processed, before ping() finished:\n\n```\n09:44:37 1 Peer.ping: created ping with nonce: 1102\n09:44:37 11 Peer.processPong: clearing pong with nonce: 1102 (pending: 1)\n09:44:37 1 Peer.ping: created ping with nonce: 1103\n09:44:37 11 Peer.processPong: clearing pong with nonce: 1103 (pending: 1)\n09:44:37 1 Peer.ping: created ping with nonce: 1104\n09:44:37 11 Peer.processPong: clearing pong with nonce: 1104 (pending: 1)\n09:44:37 11 Peer.processPong: clearing pong with nonce: 1105 (pending: 1) <-- uh oh\n09:44:37 1 Peer.ping: created ping with nonce: 1105\n09:44:37 1 BitcoindComparisonTool.main: ERROR: ping() with nonce 1105 returned null\n```\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113623614/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113633975",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/6305#issuecomment-113633975",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6305",
    "id": 113633975,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzYzMzk3NQ==",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-19T20:36:43Z",
    "updated_at": "2015-06-19T20:36:43Z",
    "author_association": "MEMBER",
    "body": "@dexX7 Ah, great work. Looks like we have an answer :)\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113633975/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113894917",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/6305#issuecomment-113894917",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/6305",
    "id": 113894917,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzg5NDkxNw==",
    "user": {
      "login": "mikehearn",
      "id": 971089,
      "node_id": "MDQ6VXNlcjk3MTA4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/971089?u=f32bbe8d8d0f9e10b1387f0aa582b1ee83b8aac5&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikehearn",
      "html_url": "https://github.com/mikehearn",
      "followers_url": "https://api.github.com/users/mikehearn/followers",
      "following_url": "https://api.github.com/users/mikehearn/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikehearn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikehearn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikehearn/subscriptions",
      "organizations_url": "https://api.github.com/users/mikehearn/orgs",
      "repos_url": "https://api.github.com/users/mikehearn/repos",
      "events_url": "https://api.github.com/users/mikehearn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikehearn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-21T12:45:13Z",
    "updated_at": "2015-06-21T12:45:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dexX7 Thanks! The race is fixed in this commit:\n\nhttps://github.com/bitcoinj/bitcoinj/commit/ce50e0b7558d623481c4bb5c18d136de85268b2e\n\nRunning \"mvn package\" inside a git master checkout of bitcoinj should create a file core/target/pull-tests.jar that contains a fresh pull tester.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/113894917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]