[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599251772",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-599251772",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 599251772,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTI1MTc3Mg==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-15T19:12:33Z",
    "updated_at": "2020-11-26T10:01:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20323 (tests: Create or use existing properly initialized NodeContexts by dongcarl)\n* #20228 (addrman: Make addrman a top-level component by jnewbery)\n* #20217 (net: Remove g_relay_txes by jnewbery)\n* #19833 (wallet: Avoid locking cs_wallet recursively by promag)\n* #19521 (Coinstats Index (without UTXO set hash) by fjahr)\n* #19425 (refactor: Get rid of more redundant chain methods by ryanofsky)\n* #18766 (Disable fee estimation in blocksonly mode (by removing the fee estimates global) by darosior)\n* #14053 (Add address-based index (attempt 4?) by marcinja)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599251772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599544782",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-599544782",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 599544782,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTU0NDc4Mg==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T13:46:06Z",
    "updated_at": "2020-03-16T13:46:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Simplify patch, make more fuzzing test\r\n```\r\n#!/bin/bash\r\nwhile [ 1 ]\r\ndo\r\n    src/bitcoin-cli -testnet loadwallet test\r\n    src/bitcoin-cli -testnet unloadwallet test3\r\n    src/bitcoin-cli -testnet loadwallet test2\r\n    src/bitcoin-cli -testnet unloadwallet test\r\n    src/bitcoin-cli -testnet loadwallet test3\r\n    src/bitcoin-cli -testnet unloadwallet test2\r\ndone\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599544782/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599906008",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-599906008",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 599906008,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTkwNjAwOA==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-17T06:49:45Z",
    "updated_at": "2020-03-17T06:50:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "Use future instead of raw loop for waiting pending callbacks. It still much matters to me compared to #18338 ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599906008/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603189889",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-603189889",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 603189889,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzE4OTg4OQ==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-24T11:39:46Z",
    "updated_at": "2020-03-24T11:39:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "@promag same as your approach with more aggressive refactor + missing virtual desctructors.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603189889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603842986",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-603842986",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 603842986,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzg0Mjk4Ng==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-25T13:35:47Z",
    "updated_at": "2020-03-25T13:35:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK, though this is making a lot of changes in a single commit. The changes will probably get simpler if #18338 is merged first, and maybe they can be broken up into smaller commits. Could consider rebasing on top of #18338 of you don't want to wait for it to be merged. I'd also encourage you to review #18338!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603842986/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603849568",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-603849568",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 603849568,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzg0OTU2OA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-25T13:48:50Z",
    "updated_at": "2020-03-25T13:53:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh, just saw this PR has expanded since I looked at it previously. I think some of the uses of shared_ptr / weak_ptr here like the new ones added in CWalletTx do not make sense. shared_ptr / weak_ptr only make sense when lifetime of the reference doesn't have a definite scope. For cases like CWalletTx where the wallet reference can't outlive the wallet, `CWallet&` makes more sense than `weak_ptr<CWallet>`. (Also, though in that specific case, it would be preferable to stop storing the wallet references entirely since they are redundant and no CWalletTx method is ever called without already having a reference to the wallet).\r\n\r\nIt would probably make sense to break this PR up into multiple commits so individual changes here can be understood and reviewed more easily",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603849568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603984873",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-603984873",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 603984873,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzk4NDg3Mw==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-25T17:41:52Z",
    "updated_at": "2020-03-25T17:42:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "> shared_ptr / weak_ptr only make sense when lifetime of the reference doesn't have a definite scope.\r\n\r\nI agree, in plus it defines no ownership. I agree, that reference makes much more sense here, too\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603984873/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604330770",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-604330770",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 604330770,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDMzMDc3MA==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-26T09:47:13Z",
    "updated_at": "2020-03-26T09:47:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Use Optional instead of weak_ptr, i can't reproduce CI errors, all tests + functional ones passes in Linux x64.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604330770/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606650860",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-606650860",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 606650860,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjY1MDg2MA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-31T14:08:16Z",
    "updated_at": "2020-03-31T14:08:16Z",
    "author_association": "MEMBER",
    "body": "Loosk like there are some cleanups from https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-605920724 that can be addressed here",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606650860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622926731",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-622926731",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 622926731,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjkyNjczMQ==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-02T09:39:08Z",
    "updated_at": "2020-05-03T07:59:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Are you interested in this patch or you prefer to be closed?\r\nThe changes are:\r\n\r\n1. Validation interface uses shared pointers only\r\n2. Fix CValidationInterface and NetEventsInterface to use virtual destructors. Since there is no usage of creation and deletion via base pointer it does not have a problem but instead it's not correct design.\r\n3. RPC methods uses CWallet shared pointer only\r\n4. CwalletTx and WalletRescanReserver uses optional reference to CWallet instead of pointer\r\n5. Notification implementation uses weak pointer instead of shared one.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/622926731/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624983709",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-624983709",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 624983709,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDk4MzcwOQ==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T01:55:50Z",
    "updated_at": "2020-05-07T01:55:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Interestingly this change seems like a superset of #18742 by @MarcoFalke and #18791 by @promag and #18592 by @brakmic but it precedes all these other prs!\r\n\r\nFor the #18742 / #18791 overlap, I think there's a question about where it makes sense to use the shared pointer validationinterface callbacks, and where it makes sense to use the non-shared ones. Maybe it would be good to do what this PR does and use shared pointers everywhere but there are possible concerns about overhead and making shutdown not deterministic. Some discussion https://github.com/bitcoin/bitcoin/pull/18791#issuecomment-620307875\r\n\r\nFor the #18592 overlap, I think #18592 might be taking a better approach. It's generally good to replace raw pointers with smart pointers or references. But a lot of instances here look like they should be references instead of shared_ptrs, and there's also an `Optional<const CWallet&>` usage which I think is just recreating a type of a raw pointer. It seems like the pointer changes here might be going too far in some cases.\r\n\r\nProbably we should focus on #18742 and #18791 and #18592 for now, but see if there's anything this PR does better or isn't covered by the smaller prs.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624983709/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629288136",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-629288136",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 629288136,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyOTI4ODEzNg==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-15T15:07:32Z",
    "updated_at": "2020-05-15T15:09:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Revert optional ref. @ryanofsky none of those PRs are complete like this, i agree they have same approach. Using shared pointer is cheap enough to be pass by value.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629288136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704597420",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-704597420",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 704597420,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDU5NzQyMA==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-06T23:01:53Z",
    "updated_at": "2020-10-06T23:01:53Z",
    "author_association": "MEMBER",
    "body": "Is this still a bug fix? Do you think you can split in multiple commits?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704597420/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704724453",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-704724453",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 704724453,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDcyNDQ1Mw==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T06:29:04Z",
    "updated_at": "2020-10-11T14:14:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @promag mostly it's not an issue, AFAIK. It has some side effects in Qt gui, it was fixed i think. Notification proxy can extend notification lifetime which isn't correct to me. As well as using shared pointers only to validation interface, missing virtual destructors to interface classes like NetEventsInterface (it's not a problem since it's not deleted through base pointer till now).\r\nI can split it to more commits if you're interested in this features.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704724453/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704902198",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-704902198",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 704902198,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDkwMjE5OA==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T12:30:01Z",
    "updated_at": "2020-10-07T12:30:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Refactor pwallet to wallet (wallet* to wallet shared_ptr) is removed.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/704902198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/736359301",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-736359301",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 736359301,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNjM1OTMwMQ==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-01T09:44:34Z",
    "updated_at": "2020-12-01T09:44:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n\ud83d\udc19 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/736359301/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949565127",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-949565127",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 949565127,
    "node_id": "IC_kwDOABII5844mTbH",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T12:01:43Z",
    "updated_at": "2021-10-22T12:01:43Z",
    "author_association": "MEMBER",
    "body": "Needs rebase if still relevant",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949565127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949578442",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#issuecomment-949578442",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18354",
    "id": 949578442,
    "node_id": "IC_kwDOABII5844mWrK",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T12:19:07Z",
    "updated_at": "2021-10-22T12:19:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "I will investigate if it still needed, actually @ryanofsky does excellent work to well define shared interfaces ownership.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/949578442/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393055199",
    "pull_request_review_id": 375260070,
    "id": 393055199,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1NTE5OQ==",
    "diff_hunk": "@@ -199,13 +199,16 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n }\n \n void SingleThreadedSchedulerClient::EmptyQueue() {\n-    assert(!m_pscheduler->AreThreadsServicingQueue());\n-    bool should_continue = true;\n-    while (should_continue) {\n-        ProcessQueue();\n+    if (m_pscheduler->AreThreadsServicingQueue())\n+        return;\n+\n+    auto shouldProcessQueue = [this]() {\n         LOCK(m_cs_callbacks_pending);\n-        should_continue = !m_callbacks_pending.empty();\n-    }\n+        return !m_callbacks_pending.empty() || m_are_callbacks_running;",
    "path": "src/scheduler.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "557b59670d1cf278fdf85ea83806fed3f05d1913",
    "original_commit_id": "16e9578c1ecc3240282e136c378fb0433e775e41",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why's this adding `|| m_are_callbacks_running`? In the case where m_callbacks_pending is empty and m_are_callbacks_running is true, won't ProcessQueue return immediately and the loop below be a busy loop consuming 100% of CPU?\r\n\r\nAlso could use `while (WITH_LOCK(m_cs_callbacks_pending, return ...)) {` instead of a lambda",
    "created_at": "2020-03-16T14:17:11Z",
    "updated_at": "2020-10-07T12:28:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393055199",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393055199"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393055199"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393055199/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 205,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393063319",
    "pull_request_review_id": 375260070,
    "id": 393063319,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA2MzMxOQ==",
    "diff_hunk": "@@ -137,6 +135,8 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     // Notify the unload intent so that all remaining shared pointers are\n     // released.\n     wallet->NotifyUnload();\n+    wallet->BlockUntilSyncedToCurrentChain();\n+    wallet->m_chain_notifications_handler.reset();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "557b59670d1cf278fdf85ea83806fed3f05d1913",
    "original_commit_id": "16e9578c1ecc3240282e136c378fb0433e775e41",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is a partial fix for the bug, not a full fix. While calling BlockUntilSyncedToCurrentChain before reset makes it less likely the wallet pointer will be deleted while still in use, it's still possible for a blockconnected or other notification to be running when wallet.reset() is called below",
    "created_at": "2020-03-16T14:24:50Z",
    "updated_at": "2020-10-07T12:28:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393063319",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393063319"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393063319"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393063319/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 138,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393173751",
    "pull_request_review_id": 375411624,
    "id": 393173751,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3Mzc1MQ==",
    "diff_hunk": "@@ -137,6 +135,8 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     // Notify the unload intent so that all remaining shared pointers are\n     // released.\n     wallet->NotifyUnload();\n+    wallet->BlockUntilSyncedToCurrentChain();\n+    wallet->m_chain_notifications_handler.reset();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "557b59670d1cf278fdf85ea83806fed3f05d1913",
    "original_commit_id": "16e9578c1ecc3240282e136c378fb0433e775e41",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "That's guaranteed it https://github.com/bitcoin/bitcoin/pull/18354/commits/16e9578c1ecc3240282e136c378fb0433e775e41#diff-e8d9e22d9683f73a9fb8399be0dab640R93",
    "created_at": "2020-03-16T16:59:20Z",
    "updated_at": "2020-10-07T12:28:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393173751",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393173751"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393173751"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393173751/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 138,
    "side": "RIGHT",
    "in_reply_to_id": 393063319
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393175374",
    "pull_request_review_id": 375413030,
    "id": 393175374,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3NTM3NA==",
    "diff_hunk": "@@ -199,13 +199,16 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n }\n \n void SingleThreadedSchedulerClient::EmptyQueue() {\n-    assert(!m_pscheduler->AreThreadsServicingQueue());\n-    bool should_continue = true;\n-    while (should_continue) {\n-        ProcessQueue();\n+    if (m_pscheduler->AreThreadsServicingQueue())\n+        return;\n+\n+    auto shouldProcessQueue = [this]() {\n         LOCK(m_cs_callbacks_pending);\n-        should_continue = !m_callbacks_pending.empty();\n-    }\n+        return !m_callbacks_pending.empty() || m_are_callbacks_running;",
    "path": "src/scheduler.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "557b59670d1cf278fdf85ea83806fed3f05d1913",
    "original_commit_id": "16e9578c1ecc3240282e136c378fb0433e775e41",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Why's this adding || m_are_callbacks_running? In the case where m_callbacks_pending is empty and m_are_callbacks_running is true, won't ProcessQueue return immediately and the loop below be a busy loop consuming 100% of CPU?\r\n\r\nIt's same without `m_are_callbacks_running` i.e. while loop consume a lot of CPU. The change is to ensure notification thread is finish processing callback.",
    "created_at": "2020-03-16T17:01:05Z",
    "updated_at": "2020-10-07T12:28:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393175374",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393175374"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393175374"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393175374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 205,
    "side": "RIGHT",
    "in_reply_to_id": 393055199
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393183034",
    "pull_request_review_id": 375420566,
    "id": 393183034,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE4MzAzNA==",
    "diff_hunk": "@@ -137,6 +135,8 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     // Notify the unload intent so that all remaining shared pointers are\n     // released.\n     wallet->NotifyUnload();\n+    wallet->BlockUntilSyncedToCurrentChain();\n+    wallet->m_chain_notifications_handler.reset();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "557b59670d1cf278fdf85ea83806fed3f05d1913",
    "original_commit_id": "16e9578c1ecc3240282e136c378fb0433e775e41",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "As I understand it, the EmptyQueue call added there (in UnregisterValidationInterface) does nothing if `m_pscheduler->AreThreadsServicingQueue()` is true, which it always is, except during shutdown. So a notification could still be in progress and raw wallet pointer still in use after the UnregisterValidationInterface call and handler.reset() call and wallet.reset() call. Adding the BlockUntilSyncedToCurrentChain right before probably makes this much less unlikely, but not impossible. #18338 is be a more direct, race-free fix for the issue, because it gets rid of the raw pointer and uses shared_ptr for all wallet references.",
    "created_at": "2020-03-16T17:10:48Z",
    "updated_at": "2020-10-07T12:28:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393183034",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393183034"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393183034"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393183034/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 138,
    "side": "RIGHT",
    "in_reply_to_id": 393063319
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393193401",
    "pull_request_review_id": 375434268,
    "id": 393193401,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5MzQwMQ==",
    "diff_hunk": "@@ -199,13 +199,16 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n }\n \n void SingleThreadedSchedulerClient::EmptyQueue() {\n-    assert(!m_pscheduler->AreThreadsServicingQueue());\n-    bool should_continue = true;\n-    while (should_continue) {\n-        ProcessQueue();\n+    if (m_pscheduler->AreThreadsServicingQueue())\n+        return;\n+\n+    auto shouldProcessQueue = [this]() {\n         LOCK(m_cs_callbacks_pending);\n-        should_continue = !m_callbacks_pending.empty();\n-    }\n+        return !m_callbacks_pending.empty() || m_are_callbacks_running;",
    "path": "src/scheduler.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "557b59670d1cf278fdf85ea83806fed3f05d1913",
    "original_commit_id": "16e9578c1ecc3240282e136c378fb0433e775e41",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> > Why's this adding || m_are_callbacks_running? In the case where m_callbacks_pending is empty and m_are_callbacks_running is true, won't ProcessQueue return immediately and the loop below be a busy loop consuming 100% of CPU?\r\n\r\nOh, you're right. The current code is can busy-loop when the queue non-empty and running is true, though AreThreadsServicingQueue check makes this less likely to happen. I still don't understand why you now want to busy loop in the case where the queue is empty and running is true. Again prefer just using shared_ptr to avoid use-after-free bugs instead of doing more complicated things with the scheduler.",
    "created_at": "2020-03-16T17:28:27Z",
    "updated_at": "2020-10-07T12:28:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393193401",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393193401"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393193401"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393193401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 205,
    "side": "RIGHT",
    "in_reply_to_id": 393055199
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393220993",
    "pull_request_review_id": 375469306,
    "id": 393220993,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIyMDk5Mw==",
    "diff_hunk": "@@ -199,13 +199,16 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n }\n \n void SingleThreadedSchedulerClient::EmptyQueue() {\n-    assert(!m_pscheduler->AreThreadsServicingQueue());\n-    bool should_continue = true;\n-    while (should_continue) {\n-        ProcessQueue();\n+    if (m_pscheduler->AreThreadsServicingQueue())\n+        return;\n+\n+    auto shouldProcessQueue = [this]() {\n         LOCK(m_cs_callbacks_pending);\n-        should_continue = !m_callbacks_pending.empty();\n-    }\n+        return !m_callbacks_pending.empty() || m_are_callbacks_running;",
    "path": "src/scheduler.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "557b59670d1cf278fdf85ea83806fed3f05d1913",
    "original_commit_id": "16e9578c1ecc3240282e136c378fb0433e775e41",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Got'cha, you're right. I'll investigate for solution.",
    "created_at": "2020-03-16T18:11:21Z",
    "updated_at": "2020-10-07T12:28:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393220993",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393220993"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393220993"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393220993/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 205,
    "side": "RIGHT",
    "in_reply_to_id": 393055199
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393233993",
    "pull_request_review_id": 375485578,
    "id": 393233993,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzMzk5Mw==",
    "diff_hunk": "@@ -199,13 +199,16 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n }\n \n void SingleThreadedSchedulerClient::EmptyQueue() {\n-    assert(!m_pscheduler->AreThreadsServicingQueue());\n-    bool should_continue = true;\n-    while (should_continue) {\n-        ProcessQueue();\n+    if (m_pscheduler->AreThreadsServicingQueue())\n+        return;\n+\n+    auto shouldProcessQueue = [this]() {\n         LOCK(m_cs_callbacks_pending);\n-        should_continue = !m_callbacks_pending.empty();\n-    }\n+        return !m_callbacks_pending.empty() || m_are_callbacks_running;",
    "path": "src/scheduler.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "557b59670d1cf278fdf85ea83806fed3f05d1913",
    "original_commit_id": "16e9578c1ecc3240282e136c378fb0433e775e41",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Got'cha, you're right. I'll investigate for solution.\r\n\r\nAgain would suggest closing this PR and using #18338 which I think is more consistent and less fragile fix",
    "created_at": "2020-03-16T18:34:57Z",
    "updated_at": "2020-10-07T12:28:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393233993",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393233993"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393233993"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393233993/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 205,
    "side": "RIGHT",
    "in_reply_to_id": 393055199
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393234040",
    "pull_request_review_id": 375485646,
    "id": 393234040,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzNDA0MA==",
    "diff_hunk": "@@ -199,13 +199,16 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n }\n \n void SingleThreadedSchedulerClient::EmptyQueue() {\n-    assert(!m_pscheduler->AreThreadsServicingQueue());\n-    bool should_continue = true;\n-    while (should_continue) {\n-        ProcessQueue();\n+    if (m_pscheduler->AreThreadsServicingQueue())\n+        return;\n+\n+    auto shouldProcessQueue = [this]() {\n         LOCK(m_cs_callbacks_pending);\n-        should_continue = !m_callbacks_pending.empty();\n-    }\n+        return !m_callbacks_pending.empty() || m_are_callbacks_running;",
    "path": "src/scheduler.cpp",
    "position": null,
    "original_position": 15,
    "commit_id": "557b59670d1cf278fdf85ea83806fed3f05d1913",
    "original_commit_id": "16e9578c1ecc3240282e136c378fb0433e775e41",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`AreThreadsServicingQueue` is not needed at all. Its purpose is obsolete in the context.",
    "created_at": "2020-03-16T18:35:04Z",
    "updated_at": "2020-10-07T12:28:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393234040",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393234040"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18354#discussion_r393234040"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18354"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393234040/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 205,
    "side": "RIGHT",
    "in_reply_to_id": 393055199
  }
]