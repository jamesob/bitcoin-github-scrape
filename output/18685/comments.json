[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/615898514",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-615898514",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 615898514,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNTg5ODUxNA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-18T16:24:38Z",
    "updated_at": "2020-04-18T16:24:38Z",
    "author_association": "MEMBER",
    "body": "Thanks for the review @MarcoFalke . I've addressed your comments.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/615898514/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624991192",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-624991192",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 624991192,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDk5MTE5Mg==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T02:23:58Z",
    "updated_at": "2021-06-24T19:16:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21789 by MarcoFalke\n* #15606 by jamesob\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/624991192/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655319539",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-655319539",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 655319539,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NTMxOTUzOQ==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-08T06:38:03Z",
    "updated_at": "2020-07-08T06:38:03Z",
    "author_association": "MEMBER",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/655319539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687047944",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-687047944",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 687047944,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NzA0Nzk0NA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-04T09:53:58Z",
    "updated_at": "2020-09-04T09:53:58Z",
    "author_association": "MEMBER",
    "body": "I've addressed the comment here https://github.com/bitcoin/bitcoin/pull/18685#discussion_r479612111 and rebased on master (there wasn't a conflict but this was a few thousand commits behind master and it's a small change).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/687047944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/787112566",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-787112566",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 787112566,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NzExMjU2Ng==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-27T18:08:25Z",
    "updated_at": "2021-02-27T18:08:25Z",
    "author_association": "MEMBER",
    "body": "Thanks for the review, @ajtowns! I've addressed your comments and rebased on master (since this was a couple of thousand commits behind the current master).",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/787112566/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/828999358",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-828999358",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 828999358,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyODk5OTM1OA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-29T07:20:27Z",
    "updated_at": "2021-04-29T07:20:27Z",
    "author_association": "MEMBER",
    "body": "@ajtowns do you mind looking at this again? I've addressed your review comments.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/828999358/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/853136938",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-853136938",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 853136938,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzEzNjkzOA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T15:43:31Z",
    "updated_at": "2021-06-02T15:43:31Z",
    "author_association": "MEMBER",
    "body": "@ajtowns?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/853136938/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/870220375",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-870220375",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 870220375,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MDIyMDM3NQ==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-29T04:23:03Z",
    "updated_at": "2021-06-29T04:23:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n\ud83d\udc19 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/870220375/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/881315423",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-881315423",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 881315423,
    "node_id": "IC_kwDOABII5840h85f",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-16T09:38:06Z",
    "updated_at": "2021-07-16T09:38:06Z",
    "author_association": "MEMBER",
    "body": "Closing due to lack of reviewer interest.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/881315423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/886278292",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-886278292",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 886278292,
    "node_id": "IC_kwDOABII584004iU",
    "user": {
      "login": "Rspigler",
      "id": 24482484,
      "node_id": "MDQ6VXNlcjI0NDgyNDg0",
      "avatar_url": "https://avatars.githubusercontent.com/u/24482484?u=7354800fee53a3db4ba3c6aa40de4ea8c3bf58f0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Rspigler",
      "html_url": "https://github.com/Rspigler",
      "followers_url": "https://api.github.com/users/Rspigler/followers",
      "following_url": "https://api.github.com/users/Rspigler/following{/other_user}",
      "gists_url": "https://api.github.com/users/Rspigler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Rspigler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Rspigler/subscriptions",
      "organizations_url": "https://api.github.com/users/Rspigler/orgs",
      "repos_url": "https://api.github.com/users/Rspigler/repos",
      "events_url": "https://api.github.com/users/Rspigler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Rspigler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-25T23:53:56Z",
    "updated_at": "2021-07-25T23:53:56Z",
    "author_association": "NONE",
    "body": "Mark up for grabs?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/886278292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/886504350",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#issuecomment-886504350",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18685",
    "id": 886504350,
    "node_id": "IC_kwDOABII58401vue",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-26T08:45:25Z",
    "updated_at": "2021-07-26T08:45:25Z",
    "author_association": "MEMBER",
    "body": "> Mark up for grabs?\r\n\r\n@Rspigler feel free to pick this up if you're interested. I'm happy to review, but this didn't get much reviewer interest last time round.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/886504350/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410270513",
    "pull_request_review_id": 395517042,
    "id": 410270513,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI3MDUxMw==",
    "diff_hunk": "@@ -2512,45 +2512,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(block) {}",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    PerBlockConnectTrace(CBlockIndex* index, const std::shared_ptr<const CBlock>& block) : pindex(index), pblock(block) {}\r\n```\r\n\r\nstyle nit to avoid shared_ptr increment/decrement",
    "created_at": "2020-04-17T14:43:45Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410270513",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410270513"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410270513"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410270513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2519,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410271078",
    "pull_request_review_id": 395517042,
    "id": 410271078,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI3MTA3OA==",
    "diff_hunk": "@@ -2512,45 +2512,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(block) {}\n };\n+\n /**\n- * Used to track blocks whose transactions were applied to the UTXO state as a\n- * part of a single ActivateBestChainStep call.\n- *\n- * This class is single-use, once you call GetBlocksConnected() you have to throw\n- * it away and make a new one.\n+ * Used to track blocks that were connected as part of a single\n+ * ActivateBestChainStep call. The BlockConnected validationinterface signal is\n+ * fired after a single ABCS call for all blocks that were connected in that\n+ * ABCS call.\n  */\n-class ConnectTrace {\n-private:\n-    std::vector<PerBlockConnectTrace> blocksConnected;\n-\n-public:\n-    explicit ConnectTrace() : blocksConnected(1) {}\n-\n-    void BlockConnected(CBlockIndex* pindex, std::shared_ptr<const CBlock> pblock) {\n-        assert(!blocksConnected.back().pindex);\n-        assert(pindex);\n-        assert(pblock);\n-        blocksConnected.back().pindex = pindex;\n-        blocksConnected.back().pblock = std::move(pblock);\n-        blocksConnected.emplace_back();\n-    }\n-\n-    std::vector<PerBlockConnectTrace>& GetBlocksConnected() {\n-        // We always keep one extra block at the end of our list because\n-        // blocks are added after all the conflicted transactions have\n-        // been filled in. Thus, the last entry should always be an empty\n-        // one waiting for the transactions from the next block. We pop\n-        // the last entry here to make sure the list we return is sane.\n-        assert(!blocksConnected.back().pindex);\n-        blocksConnected.pop_back();\n-        return blocksConnected;\n-    }\n-};\n+typedef std::vector<PerBlockConnectTrace> ConnectTrace;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 50,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why is this needed?",
    "created_at": "2020-04-17T14:44:40Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410271078",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410271078"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410271078"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410271078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2528,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410272193",
    "pull_request_review_id": 395517042,
    "id": 410272193,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI3MjE5Mw==",
    "diff_hunk": "@@ -2868,7 +2843,7 @@ bool CChainState::ActivateBestChain(BlockValidationState &state, const CChainPar\n                 }\n                 pindexNewTip = m_chain.Tip();\n \n-                for (const PerBlockConnectTrace& trace : connectTrace.GetBlocksConnected()) {\n+                for (auto& trace : connectTrace) {",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 68,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why is this change to auto? `auto` shouldn't be used in consensus code unless there is a reason ",
    "created_at": "2020-04-17T14:46:26Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410272193",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410272193"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410272193"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410272193/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2846,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410272555",
    "pull_request_review_id": 395517042,
    "id": 410272555,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI3MjU1NQ==",
    "diff_hunk": "@@ -409,7 +409,9 @@ enum DisconnectResult\n     DISCONNECT_FAILED   // Something else went wrong.\n };\n \n-class ConnectTrace;\n+// forward declaration for ActivateBestChainStep and ConnectTip\n+struct PerBlockConnectTrace;\n+typedef std::vector<PerBlockConnectTrace> ConnectTrace;",
    "path": "src/validation.h",
    "position": null,
    "original_position": 7,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\nusing ConnectTrace = std::vector<PerBlockConnectTrace>;\r\n```\r\n\r\nstyle nit for C++11",
    "created_at": "2020-04-17T14:46:59Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410272555",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410272555"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410272555"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410272555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 414,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410307560",
    "pull_request_review_id": 395566048,
    "id": 410307560,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNzU2MA==",
    "diff_hunk": "@@ -2512,45 +2512,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(block) {}\n };\n+\n /**\n- * Used to track blocks whose transactions were applied to the UTXO state as a\n- * part of a single ActivateBestChainStep call.\n- *\n- * This class is single-use, once you call GetBlocksConnected() you have to throw\n- * it away and make a new one.\n+ * Used to track blocks that were connected as part of a single\n+ * ActivateBestChainStep call. The BlockConnected validationinterface signal is\n+ * fired after a single ABCS call for all blocks that were connected in that\n+ * ABCS call.\n  */\n-class ConnectTrace {\n-private:\n-    std::vector<PerBlockConnectTrace> blocksConnected;\n-\n-public:\n-    explicit ConnectTrace() : blocksConnected(1) {}\n-\n-    void BlockConnected(CBlockIndex* pindex, std::shared_ptr<const CBlock> pblock) {\n-        assert(!blocksConnected.back().pindex);\n-        assert(pindex);\n-        assert(pblock);\n-        blocksConnected.back().pindex = pindex;\n-        blocksConnected.back().pblock = std::move(pblock);\n-        blocksConnected.emplace_back();\n-    }\n-\n-    std::vector<PerBlockConnectTrace>& GetBlocksConnected() {\n-        // We always keep one extra block at the end of our list because\n-        // blocks are added after all the conflicted transactions have\n-        // been filled in. Thus, the last entry should always be an empty\n-        // one waiting for the transactions from the next block. We pop\n-        // the last entry here to make sure the list we return is sane.",
    "path": "src/validation.cpp",
    "position": 37,
    "original_position": 44,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "\r\n\r\nNote to other reviewers: This comment obviously no longer applies after 312d27b\r\n",
    "created_at": "2020-04-17T15:43:17Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410307560",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410307560"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410307560"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410307560/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2569,
    "original_line": 2569,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410717136",
    "pull_request_review_id": 395927302,
    "id": 410717136,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxNzEzNg==",
    "diff_hunk": "@@ -2512,45 +2512,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(block) {}",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks for this comment! It sent me down a bit of a rabbit hole about how to pass smart pointers. Here's what I've learned:\r\n\r\nI think your suggestion to change the ctor to take a const lvalue reference makes a copy and therefore increases the ref count (the `const` is the callee saying to the caller \"I won't steal this reference\", and so if the callee wants to keep ownership, it needs to make a copy). We can avoid that copy in three ways:\r\n\r\n- pass by non-const lvalue reference (`std::shared_ptr<const CBlock>&`) which is the callee saying \"I may or may not steal this reference\" and call the constructor with an lvalue (ie `thisBlock` below).\r\n- pass by value (`std::shared_ptr<const CBlock>`), and have the caller cast to rvalue reference in the call (ie `std::move(thisBlock)` below). The `std::move` is the caller saying \"I no longer want ownership of this reference. In this case, the caller can still keep shared ownership by passing an lvalue (`thisBlock`), which would increase the ref count.\r\n- pass by rvalue (`std::shared_ptr<const CBlock>&&`) which is the callee saying \"I will steal ownership\". The caller has to call using an rvalue reference (`std::move(thisBlock)`). Calling by lvalue would be invalid.\r\n\r\nI think it's best to keep this as pass-by-value and have the caller pass it with an rvalue reference.\r\n\r\nAlso, the initializer list needs to use a std::move to prevent the ref increment/decrement, which I'll change.\r\n\r\nSome references:\r\n- summary of ways to pass smart pointers as arguments (it's talking about unique_ptr, but the same concepts are true for shared_ptrs): https://stackoverflow.com/questions/8114276/how-do-i-pass-a-unique-ptr-argument-to-a-constructor-or-a-function\r\n- CPP Core Guidelines on passing shared pointers: http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rr-sharedptrparam-owner\r\n- Herb Sutter on smart pointer parameters: https://herbsutter.com/2013/06/05/gotw-91-solution-smart-pointer-parameters/\r\n- Scott Meyers on passing move types by value/rvalue reference: http://scottmeyers.blogspot.com/2014/07/should-move-only-types-ever-be-passed.html\r\n- Demonstration code of the different ways to pass a shared_ptr and the effect on ref counts: https://gist.github.com/jnewbery/10ee24a5ce783932accddbe4347f110e",
    "created_at": "2020-04-18T16:12:56Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410717136",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410717136"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410717136"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410717136/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2519,
    "side": "RIGHT",
    "in_reply_to_id": 410270513
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410717223",
    "pull_request_review_id": 395927361,
    "id": 410717223,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxNzIyMw==",
    "diff_hunk": "@@ -2512,45 +2512,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(block) {}\n };\n+\n /**\n- * Used to track blocks whose transactions were applied to the UTXO state as a\n- * part of a single ActivateBestChainStep call.\n- *\n- * This class is single-use, once you call GetBlocksConnected() you have to throw\n- * it away and make a new one.\n+ * Used to track blocks that were connected as part of a single\n+ * ActivateBestChainStep call. The BlockConnected validationinterface signal is\n+ * fired after a single ABCS call for all blocks that were connected in that\n+ * ABCS call.\n  */\n-class ConnectTrace {\n-private:\n-    std::vector<PerBlockConnectTrace> blocksConnected;\n-\n-public:\n-    explicit ConnectTrace() : blocksConnected(1) {}\n-\n-    void BlockConnected(CBlockIndex* pindex, std::shared_ptr<const CBlock> pblock) {\n-        assert(!blocksConnected.back().pindex);\n-        assert(pindex);\n-        assert(pblock);\n-        blocksConnected.back().pindex = pindex;\n-        blocksConnected.back().pblock = std::move(pblock);\n-        blocksConnected.emplace_back();\n-    }\n-\n-    std::vector<PerBlockConnectTrace>& GetBlocksConnected() {\n-        // We always keep one extra block at the end of our list because\n-        // blocks are added after all the conflicted transactions have\n-        // been filled in. Thus, the last entry should always be an empty\n-        // one waiting for the transactions from the next block. We pop\n-        // the last entry here to make sure the list we return is sane.\n-        assert(!blocksConnected.back().pindex);\n-        blocksConnected.pop_back();\n-        return blocksConnected;\n-    }\n-};\n+typedef std::vector<PerBlockConnectTrace> ConnectTrace;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 50,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It's not needed. I just wanted to keep it here so the comment made sense and I didn't have to move it to the header file.",
    "created_at": "2020-04-18T16:13:40Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410717223",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410717223"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410717223"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410717223/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2528,
    "side": "RIGHT",
    "in_reply_to_id": 410271078
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410717291",
    "pull_request_review_id": 395927406,
    "id": 410717291,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxNzI5MQ==",
    "diff_hunk": "@@ -2868,7 +2843,7 @@ bool CChainState::ActivateBestChain(BlockValidationState &state, const CChainPar\n                 }\n                 pindexNewTip = m_chain.Tip();\n \n-                for (const PerBlockConnectTrace& trace : connectTrace.GetBlocksConnected()) {\n+                for (auto& trace : connectTrace) {",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 68,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sounds sensible. I'll revert.",
    "created_at": "2020-04-18T16:13:57Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410717291",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410717291"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410717291"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410717291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2846,
    "side": "RIGHT",
    "in_reply_to_id": 410272193
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410718508",
    "pull_request_review_id": 395928292,
    "id": 410718508,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxODUwOA==",
    "diff_hunk": "@@ -409,7 +409,9 @@ enum DisconnectResult\n     DISCONNECT_FAILED   // Something else went wrong.\n };\n \n-class ConnectTrace;\n+// forward declaration for ActivateBestChainStep and ConnectTip\n+struct PerBlockConnectTrace;\n+typedef std::vector<PerBlockConnectTrace> ConnectTrace;",
    "path": "src/validation.h",
    "position": null,
    "original_position": 7,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think it makes a difference for aliases which are not templates (and I can't see this in the style guide), but changed anyway.",
    "created_at": "2020-04-18T16:24:01Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410718508",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410718508"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410718508"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410718508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 414,
    "side": "RIGHT",
    "in_reply_to_id": 410272555
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410721803",
    "pull_request_review_id": 395930706,
    "id": 410721803,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyMTgwMw==",
    "diff_hunk": "@@ -2512,45 +2512,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(block) {}\n };\n+\n /**\n- * Used to track blocks whose transactions were applied to the UTXO state as a\n- * part of a single ActivateBestChainStep call.\n- *\n- * This class is single-use, once you call GetBlocksConnected() you have to throw\n- * it away and make a new one.\n+ * Used to track blocks that were connected as part of a single\n+ * ActivateBestChainStep call. The BlockConnected validationinterface signal is\n+ * fired after a single ABCS call for all blocks that were connected in that\n+ * ABCS call.\n  */\n-class ConnectTrace {\n-private:\n-    std::vector<PerBlockConnectTrace> blocksConnected;\n-\n-public:\n-    explicit ConnectTrace() : blocksConnected(1) {}\n-\n-    void BlockConnected(CBlockIndex* pindex, std::shared_ptr<const CBlock> pblock) {\n-        assert(!blocksConnected.back().pindex);\n-        assert(pindex);\n-        assert(pblock);\n-        blocksConnected.back().pindex = pindex;\n-        blocksConnected.back().pblock = std::move(pblock);\n-        blocksConnected.emplace_back();\n-    }\n-\n-    std::vector<PerBlockConnectTrace>& GetBlocksConnected() {\n-        // We always keep one extra block at the end of our list because\n-        // blocks are added after all the conflicted transactions have\n-        // been filled in. Thus, the last entry should always be an empty\n-        // one waiting for the transactions from the next block. We pop\n-        // the last entry here to make sure the list we return is sane.\n-        assert(!blocksConnected.back().pindex);\n-        blocksConnected.pop_back();\n-        return blocksConnected;\n-    }\n-};\n+typedef std::vector<PerBlockConnectTrace> ConnectTrace;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 50,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Didn't see the new comment, but I think you can put the new comment to the single place where connecttrace is instantiated. No strong opinion, though.",
    "created_at": "2020-04-18T16:52:04Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410721803",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410721803"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410721803"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/410721803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2528,
    "side": "RIGHT",
    "in_reply_to_id": 410271078
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420873583",
    "pull_request_review_id": 406717147,
    "id": 420873583,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg3MzU4Mw==",
    "diff_hunk": "@@ -409,7 +409,9 @@ enum DisconnectResult\n     DISCONNECT_FAILED   // Something else went wrong.\n };\n \n-class ConnectTrace;\n+// forward declaration for ActivateBestChainStep and ConnectTip\n+struct PerBlockConnectTrace;\n+typedef std::vector<PerBlockConnectTrace> ConnectTrace;",
    "path": "src/validation.h",
    "position": null,
    "original_position": 7,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> I don't think it makes a difference for aliases which are not templates (and I can't see this in the style guide), but changed anyway.\r\n\r\nThis is my understanding as well after looking this up, along with `typedef` being the earlier, traditional syntax of the two. Perhaps one advantage `typedef` may have over `using` is that it is used only for declaring type aliases.",
    "created_at": "2020-05-06T15:15:43Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r420873583",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420873583"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r420873583"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420873583/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 414,
    "side": "RIGHT",
    "in_reply_to_id": 410272555
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420922597",
    "pull_request_review_id": 406780031,
    "id": 420922597,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkyMjU5Nw==",
    "diff_hunk": "@@ -409,7 +409,9 @@ enum DisconnectResult\n     DISCONNECT_FAILED   // Something else went wrong.\n };\n \n-class ConnectTrace;\n+// forward declaration for ActivateBestChainStep and ConnectTip\n+struct PerBlockConnectTrace;\n+typedef std::vector<PerBlockConnectTrace> ConnectTrace;",
    "path": "src/validation.h",
    "position": null,
    "original_position": 7,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "a9f84cc3d05f1807bb37ce8d1fdb9ba5ff491e64",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Git grepping instances of type aliases seems easier with`typedef` as well.",
    "created_at": "2020-05-06T16:23:27Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r420922597",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420922597"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r420922597"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/420922597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 414,
    "side": "RIGHT",
    "in_reply_to_id": 410272555
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479612111",
    "pull_request_review_id": 478101059,
    "id": 479612111,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYxMjExMQ==",
    "diff_hunk": "@@ -2610,7 +2585,7 @@ bool CChainState::ConnectTip(BlockValidationState& state, const CChainParams& ch\n     LogPrint(BCLog::BENCH, \"  - Connect postprocess: %.2fms [%.2fs (%.2fms/blk)]\\n\", (nTime6 - nTime5) * MILLI, nTimePostConnect * MICRO, nTimePostConnect * MILLI / nBlocksTotal);\n     LogPrint(BCLog::BENCH, \"- Connect block: %.2fms [%.2fs (%.2fms/blk)]\\n\", (nTime6 - nTime1) * MILLI, nTimeTotal * MICRO, nTimeTotal * MILLI / nBlocksTotal);\n \n-    connectTrace.BlockConnected(pindexNew, std::move(pthisBlock));\n+    connectTrace.emplace_back(pindexNew, pthisBlock);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 59,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "42f5e77bbbaf20e5e03378d6daa640452e0c5bbf",
    "user": {
      "login": "robot-dreams",
      "id": 4276679,
      "node_id": "MDQ6VXNlcjQyNzY2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4276679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robot-dreams",
      "html_url": "https://github.com/robot-dreams",
      "followers_url": "https://api.github.com/users/robot-dreams/followers",
      "following_url": "https://api.github.com/users/robot-dreams/following{/other_user}",
      "gists_url": "https://api.github.com/users/robot-dreams/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robot-dreams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robot-dreams/subscriptions",
      "organizations_url": "https://api.github.com/users/robot-dreams/orgs",
      "repos_url": "https://api.github.com/users/robot-dreams/repos",
      "events_url": "https://api.github.com/users/robot-dreams/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robot-dreams/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm still very new to move semantics, but just confirming, what's the motivation for removing the `std::move`?\r\n\r\nIn my local experiments, it looks like taking out the `std::move` increments the refcount; could this have performance implications?\r\n\r\n#### No `std::move`\r\n\r\n\tint main() {\r\n\t    CBlockIndex index;\r\n\t    CBlockIndex* pindex = &index;\r\n\r\n\t    std::shared_ptr<const CBlock> pblock(new CBlock);\r\n\r\n\t// (lldb) p pblock\r\n\t// strong=1 weak=1 {\r\n\t//   __ptr_ = 0x0000000100205290\r\n\t// }\r\n\r\n\t    ConnectTrace connectTrace;\r\n\t    connectTrace.emplace_back(pindex, pblock);\r\n\r\n\t// (lldb) p pblock\r\n\t// strong=2 weak=1 {\r\n\t//   __ptr_ = 0x0000000100205290\r\n\t// }\r\n\r\n\t}\r\n\r\n#### With `std::move`\r\n\r\n\tint main() {\r\n\t    CBlockIndex index;\r\n\t    CBlockIndex* pindex = &index;\r\n\r\n\t    std::shared_ptr<const CBlock> pblock(new CBlock);\r\n\r\n\t// (lldb) p pblock\r\n\t// strong=1 weak=1 {\r\n\t//   __ptr_ = 0x0000000100304150\r\n\t// }\r\n\r\n\t    ConnectTrace connectTrace;\r\n\t    connectTrace.emplace_back(pindex, std::move(pblock));\r\n\r\n\t// (lldb) p pblock\r\n\t// nullptr {\r\n\t//   __ptr_ = 0x0000000000000000\r\n\t// }\r\n\r\n\t}",
    "created_at": "2020-08-29T05:50:10Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r479612111",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479612111"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r479612111"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479612111/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2588,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479612433",
    "pull_request_review_id": 478101059,
    "id": 479612433,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYxMjQzMw==",
    "diff_hunk": "@@ -2512,45 +2512,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(std::move(block)) {}\n };\n+\n /**\n- * Used to track blocks whose transactions were applied to the UTXO state as a\n- * part of a single ActivateBestChainStep call.\n- *\n- * This class is single-use, once you call GetBlocksConnected() you have to throw\n- * it away and make a new one.\n+ * Used to track blocks that were connected as part of a single\n+ * ActivateBestChainStep call. The BlockConnected validationinterface signal is\n+ * fired after a single ABCS call for all blocks that were connected in that\n+ * ABCS call.\n  */\n-class ConnectTrace {\n-private:\n-    std::vector<PerBlockConnectTrace> blocksConnected;\n-\n-public:\n-    explicit ConnectTrace() : blocksConnected(1) {}\n-\n-    void BlockConnected(CBlockIndex* pindex, std::shared_ptr<const CBlock> pblock) {\n-        assert(!blocksConnected.back().pindex);\n-        assert(pindex);",
    "path": "src/validation.cpp",
    "position": 25,
    "original_position": 32,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "42f5e77bbbaf20e5e03378d6daa640452e0c5bbf",
    "user": {
      "login": "robot-dreams",
      "id": 4276679,
      "node_id": "MDQ6VXNlcjQyNzY2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4276679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robot-dreams",
      "html_url": "https://github.com/robot-dreams",
      "followers_url": "https://api.github.com/users/robot-dreams/followers",
      "following_url": "https://api.github.com/users/robot-dreams/following{/other_user}",
      "gists_url": "https://api.github.com/users/robot-dreams/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robot-dreams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robot-dreams/subscriptions",
      "organizations_url": "https://api.github.com/users/robot-dreams/orgs",
      "repos_url": "https://api.github.com/users/robot-dreams/repos",
      "events_url": "https://api.github.com/users/robot-dreams/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robot-dreams/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Note (no action needed): I agree these asserts are no longer needed, because `ConnectTip` guarantees guarantees neither the `CBlockIndex` nor the `std::shared_ptr<const CBlock>` will be null.",
    "created_at": "2020-08-29T05:53:50Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r479612433",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479612433"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r479612433"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479612433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2557,
    "original_line": 2557,
    "side": "LEFT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479615472",
    "pull_request_review_id": 478101059,
    "id": 479615472,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYxNTQ3Mg==",
    "diff_hunk": "@@ -132,14 +132,19 @@ class CValidationInterface {\n     virtual void TransactionRemovedFromMempool(const CTransactionRef &ptx) {}\n     /**\n      * Notifies listeners of a block being connected.\n-     * Provides a vector of transactions evicted from the mempool as a result.\n+     *\n+     * The mempool is not guaranteed to be in a consistent state when this\n+     * notification is fired. Listeners should use UpdatedBlockTip for that.",
    "path": "src/validationinterface.h",
    "position": 7,
    "original_position": 7,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "42f5e77bbbaf20e5e03378d6daa640452e0c5bbf",
    "user": {
      "login": "robot-dreams",
      "id": 4276679,
      "node_id": "MDQ6VXNlcjQyNzY2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4276679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robot-dreams",
      "html_url": "https://github.com/robot-dreams",
      "followers_url": "https://api.github.com/users/robot-dreams/followers",
      "following_url": "https://api.github.com/users/robot-dreams/following{/other_user}",
      "gists_url": "https://api.github.com/users/robot-dreams/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robot-dreams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robot-dreams/subscriptions",
      "organizations_url": "https://api.github.com/users/robot-dreams/orgs",
      "repos_url": "https://api.github.com/users/robot-dreams/repos",
      "events_url": "https://api.github.com/users/robot-dreams/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robot-dreams/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Beginner question: what do you mean by \"consistent state\" here?\r\n\r\ni.e. what could go wrong with the mempool after some, but not all, of the `ActivateBestChainStep` involved in `ActivateBestChain`?",
    "created_at": "2020-08-29T06:32:22Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r479615472",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479615472"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r479615472"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/479615472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 139,
    "original_line": 139,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483494853",
    "pull_request_review_id": 482493700,
    "id": 483494853,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5NDg1Mw==",
    "diff_hunk": "@@ -2610,7 +2585,7 @@ bool CChainState::ConnectTip(BlockValidationState& state, const CChainParams& ch\n     LogPrint(BCLog::BENCH, \"  - Connect postprocess: %.2fms [%.2fs (%.2fms/blk)]\\n\", (nTime6 - nTime5) * MILLI, nTimePostConnect * MICRO, nTimePostConnect * MILLI / nBlocksTotal);\n     LogPrint(BCLog::BENCH, \"- Connect block: %.2fms [%.2fs (%.2fms/blk)]\\n\", (nTime6 - nTime1) * MILLI, nTimeTotal * MICRO, nTimeTotal * MILLI / nBlocksTotal);\n \n-    connectTrace.BlockConnected(pindexNew, std::move(pthisBlock));\n+    connectTrace.emplace_back(pindexNew, pthisBlock);",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 59,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "42f5e77bbbaf20e5e03378d6daa640452e0c5bbf",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, you're right! The caller should cast to rvalue reference by calling `std::move()` (that was my intention in https://github.com/bitcoin/bitcoin/pull/18685#discussion_r410717136).\r\n\r\nThanks for catching this.",
    "created_at": "2020-09-04T09:15:03Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r483494853",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483494853"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r483494853"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483494853/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2588,
    "side": "RIGHT",
    "in_reply_to_id": 479612111
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483514430",
    "pull_request_review_id": 482518727,
    "id": 483514430,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzUxNDQzMA==",
    "diff_hunk": "@@ -132,14 +132,19 @@ class CValidationInterface {\n     virtual void TransactionRemovedFromMempool(const CTransactionRef &ptx) {}\n     /**\n      * Notifies listeners of a block being connected.\n-     * Provides a vector of transactions evicted from the mempool as a result.\n+     *\n+     * The mempool is not guaranteed to be in a consistent state when this\n+     * notification is fired. Listeners should use UpdatedBlockTip for that.",
    "path": "src/validationinterface.h",
    "position": 7,
    "original_position": 7,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "42f5e77bbbaf20e5e03378d6daa640452e0c5bbf",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "cs_main and mempool.cs are both still being held when the `BlockConnected` signal is called, and `UpdateMempoolForReorg()` may have been called after blocks were connected but before the `BlockConnected` signal is called. See the comment above for the `TransactionAddedToMempool` signal.\r\n\r\nThe `UpdatedBlockTip` signal is called just before releasing `cs_main`, when we know that the mempool is consistent with the chain tip. ",
    "created_at": "2020-09-04T09:52:33Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r483514430",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483514430"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r483514430"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483514430/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 139,
    "original_line": 139,
    "side": "RIGHT",
    "in_reply_to_id": 479615472
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483914867",
    "pull_request_review_id": 483033034,
    "id": 483914867,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkxNDg2Nw==",
    "diff_hunk": "@@ -132,14 +132,19 @@ class CValidationInterface {\n     virtual void TransactionRemovedFromMempool(const CTransactionRef &ptx) {}\n     /**\n      * Notifies listeners of a block being connected.\n-     * Provides a vector of transactions evicted from the mempool as a result.\n+     *\n+     * The mempool is not guaranteed to be in a consistent state when this\n+     * notification is fired. Listeners should use UpdatedBlockTip for that.",
    "path": "src/validationinterface.h",
    "position": 7,
    "original_position": 7,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "42f5e77bbbaf20e5e03378d6daa640452e0c5bbf",
    "user": {
      "login": "robot-dreams",
      "id": 4276679,
      "node_id": "MDQ6VXNlcjQyNzY2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4276679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robot-dreams",
      "html_url": "https://github.com/robot-dreams",
      "followers_url": "https://api.github.com/users/robot-dreams/followers",
      "following_url": "https://api.github.com/users/robot-dreams/following{/other_user}",
      "gists_url": "https://api.github.com/users/robot-dreams/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robot-dreams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robot-dreams/subscriptions",
      "organizations_url": "https://api.github.com/users/robot-dreams/orgs",
      "repos_url": "https://api.github.com/users/robot-dreams/repos",
      "events_url": "https://api.github.com/users/robot-dreams/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robot-dreams/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks for clarifying! Here's my updated understanding:\r\n\r\n- If a `validationinterface` listener considers the callbacks as a canonical log of all events, then immediately after a `BlockConnected` but before the subsequent `UpdatedBlockTip`, the listener might have an inconsistent view (e.g. some transactions have disappeared from both the mempool and the active chain)\r\n\r\n- If a validationinterface callback locks both `cs_main` and `m_mempool.cs` before accessing the underlying state directly, it WOULD get a consistent view (because by the time the lock can be acquired, the `UpdatedBlockTip` would have happened), but I don't think any callbacks do this at the moment",
    "created_at": "2020-09-05T05:50:08Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r483914867",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483914867"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r483914867"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483914867/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 139,
    "original_line": 139,
    "side": "RIGHT",
    "in_reply_to_id": 479615472
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483916524",
    "pull_request_review_id": 483033034,
    "id": 483916524,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkxNjUyNA==",
    "diff_hunk": "@@ -2541,45 +2541,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(std::move(block)) {}\n };\n+\n /**\n- * Used to track blocks whose transactions were applied to the UTXO state as a\n- * part of a single ActivateBestChainStep call.\n- *\n- * This class is single-use, once you call GetBlocksConnected() you have to throw\n- * it away and make a new one.\n+ * Used to track blocks that were connected as part of a single\n+ * ActivateBestChainStep call. The BlockConnected validationinterface signal is\n+ * fired after a single ABCS call for all blocks that were connected in that\n+ * ABCS call.",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 21,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "d956ac72f11c0888c6d719d257aa050a37d12ff2",
    "user": {
      "login": "robot-dreams",
      "id": 4276679,
      "node_id": "MDQ6VXNlcjQyNzY2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4276679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robot-dreams",
      "html_url": "https://github.com/robot-dreams",
      "followers_url": "https://api.github.com/users/robot-dreams/followers",
      "following_url": "https://api.github.com/users/robot-dreams/following{/other_user}",
      "gists_url": "https://api.github.com/users/robot-dreams/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robot-dreams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robot-dreams/subscriptions",
      "organizations_url": "https://api.github.com/users/robot-dreams/orgs",
      "repos_url": "https://api.github.com/users/robot-dreams/repos",
      "events_url": "https://api.github.com/users/robot-dreams/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robot-dreams/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Nit (feel free to ignore): How would you feel about rewording this to make it really obvious that there's one BlockConnected signal per block? For example:\r\n\r\n    Used to track blocks that were connected as part of a single\r\n    ActivateBestChainStep call. After the ABCS call, a separate BlockConnected\r\n    validationinterface signal is fired for each block that was connected\r\n    in the ABCS call.",
    "created_at": "2020-09-05T06:12:31Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r483916524",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483916524"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r483916524"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/483916524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2555,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484319651",
    "pull_request_review_id": 483413932,
    "id": 484319651,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMxOTY1MQ==",
    "diff_hunk": "@@ -132,14 +132,19 @@ class CValidationInterface {\n     virtual void TransactionRemovedFromMempool(const CTransactionRef &ptx) {}\n     /**\n      * Notifies listeners of a block being connected.\n-     * Provides a vector of transactions evicted from the mempool as a result.\n+     *\n+     * The mempool is not guaranteed to be in a consistent state when this\n+     * notification is fired. Listeners should use UpdatedBlockTip for that.",
    "path": "src/validationinterface.h",
    "position": 7,
    "original_position": 7,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "42f5e77bbbaf20e5e03378d6daa640452e0c5bbf",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I agree with your first point. For the second point, if we consider the client to be a passive listener (ie the only input it's getting is from the validation interface), then it shouldn't/can't acquire those locks. It should wait for a `UpdatedBlockTip` to be sure that the state is consistent.",
    "created_at": "2020-09-07T09:44:48Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r484319651",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484319651"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r484319651"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484319651/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 139,
    "original_line": 139,
    "side": "RIGHT",
    "in_reply_to_id": 479615472
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484321444",
    "pull_request_review_id": 483416162,
    "id": 484321444,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMyMTQ0NA==",
    "diff_hunk": "@@ -2541,45 +2541,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(std::move(block)) {}\n };\n+\n /**\n- * Used to track blocks whose transactions were applied to the UTXO state as a\n- * part of a single ActivateBestChainStep call.\n- *\n- * This class is single-use, once you call GetBlocksConnected() you have to throw\n- * it away and make a new one.\n+ * Used to track blocks that were connected as part of a single\n+ * ActivateBestChainStep call. The BlockConnected validationinterface signal is\n+ * fired after a single ABCS call for all blocks that were connected in that\n+ * ABCS call.",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 21,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "d956ac72f11c0888c6d719d257aa050a37d12ff2",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sure. That seems better. Updated.",
    "created_at": "2020-09-07T09:47:56Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r484321444",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484321444"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r484321444"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/484321444/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2555,
    "side": "RIGHT",
    "in_reply_to_id": 483916524
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583777097",
    "pull_request_review_id": 599759426,
    "id": 583777097,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mzc3NzA5Nw==",
    "diff_hunk": "@@ -2541,45 +2541,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(std::move(block)) {}\n };\n+\n /**\n- * Used to track blocks whose transactions were applied to the UTXO state as a\n- * part of a single ActivateBestChainStep call.\n- *\n- * This class is single-use, once you call GetBlocksConnected() you have to throw\n- * it away and make a new one.\n+ * Used to track blocks that were connected as part of a single\n+ * ActivateBestChainStep call. After the ABCS call returns, a separate\n+ * BlockConnected validationinterface signal is fired for each block that was\n+ * connected in the ABCS call.\n  */\n-class ConnectTrace {\n-private:\n-    std::vector<PerBlockConnectTrace> blocksConnected;\n-\n-public:\n-    explicit ConnectTrace() : blocksConnected(1) {}\n-\n-    void BlockConnected(CBlockIndex* pindex, std::shared_ptr<const CBlock> pblock) {\n-        assert(!blocksConnected.back().pindex);\n-        assert(pindex);\n-        assert(pblock);\n-        blocksConnected.back().pindex = pindex;\n-        blocksConnected.back().pblock = std::move(pblock);\n-        blocksConnected.emplace_back();\n-    }\n-\n-    std::vector<PerBlockConnectTrace>& GetBlocksConnected() {\n-        // We always keep one extra block at the end of our list because\n-        // blocks are added after all the conflicted transactions have\n-        // been filled in. Thus, the last entry should always be an empty\n-        // one waiting for the transactions from the next block. We pop\n-        // the last entry here to make sure the list we return is sane.\n-        assert(!blocksConnected.back().pindex);\n-        blocksConnected.pop_back();\n-        return blocksConnected;\n-    }\n-};\n+using ConnectTrace = std::vector<PerBlockConnectTrace>;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 50,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "4faaaa1d5935e1296c624a8d9d414989ec2fede6",
    "user": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Suggest removing this `using` and moving the associated comment to the header. (In particular, if someone changes one `using` or the other, the one in validation.cpp wins; not precisely shadowing but still annoying)",
    "created_at": "2021-02-26T16:52:11Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r583777097",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583777097"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r583777097"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583777097/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2557,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583778936",
    "pull_request_review_id": 599759426,
    "id": 583778936,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mzc3ODkzNg==",
    "diff_hunk": "@@ -2541,45 +2541,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(std::move(block)) {}",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "4faaaa1d5935e1296c624a8d9d414989ec2fede6",
    "user": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Adding `assert(index != nullptr && block);` would replace the assertions you're deleting below.",
    "created_at": "2021-02-26T16:55:08Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r583778936",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583778936"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r583778936"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/583778936/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2548,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584168851",
    "pull_request_review_id": 600180886,
    "id": 584168851,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDE2ODg1MQ==",
    "diff_hunk": "@@ -2541,45 +2541,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(std::move(block)) {}\n };\n+\n /**\n- * Used to track blocks whose transactions were applied to the UTXO state as a\n- * part of a single ActivateBestChainStep call.\n- *\n- * This class is single-use, once you call GetBlocksConnected() you have to throw\n- * it away and make a new one.\n+ * Used to track blocks that were connected as part of a single\n+ * ActivateBestChainStep call. After the ABCS call returns, a separate\n+ * BlockConnected validationinterface signal is fired for each block that was\n+ * connected in the ABCS call.\n  */\n-class ConnectTrace {\n-private:\n-    std::vector<PerBlockConnectTrace> blocksConnected;\n-\n-public:\n-    explicit ConnectTrace() : blocksConnected(1) {}\n-\n-    void BlockConnected(CBlockIndex* pindex, std::shared_ptr<const CBlock> pblock) {\n-        assert(!blocksConnected.back().pindex);\n-        assert(pindex);\n-        assert(pblock);\n-        blocksConnected.back().pindex = pindex;\n-        blocksConnected.back().pblock = std::move(pblock);\n-        blocksConnected.emplace_back();\n-    }\n-\n-    std::vector<PerBlockConnectTrace>& GetBlocksConnected() {\n-        // We always keep one extra block at the end of our list because\n-        // blocks are added after all the conflicted transactions have\n-        // been filled in. Thus, the last entry should always be an empty\n-        // one waiting for the transactions from the next block. We pop\n-        // the last entry here to make sure the list we return is sane.\n-        assert(!blocksConnected.back().pindex);\n-        blocksConnected.pop_back();\n-        return blocksConnected;\n-    }\n-};\n+using ConnectTrace = std::vector<PerBlockConnectTrace>;",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 50,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "4faaaa1d5935e1296c624a8d9d414989ec2fede6",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done. I've moved everything into the class declaration in the header.",
    "created_at": "2021-02-27T18:07:50Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r584168851",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584168851"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r584168851"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584168851/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2557,
    "side": "RIGHT",
    "in_reply_to_id": 583777097
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584168853",
    "pull_request_review_id": 600180889,
    "id": 584168853,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDE2ODg1Mw==",
    "diff_hunk": "@@ -2541,45 +2541,20 @@ static int64_t nTimeFlush = 0;\n static int64_t nTimeChainState = 0;\n static int64_t nTimePostConnect = 0;\n \n+//! A single block and block index pointer.\n struct PerBlockConnectTrace {\n     CBlockIndex* pindex = nullptr;\n     std::shared_ptr<const CBlock> pblock;\n-    PerBlockConnectTrace() {}\n+    PerBlockConnectTrace(CBlockIndex* index, std::shared_ptr<const CBlock> block) : pindex(index), pblock(std::move(block)) {}",
    "path": "src/validation.cpp",
    "position": null,
    "original_position": 9,
    "commit_id": "16523a7c42f987428291e149230609a30d49002e",
    "original_commit_id": "4faaaa1d5935e1296c624a8d9d414989ec2fede6",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2021-02-27T18:07:52Z",
    "updated_at": "2021-02-27T18:07:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r584168853",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584168853"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18685#discussion_r584168853"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18685"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/584168853/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2548,
    "side": "RIGHT",
    "in_reply_to_id": 583778936
  }
]